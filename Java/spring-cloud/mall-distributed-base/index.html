<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="方志的个人博客,fangzhioo,blog">
    <meta name="keyword"  content="方志,fangzhioo,Fz&#39;s Blog,Kirito,桐人,博客,互联网,Web,JavaScript,Html,Css,Vue.js,React.js,前端,设计,spring, spring cloud, spring cloud alibaba, spring boot, mall, docker, mysql, nacos">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          【Spring-cloud】guli商城-分布式基础 - 方志 | fangzhioo
        
    </title>

    <link rel="canonical" href="https://fangzhioo.github.io/Java/spring-cloud/mall-distributed-base/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">


    
<link rel="stylesheet" href="/css/donate.css">

    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/prism.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script>
      // ga
      window.onload = function() {
        setTimeout(function() {
          let script = document.createElement("script");
          script.setAttribute("async", "");
          script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3409699730406381";
          document.body.appendChild(script);
        }, 2e3);
      }
    </script>

    <!--不蒜子-->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- jQuery -->
    <!-- 
<script src="/js/jquery.min.js"></script>
 -->
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <!-- 
<script src="/js/bootstrap.min.js"></script>
 -->
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <!-- google ad -->
    <script data-ad-client="ca-pub-3409699730406381" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('//www.talklee.com/api/bing?rand=true')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#SpringCloud" title="SpringCloud">SpringCloud</a>
                            
                        </div>
                        <h1>【Spring-cloud】guli商城-分布式基础</h1>
                        <h2 class="subheading">从零开始一个分布式商城的创建</h2>

                        <!--文章访问量统计-->
                        
                            <span id="busuanzi_container_page_pv">本文已被阅读过<span id="busuanzi_value_page_pv"></span>次</span>
                        
                        <!--文章访问量统计-->

                        <span class="meta">
                            Posted by 方志 on
                            2021-06-01
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Fz Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    
                        <li>
                            <a href="/archive/" >Archives</a>
                        </li>
                    
                        <li>
                            <a href="/tags/" >Tags</a>
                        </li>
                    
                        <li>
                            <a href="/about/" >About</a>
                        </li>
                    

                    <!-- 

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/love/">✨致我的小可爱💕～</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                     -->
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <blockquote>
<p>一下内容来自 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1np4y1C7Yf">尚硅谷——全网最强电商教程《谷粒商城》</a></p>
</blockquote>
<h2 id="1-整体介绍"><a href="#1-整体介绍" class="headerlink" title="1. 整体介绍"></a>1. 整体介绍</h2><p><img src="/img/spring-cloud/image-20200422211607028.png" alt="image-20200422211607028"></p>
<h3 id="1）安装vagrant"><a href="#1）安装vagrant" class="headerlink" title="1）安装vagrant"></a>1）安装vagrant</h3><h3 id="2）安装Centos7"><a href="#2）安装Centos7" class="headerlink" title="2）安装Centos7"></a>2）安装Centos7</h3><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ vagrant init centos/7
A <span class="token variable"><span class="token variable">`</span>Vagrantfile<span class="token variable">`</span></span> has been placed <span class="token keyword">in</span> this directory. You are now
ready to <span class="token variable"><span class="token variable">`</span>vagrant up<span class="token variable">`</span></span> your first virtual environment<span class="token operator">!</span> Please <span class="token builtin class-name">read</span>
the comments <span class="token keyword">in</span> the Vagrantfile as well as documentation on
<span class="token variable"><span class="token variable">`</span>vagrantup.com<span class="token variable">`</span></span> <span class="token keyword">for</span> <span class="token function">more</span> information on using Vagrant.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>执行完上面的命令后，会在用户的家目录下生成Vagrantfile文件。</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ vagrant up
Bringing machine <span class="token string">'default'</span> up with <span class="token string">'virtualbox'</span> provider<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Box <span class="token string">'centos/7'</span> could not be found. Attempting to <span class="token function">find</span> and install<span class="token punctuation">..</span>.
    default: Box Provider: virtualbox
    default: Box Version: <span class="token operator">></span><span class="token operator">=</span> <span class="token number">0</span>
<span class="token operator">==</span><span class="token operator">></span> default: Loading metadata <span class="token keyword">for</span> box <span class="token string">'centos/7'</span>
    default: URL: https://vagrantcloud.com/centos/7
<span class="token operator">==</span><span class="token operator">></span> default: Adding box <span class="token string">'centos/7'</span> <span class="token punctuation">(</span>v1905.1<span class="token punctuation">)</span> <span class="token keyword">for</span> provider: virtualbox
    default: Downloading: https://vagrantcloud.com/centos/boxes/7/versions/1905.1/providers/virtualbox.box
    default: Download redirected to host: cloud.centos.org
    default: Progress: <span class="token number">0</span>% <span class="token punctuation">(</span>Rate: <span class="token number">6717</span>/s, Estimated <span class="token function">time</span> remaining: <span class="token number">7</span>:33:42<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>下载镜像过程比较漫长，也可以采用先用下载工具下载到本地后，然后使用“ vagrant box add ”添加，再“vagrant up”即可</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#将下载的镜像添加到virtualBox中</span>
$ vagrant box <span class="token function">add</span> centos/7 E:<span class="token punctuation">\</span>迅雷下载<span class="token punctuation">\</span>CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box
<span class="token operator">==</span><span class="token operator">></span> box: Box <span class="token function">file</span> was not detected as metadata. Adding it directly<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> box: Adding box <span class="token string">'centos/7'</span> <span class="token punctuation">(</span>v0<span class="token punctuation">)</span> <span class="token keyword">for</span> provider:
    box: Unpacking necessary files from: file:///E:/%D1%B8%C0%D7%CF%C2%D4%D8/CentOS-7-x86_64-Vagrant-1905_01.VirtualBox.box
    box:
<span class="token operator">==</span><span class="token operator">></span> box: Successfully added box <span class="token string">'centos/7'</span> <span class="token punctuation">(</span>v0<span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token string">'virtualbox'</span><span class="token operator">!</span>

<span class="token comment">#启动</span>
$ vagrant up
Bringing machine <span class="token string">'default'</span> up with <span class="token string">'virtualbox'</span> provider<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Importing base box <span class="token string">'centos/7'</span><span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Matching MAC address <span class="token keyword">for</span> NAT networking<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Setting the name of the VM: Administrator_default_1588497928070_24634
<span class="token operator">==</span><span class="token operator">></span> default: Clearing any previously <span class="token builtin class-name">set</span> network interfaces<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Preparing network interfaces based on configuration<span class="token punctuation">..</span>.
    default: Adapter <span class="token number">1</span>: nat
    default: Adapter <span class="token number">2</span>: hostonly
<span class="token operator">==</span><span class="token operator">></span> default: Forwarding ports<span class="token punctuation">..</span>.
    default: <span class="token number">22</span> <span class="token punctuation">(</span>guest<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">2222</span> <span class="token punctuation">(</span>host<span class="token punctuation">)</span> <span class="token punctuation">(</span>adapter <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">==</span><span class="token operator">></span> default: Booting VM<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Waiting <span class="token keyword">for</span> machine to boot. This may take a few minutes<span class="token punctuation">..</span>.
    default: SSH address: <span class="token number">127.0</span>.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
    default:
    default: Vagrant insecure key detected. Vagrant will automatically replace
    default: this with a newly generated keypair <span class="token keyword">for</span> better security.
    default:
    default: Inserting generated public key within guest<span class="token punctuation">..</span>.
    default: Removing insecure key from the guest <span class="token keyword">if</span> it's present<span class="token punctuation">..</span>.
    default: Key inserted<span class="token operator">!</span> Disconnecting and reconnecting using new SSH key<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Machine booted and ready<span class="token operator">!</span>
<span class="token operator">==</span><span class="token operator">></span> default: Checking <span class="token keyword">for</span> guest additions <span class="token keyword">in</span> VM<span class="token punctuation">..</span>.
    default: No guest additions were detected on the base box <span class="token keyword">for</span> this VM<span class="token operator">!</span> Guest
    default: additions are required <span class="token keyword">for</span> forwarded ports, shared folders, <span class="token function">host</span> only
    default: networking, and more. If SSH fails on this machine, please <span class="token function">install</span>
    default: the guest additions and repackage the box to continue.
    default:
    default: This is not an error message<span class="token punctuation">;</span> everything may <span class="token builtin class-name">continue</span> to work properly,
    default: <span class="token keyword">in</span> <span class="token function">which</span> <span class="token keyword">case</span> you may ignore this message.
<span class="token operator">==</span><span class="token operator">></span> default: Configuring and enabling network interfaces<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">></span> default: Rsyncing folder: /cygdrive/c/Users/Administrator/ <span class="token operator">=</span><span class="token operator">></span> /vagrant

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>vagrant ssh 开启SSH，并登陆到centos7</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ vagrant <span class="token function">ssh</span>
<span class="token punctuation">[</span>vagrant@localhost ~<span class="token punctuation">]</span>$ <span class="token function">ip</span> addr
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span>
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.0</span>.2.15/24 brd <span class="token number">10.0</span>.2.255 scope global noprefixroute dynamic eth0
       valid_lft 86091sec preferred_lft 86091sec
    inet6 fe80::5054:ff:fe8a:fee6/64 scope <span class="token function">link</span>
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 08:00:27:d1:76:f6 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.56.102/24 brd <span class="token number">192.168</span>.56.255 scope global noprefixroute dynamic eth1
       valid_lft 892sec preferred_lft 892sec
    inet6 fe80::8c94:1942:ba09:2458/64 scope <span class="token function">link</span> noprefixroute
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>vagrant@localhost ~<span class="token punctuation">]</span>$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>









<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>Administrator<span class="token operator">></span>ipconfig

Windows IP 配置

以太网适配器 VirtualBox Host-Only Network:

   连接特定的 DNS 后缀 <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span>
   本地链接 IPv6 地址. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> fe80::a00c:1ffa:a39a:c8c2%16
   IPv4 地址 <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">192.168</span>.56.1
   子网掩码  <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">255.255</span>.255.0
   默认网关. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<p>配置网络信息，打开”Vagrantfile”文件：</p>
<pre class="line-numbers language-none"><code class="language-none">config.vm.network &quot;private_network&quot;, ip: &quot;192.168.56.10&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>修改完成后，重启启动vagrant</p>
<pre class="line-numbers language-none"><code class="language-none">vagrant reload<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>检查宿主机和virtualBox之间的通信是否正常</p>
<pre class="line-numbers language-none"><code class="language-none">[vagrant@localhost ~]$ ping 192.168.43.43                                                                                                         PING 192.168.43.43 (192.168.43.43) 56(84) bytes of data.
64 bytes from 192.168.43.43: icmp_seq&#x3D;1 ttl&#x3D;127 time&#x3D;0.533 ms
64 bytes from 192.168.43.43: icmp_seq&#x3D;2 ttl&#x3D;127 time&#x3D;0.659 ms

--- 192.168.43.43 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 999ms
rtt min&#x2F;avg&#x2F;max&#x2F;mdev &#x3D; 0.533&#x2F;0.596&#x2F;0.659&#x2F;0.063 ms
[vagrant@localhost ~]$
[vagrant@localhost ~]$
[vagrant@localhost ~]$ ping www.baidu.com
PING www.a.shifen.com (112.80.248.76) 56(84) bytes of data.
64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq&#x3D;1 ttl&#x3D;53 time&#x3D;56.1 ms
64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq&#x3D;2 ttl&#x3D;53 time&#x3D;58.5 ms
64 bytes from 112.80.248.76 (112.80.248.76): icmp_seq&#x3D;3 ttl&#x3D;53 time&#x3D;53.4 ms
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>开启远程登陆，修改“/etc/ssh/sshd_config”</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">PermitRootLogin <span class="token function">yes</span> 
PasswordAuthentication <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>然后重启SSHD</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl restart sshd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>使用Xshell或SecureCRT进行远程连接。</p>
<p><img src="/img/spring-cloud/image-20200503174735162.png" alt="image-20200503174735162"></p>
<h2 id="2-docker中安装mysql"><a href="#2-docker中安装mysql" class="headerlink" title="2. docker中安装mysql"></a>2. docker中安装mysql</h2><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># docker pull mysql:5.7</span>
<span class="token number">5.7</span>: Pulling from library/mysql
123275d6e508: Already exists 
27cddf5c7140: Pull complete 
c17d442e14c9: Pull complete 
2eb72ffed068: Pull complete 
d4aa125eb616: Pull complete 
52560afb169c: Pull complete 
68190f37a1d2: Pull complete 
3fd1dc6e2990: Pull complete 
85a79b83df29: Pull complete 
35e0b437fe88: Pull complete 
992f6a10268c: Pull complete 
Digest: sha256:82b72085b2fcff073a6616b84c7c3bcbb36e2d13af838cec11a9ed1d0b183f5e
Status: Downloaded newer image <span class="token keyword">for</span> mysql:5.7
docker.io/library/mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看镜像</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop-104 module]# docker images
REPOSITORY  TAG    IMAGE ID     CREATED       SIZE
mysql       5.7    f5829c0eee9e 2 hours ago   455MB
[root@hadoop-104 module]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>启动mysql</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> docker run -p <span class="token number">3306</span>:3306 --name mysql <span class="token punctuation">\</span>
-v /mydata/mysql/log:/var/log/mysql <span class="token punctuation">\</span>
-v /mydata/mysql/data:/var/lib/mysql <span class="token punctuation">\</span>
-v /mydata/mysql/conf:/etc/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root <span class="token punctuation">\</span>
-d mysql:5.7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改配置</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">[root@hadoop-104</span> <span class="token attr-value">conf]# pwd</span>
/mydata/mysql/conf


<span class="token attr-name">[root@hadoop-104</span> <span class="token attr-value">conf]# cat my.cnf</span>
[client]
<span class="token attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token attr-value">utf8</span>
[mysql]
<span class="token attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token attr-value">utf8</span>
[mysqld]
<span class="token attr-name">init_connect</span><span class="token punctuation">=</span><span class="token attr-value">'SET collation_connection = utf8_unicode_ci'</span>
<span class="token attr-name">init_connect</span><span class="token punctuation">=</span><span class="token attr-value">'SET NAMES utf8'</span>
<span class="token attr-name">character-set-server</span><span class="token punctuation">=</span><span class="token attr-value">utf8</span>
<span class="token attr-name">collation-server</span><span class="token punctuation">=</span><span class="token attr-value">utf8_unicode_ci</span>
skip-character-set-client-handshake
skip-name-resolve
<span class="token attr-name">[root@hadoop-104</span> <span class="token attr-value">conf]# </span>

<span class="token attr-name">[root@hadoop-104</span> <span class="token attr-value">conf]# docker restart mysql</span>
mysql
<span class="token attr-name">[root@hadoop-104</span> <span class="token attr-value">conf]# </span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>进入容器查看配置：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 conf<span class="token punctuation">]</span><span class="token comment"># docker exec -it mysql /bin/bash</span>
root@b3a74e031bd7:/<span class="token comment"># whereis mysql</span>
mysql: /usr/bin/mysql /usr/lib/mysql /etc/mysql /usr/share/mysql

root@b3a74e031bd7:/<span class="token comment"># ls /etc/mysql </span>
my.cnf
root@b3a74e031bd7:/<span class="token comment"># cat /etc/mysql/my.cnf </span>
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8
<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
default-character-set<span class="token operator">=</span>utf8
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET collation_connection = utf8_unicode_ci'</span>
<span class="token assign-left variable">init_connect</span><span class="token operator">=</span><span class="token string">'SET NAMES utf8'</span>
character-set-server<span class="token operator">=</span>utf8
collation-server<span class="token operator">=</span>utf8_unicode_ci
skip-character-set-client-handshake
skip-name-resolve
root@b3a74e031bd7:/<span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>设置启动docker时，即运行mysql</p>
<pre class="line-numbers language-none"><code class="language-none">[root@hadoop-104 ~]# docker update mysql --restart&#x3D;always
mysql
[root@hadoop-104 ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h2 id="3-docker中安装redis"><a href="#3-docker中安装redis" class="headerlink" title="3. docker中安装redis"></a>3. docker中安装redis</h2><p>下载docker</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker pull redis</span>
Using default tag: latest
latest: Pulling from library/redis
123275d6e508: Already exists 
f2edbd6a658e: Pull complete 
66960bede47c: Pull complete 
79dc0b596c90: Pull complete 
de36df38e0b6: Pull complete 
602cd484ff92: Pull complete 
Digest: sha256:1d0b903e3770c2c3c79961b73a53e963f4fd4b2674c2c4911472e8a054cb5728
Status: Downloaded newer image <span class="token keyword">for</span> redis:latest
docker.io/library/redis:latest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>启动docker</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /mydata/redis/conf</span>
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># touch /mydata/redis/conf/redis.conf</span>
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># echo "appendonly yes"  >> /mydata/redis/conf/redis.conf</span>
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker run -p 6379:6379 --name redis -v /mydata/redis/data:/data \</span>
<span class="token operator">></span> -v /mydata/redis/conf/redis.conf:/etc/redis/redis.conf <span class="token punctuation">\</span>
<span class="token operator">></span> -d redis redis-server /etc/redis/redis.conf
ce7ae709711986e3f90c9278b284fe6f51f1c1102ba05f3692f0e934ceca1565
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 连接到docker的redis</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it redis redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span class="token builtin class-name">set</span> key1 v1
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> get key1
<span class="token string">"v1"</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>设置redis容器在docker启动的时候启动</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># docker update redis --restart=always</span>
redis
<span class="token punctuation">[</span>root@hadoop-104 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h2 id="4-创建maven工程"><a href="#4-创建maven工程" class="headerlink" title="4. 创建maven工程"></a>4. 创建maven工程</h2><h2 id="5-执行sql脚本"><a href="#5-执行sql脚本" class="headerlink" title="5. 执行sql脚本"></a>5. 执行sql脚本</h2><p>gulimall_oms.sql<br>gulimall_pms.sql<br>gulimall_sms.sql<br>gulimall_ums.sql<br>gulimall_wms.sql<br>pms_catelog.sql<br>sys_menus.sql</p>
<h2 id="6-clone-人人开源"><a href="#6-clone-人人开源" class="headerlink" title="6. clone 人人开源"></a>6. clone 人人开源</h2><p><a target="_blank" rel="noopener" href="https://gitee.com/renrenio">https://gitee.com/renrenio</a></p>
<p><img src="/img/spring-cloud/1587609877028.png" alt="1587609877028"></p>
<p>克隆到本地：</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">git</span> clone https://gitee.com/renrenio/renren-fast-vue.git

<span class="token function">git</span> clone https://gitee.com/renrenio/renren-fast.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>将拷贝下来的“renren-fast”删除“.git”后，拷贝到“gulimall”工程根目录下，然后将它作为gulimall的一个module</p>
<p>创建“gulimall_admin”的数据库，然后执行“renren-fast/db/mysql.sql”中的SQl脚本</p>
<p>修改“application-dev.yml”文件，默认为dev环境，修改连接mysql的url和用户名密码</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
            <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.137.14<span class="token punctuation">:</span>3306/gulimall_admin<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;serverTimezone=Asia/Shanghai</span>
            <span class="token key atrule">username</span><span class="token punctuation">:</span> root
            <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>启动“gulimall_admin”，然后访问“<a target="_blank" rel="noopener" href="http://localhost:8080/renren-fast/">http://localhost:8080/renren-fast/</a>”</p>
<p><img src="/img/spring-cloud/1587616296253.png" alt="1587616296253"></p>
<p>安装node.js，并且安装仓库</p>
<pre class="line-numbers language-none"><code class="language-none">npm config set registry http:&#x2F;&#x2F;registry.npm.taobao.org&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">PS D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue<span class="token operator">></span> <span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry http://registry.npm.taobao.org/
PS D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue<span class="token operator">></span> <span class="token function">npm</span> <span class="token function">install</span>
<span class="token function">npm</span> WARN ajv-keywords@1.5.1 requires a peer of ajv@<span class="token operator">></span><span class="token operator">=</span><span class="token number">4.10</span>.0 but none is installed. You must <span class="token function">install</span> peer dependencies yourself.
<span class="token function">npm</span> WARN sass-loader@6.0.6 requires a peer of node-sass@^4.0.0 but none is installed. You must <span class="token function">install</span> peer dependencies yourself.
<span class="token function">npm</span> WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.2.9 <span class="token punctuation">(</span>node_modules<span class="token punctuation">\</span>fsevents<span class="token punctuation">)</span>:
<span class="token function">npm</span> WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform <span class="token keyword">for</span> fsevents@1.2.9: wanted <span class="token punctuation">&#123;</span><span class="token string">"os"</span><span class="token builtin class-name">:</span><span class="token string">"darwin"</span>,<span class="token string">"arch"</span><span class="token builtin class-name">:</span><span class="token string">"any"</span><span class="token punctuation">&#125;</span> <span class="token punctuation">(</span>current: <span class="token punctuation">&#123;</span><span class="token string">"os"</span><span class="token builtin class-name">:</span><span class="token string">"win32"</span>,<span class="token string">"arch"</span><span class="token builtin class-name">:</span><span class="token string">"x64"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

up to <span class="token function">date</span> <span class="token keyword">in</span> <span class="token number">17</span>.227s
PS D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue<span class="token operator">></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">PS D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue<span class="token operator">></span> <span class="token function">npm</span> run dev

<span class="token operator">></span> renren-fast-vue@1.2.2 dev D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue
<span class="token operator">></span> webpack-dev-server --inline --progress --config build/webpack.dev.conf.js

 <span class="token number">10</span>% building modules <span class="token number">5</span>/10 modules <span class="token number">5</span> active <span class="token punctuation">..</span>.-0<span class="token operator">!</span>D:<span class="token punctuation">\</span>tmp<span class="token punctuation">\</span>renren-fast-vue<span class="token punctuation">\</span>src<span class="token punctuation">\</span>main.js<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'cat'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>Use <span class="token variable"><span class="token variable">`</span>node --trace-warnings <span class="token punctuation">..</span>.<span class="token variable">`</span></span> to show where the warning was created<span class="token punctuation">)</span>
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'cd'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'chmod'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'cp'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'dirs'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'pushd'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'popd'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'echo'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'tempdir'</span> of module exports inside circular dependency
<span class="token punctuation">(</span>node:19864<span class="token punctuation">)</span> Warning: Accessing non-existent property <span class="token string">'pwd'</span> of module exports inside circular dependency<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>常见问题1：“Module build failed: Error: Cannot find module ‘node-sass”</p>
<p>运行过程中，出现“Module build failed: Error: Cannot find module ‘node-sass’报错问题”，解决方法</p>
<blockquote>
<p>用npm install -g cnpm –registry=<a target="_blank" rel="noopener" href="https://registry.npm.taobao.org/">https://registry.npm.taobao.org</a> ，从淘宝镜像那下载，然后cnpm下载成功。</p>
<p>最后输入cnpm install node-sass –save。npm run dev终于能跑起来了！！！<br>————————————————<br>版权声明：本文为CSDN博主「夕阳下美了剪影」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38401285/article/details/86483278">https://blog.csdn.net/qq_38401285/article/details/86483278</a></p>
</blockquote>
<p>常见问题2：cnpm - 解决 “ cnpm : 无法加载文件 C:\Users\93457\AppData\Roaming\npm\cnpm.ps1，因为在此系统上禁止运行脚本。有关详细信息 。。。 “</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/500m/p/11634969.html">https://www.cnblogs.com/500m/p/11634969.html</a></p>
<p>所有问题的根源都在“node_modules”，npm install之前，应该将这个文件夹删除，然后再进行安装和运行。</p>
<p>再次运行npm run dev恢复正常：</p>
<p><img src="/img/spring-cloud/1587637858665.png" alt="1587637858665"></p>
<h2 id="7-clone-renren-generator"><a href="#7-clone-renren-generator" class="headerlink" title="7. clone renren-generator"></a>7. clone renren-generator</h2><h3 id="clone"><a href="#clone" class="headerlink" title="clone"></a>clone</h3><p><a target="_blank" rel="noopener" href="https://gitee.com/renrenio/renren-generator.git">https://gitee.com/renrenio/renren-generator.git</a></p>
<p>然后将该项目放置到“gulimall”的跟路径下，然后添加该Module，并且提交到github上</p>
<h3 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h3><p>renren-generator/src/main/resources/generator.properties</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment">#代码生成器，配置信息</span>

<span class="token attr-name">mainPath</span><span class="token punctuation">=</span><span class="token attr-value">com.bigdata</span>
<span class="token comment">#包名</span>
<span class="token attr-name">package</span><span class="token punctuation">=</span><span class="token attr-value">com.bigdata.gulimall</span>
<span class="token attr-name">moduleName</span><span class="token punctuation">=</span><span class="token attr-value">product</span>
<span class="token comment">#作者</span>
<span class="token attr-name">author</span><span class="token punctuation">=</span><span class="token attr-value">cosmoswong</span>
<span class="token comment">#Email</span>
<span class="token attr-name">email</span><span class="token punctuation">=</span><span class="token attr-value">cosmoswong@sina.com</span>
<span class="token comment">#表前缀(类名不会包含表前缀)</span>
<span class="token attr-name">tablePrefix</span><span class="token punctuation">=</span><span class="token attr-value">pms_</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="运行“renren-generator”"><a href="#运行“renren-generator”" class="headerlink" title="运行“renren-generator”"></a>运行“renren-generator”</h3><p>访问：&lt;<a target="_blank" rel="noopener" href="http://localhost/">http://localhost:80/</a></p>
<p><img src="/img/spring-cloud/1587638853416.png" alt="1587638853416"></p>
<p>点击“renren-fast”，能够看到它将“renren-fast”的所有表都列举了出来：</p>
<p><img src="/img/spring-cloud/1587638968519.png" alt="1587638968519"></p>
<p>选择所有的表，然后点击“生成代码”，将下载的“renren.zip”，解压后取出main文件夹，放置到“gulimall-product”项目的main目录中。</p>
<p>下面的几个module，也采用同样的方式来操作。</p>
<p>但是针对于“undo_log”，存在一个问题</p>
<p><img src="/img/spring-cloud/1587657745923.png" alt="1587657745923"></p>
<p>它的数据类型是“longblob”类型，逆向工程后，对应的数据类型未知：</p>
<p><img src="/img/spring-cloud/1587657812283.png" alt="1587657812283"></p>
<p>这个问题该要怎么解决？</p>
<h2 id="8-微服务注册中心"><a href="#8-微服务注册中心" class="headerlink" title="8. 微服务注册中心"></a>8. 微服务注册中心</h2><p>要注意nacos集群所在的server，一定要关闭防火墙，否则容易出现各种问题。</p>
<p>搭建nacos集群，然后分别启动各个微服务，将它们注册到Nacos中。</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">application</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>coupon
<span class="token key atrule">cloud</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>查看注册情况：</p>
<p><a target="_blank" rel="noopener" href="http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=">http://192.168.137.14:8848/nacos/#/serviceManagement?dataId=&amp;group=&amp;appName=&amp;namespace=</a></p>
<p><img src="/img/spring-cloud/1587694451601.png" alt="1587694451601"></p>
<h2 id="9-使用openfen"><a href="#9-使用openfen" class="headerlink" title="9. 使用openfen"></a>9. 使用openfen</h2><p>1)、引入open-feign</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>2)、编写一个接口，告诉SpringCLoud这个接口需要调用远程服务</p>
<p>修改“com.bigdata.gulimall.coupon.controller.CouponController”，添加以下controller方法：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/member/list"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">memberCoupons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">CouponEntity</span> couponEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CouponEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    couponEntity<span class="token punctuation">.</span><span class="token function">setCouponName</span><span class="token punctuation">(</span><span class="token string">"discount 20%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"coupons"</span><span class="token punctuation">,</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>couponEntity<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>新建“com.bigdata.gulimall.member.feign.CouponFeignService”接口</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span><span class="token string">"gulimall_coupon"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CouponFeignService</span> <span class="token punctuation">&#123;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/coupon/coupon/member/list"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">memberCoupons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>修改“com.bigdata.gulimall.member.GulimallMemberApplication”类，添加上”@EnableFeignClients”：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.bigdata.gulimall.member.feign"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallMemberApplication</span> <span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GulimallMemberApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>​    声明接口的每一个方法都是调用哪个远程服务的那个请求</p>
<p>3)、开启远程调用功能</p>
<p>com.bigdata.gulimall.member.controller.MemberController</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/coupons"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">MemberEntity</span> memberEntity<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">MemberEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    memberEntity<span class="token punctuation">.</span><span class="token function">setNickname</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">R</span> memberCoupons <span class="token operator">=</span> couponFeignService<span class="token punctuation">.</span><span class="token function">memberCoupons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> memberCoupons<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"member"</span><span class="token punctuation">,</span>memberEntity<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"coupons"</span><span class="token punctuation">,</span>memberCoupons<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"coupons"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>(4)、访问<a target="_blank" rel="noopener" href="http://localhost:8000/member/member/coupons">http://localhost:8000/member/member/coupons</a></p>
<p><img src="/img/spring-cloud/1587701348764.png" alt="1587701348764"></p>
<p>停止“gulimall-coupon”服务，能够看到注册中心显示该服务的健康值为0：</p>
<p><img src="/img/spring-cloud/1587701521184.png" alt="1587701521184"></p>
<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8000/member/member/coupons">http://localhost:8000/member/member/coupons</a></p>
<p><img src="/img/spring-cloud/1587701587456.png" alt="1587701587456"></p>
<p>启动“gulimall-coupon”服务，再次访问，又恢复了正常。</p>
<h2 id="10-配置中心"><a href="#10-配置中心" class="headerlink" title="10. 配置中心"></a>10. 配置中心</h2><h3 id="1）修改“gulimall-coupon”模块"><a href="#1）修改“gulimall-coupon”模块" class="headerlink" title="1）修改“gulimall-coupon”模块"></a>1）修改“gulimall-coupon”模块</h3><p>添加pom依赖：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>创建bootstrap.properties文件，该配置文件会优先于“application.yml”加载。</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-coupon</span>
<span class="token attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="2）传统方式"><a href="#2）传统方式" class="headerlink" title="2）传统方式"></a>2）传统方式</h3><p>为了详细说明config的使用方法，先来看原始的方式</p>
<p>创建“application.properties”配置文件，添加如下配置内容：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">coupon.user.name</span><span class="token punctuation">=</span><span class="token attr-value">"zhangsan"</span>
<span class="token attr-name">coupon.user.age</span><span class="token punctuation">=</span><span class="token attr-value">30</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>修改“com.bigdata.gulimall.coupon.controller.CouponController”文件，添加如下内容：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;coupon.user.name&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;coupon.user.age&#125;"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>启动“gulimall-coupon”服务：</p>
<p>访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test&gt;">http://localhost:7000/coupon/coupon/test&gt;</a></p>
<p><img src="/img/spring-cloud/1587716583668.png" alt="1587716583668"></p>
<p>这样做存在的一个问题，如果频繁的修改application.properties，在需要频繁重新打包部署。下面我们将采用Nacos的配置中心来解决这个问题。</p>
<h3 id="3）nacos-config"><a href="#3）nacos-config" class="headerlink" title="3）nacos config"></a>3）nacos config</h3><p>1、在Nacos注册中心中，点击“配置列表”，添加配置规则：</p>
<p><img src="/img/spring-cloud/1587716911435.png" alt="1587716911435"></p>
<p>DataID：gulimall-coupon</p>
<p>配置格式：properties</p>
<p>文件的命名规则为：${spring.application.name}-${spring.profiles.active}.${spring.cloud.nacos.config.file-extension}</p>
<p>${spring.application.name}：为微服务名</p>
<p>${spring.profiles.active}：指明是哪种环境下的配置，如dev、test或info</p>
<p>${spring.cloud.nacos.config.file-extension}：配置文件的扩展名，可以为properties、yml等</p>
<p>2、查看配置：</p>
<p><img src="/img/spring-cloud/1587717125580.png" alt="1587717125580"></p>
<p>3、修改“com.bigdata.gulimall.coupon.controller.CouponController”类，添加“@RefreshScope”注解</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"coupon/coupon"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CouponController</span> <span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>这样都会动态的从配置中心读取配置.</p>
<p>4、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src="/img/spring-cloud/1587717485283.png" alt="1587717485283"></p>
<p>能够看到读取到了nacos 中的最新的配置信息，并且在指明了相同的配置信息时，配置中心中设置的值优先于本地配置。</p>
<h3 id="4）Nacos支持三种配置加载方方案"><a href="#4）Nacos支持三种配置加载方方案" class="headerlink" title="4）Nacos支持三种配置加载方方案"></a>4）Nacos支持三种配置加载方方案</h3><p>Nacos支持“Namespace+group+data ID”的配置解决方案。</p>
<p>详情见：<a target="_blank" rel="noopener" href="https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc">https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-docs/src/main/asciidoc-zh/nacos-config.adoc</a></p>
<h5 id="Namespace方案"><a href="#Namespace方案" class="headerlink" title="Namespace方案"></a>Namespace方案</h5><p>通过命名空间实现环境区分</p>
<p>下面是配置实例：</p>
<p>1、创建命名空间：</p>
<p>“命名空间”—&gt;“创建命名空间”：</p>
<p><img src="/img/spring-cloud/1587718802109.png" alt="1587718802109"></p>
<p> 创建三个命名空间，分别为dev，test和prop</p>
<p>2、回到配置列表中，能够看到所创建的三个命名空间</p>
<p><img src="/img/spring-cloud/1587718889316.png" alt="1587718889316"></p>
<p>下面我们需要在dev命名空间下，创建“gulimall-coupon.properties”配置规则：</p>
<p><img src="/img/spring-cloud/1587719108947.png" alt="1587719108947"></p>
<p>3、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src="/img/spring-cloud/1587721184218.png" alt="1587721184218"></p>
<p>并没有使用我们在dev命名空间下所配置的规则，而是使用的是public命名空间下所配置的规则，这是怎么回事呢？</p>
<p>查看“gulimall-coupon”服务的启动日志：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">24.158</span>  WARN <span class="token number">32792</span> <span class="token operator">---</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> c<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c<span class="token punctuation">.</span>n<span class="token punctuation">.</span>c<span class="token punctuation">.</span>NacosPropertySourceBuilder     <span class="token punctuation">:</span> Ignore the empty nacos configuration <span class="token keyword">and</span> get it based on dataId<span class="token punctuation">[</span>gulimall<span class="token operator">-</span>coupon<span class="token punctuation">]</span> <span class="token operator">&amp;</span> group<span class="token punctuation">[</span>DEFAULT_GROUP<span class="token punctuation">]</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">24.163</span>  INFO <span class="token number">32792</span> <span class="token operator">---</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> c<span class="token punctuation">.</span>a<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token keyword">config</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span>JVMUtil    <span class="token punctuation">:</span> isMultiInstance<span class="token punctuation">:</span>false
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">24</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">37</span><span class="token punctuation">:</span><span class="token number">24.169</span>  INFO <span class="token number">32792</span> <span class="token operator">---</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> b<span class="token punctuation">.</span>c<span class="token punctuation">.</span>PropertySourceBootstrapConfiguration <span class="token punctuation">:</span> Located <span class="token keyword">property</span> source<span class="token punctuation">:</span> <span class="token punctuation">[</span>BootstrapPropertySource <span class="token operator">&#123;</span>name<span class="token operator">=</span>'bootstrapProperties<span class="token operator">-</span>gulimall<span class="token operator">-</span>coupon<span class="token punctuation">.</span>properties<span class="token punctuation">,</span>DEFAULT_GROUP'<span class="token operator">&#125;</span><span class="token punctuation">,</span> BootstrapPropertySource <span class="token operator">&#123;</span>name<span class="token operator">=</span>'bootstrapProperties<span class="token operator">-</span>gulimall<span class="token operator">-</span>coupon<span class="token punctuation">,</span>DEFAULT_GROUP'<span class="token operator">&#125;</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>**”gulimall-coupon.properties”**，默认就是public命名空间中的内容中所配置的规则。</p>
<p>4、指定命名空间</p>
<p>如果想要使得我们自定义的命名空间生效，需要在“bootstrap.properties”文件中，指定使用哪个命名空间：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">a2c83f0b-e0a8-40fb-9b26-1e9d61be7d6d</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这个命名空间ID来源于我们在第一步所创建的命名空间</p>
<p><img src="/img/spring-cloud/1587718802109.png" alt="1587718802109"></p>
<p>5、重启“gulimall-coupon”，再次访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src="/img/spring-cloud/1587720311349.png" alt="1587720311349"></p>
<p>但是这种命名空间的粒度还是不够细化，对此我们可以为项目的每个微服务module创建一个命名空间。</p>
<p>6、为所有微服务创建命名空间</p>
<p><img src="/img/spring-cloud/1587720714101.png" alt="1587720714101"></p>
<p>7、回到配置列表选项卡，克隆pulic的配置规则到coupon命名空间下</p>
<p><img src="/img/spring-cloud/1587720883244.png" alt="1587720883244"></p>
<p>切换到coupon命名空间下，查看所克隆的规则：</p>
<p><img src="/img/spring-cloud/1587720963699.png" alt="1587720963699"></p>
<p>8、修改“gulimall-coupon”下的bootstrap.properties文件，添加如下配置信息</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">7905c915-64ad-4066-8ea9-ef63918e5f79</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这里指明的是，读取时使用coupon命名空间下的配置。</p>
<p>9、重启“gulimall-coupon”，访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src="/img/spring-cloud/1587721184218.png" alt="1587721184218"></p>
<h5 id="DataID方案"><a href="#DataID方案" class="headerlink" title="DataID方案"></a>DataID方案</h5><p>通过指定spring.profile.active和配置文件的DataID，来使不同环境下读取不同的配置，读取配置时，使用的是默认命名空间public，默认分组（default_group）下的DataID。</p>
<p>默认情况，Namespace=public，Group=DEFAULT GROUP，默认Cluster是DEFAULT</p>
<h5 id="Group方案"><a href="#Group方案" class="headerlink" title="Group方案"></a>Group方案</h5><p>通过Group实现环境区分</p>
<p>实例：通过使用不同的组，来读取不同的配置，还是以上面的gulimall-coupon微服务为例</p>
<p>1、新建“gulimall-coupon.properties”，将它置于“tmp”组下</p>
<p><img src="/img/spring-cloud/1587721616021.png" alt="1587721616021"></p>
<p>2、修改“bootstrap.properties”配置，添加如下的配置</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.group</span><span class="token punctuation">=</span><span class="token attr-value">tmp</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3、重启“gulimall-coupon”，访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p><img src="/img/spring-cloud/1587721844449.png" alt="1587721844449"></p>
<h3 id="5）同时加载多个配置集"><a href="#5）同时加载多个配置集" class="headerlink" title="5）同时加载多个配置集"></a>5）同时加载多个配置集</h3><p>当微服务数量很庞大时，将所有配置都书写到一个配置文件中，显然不是太合适。对此我们可以将配置按照功能的不同，拆分为不同的配置文件。</p>
<p>如下面的配置文件：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token comment">#MySQL配置</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.137.14<span class="token punctuation">:</span>3306/gulimall_sms<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root

  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>coupon
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span class="token punctuation">:</span><span class="token number">8848</span>



<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">**/*.xml</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>我们可以将，</p>
<p>数据源有关的配置写到一个配置文件中：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token comment">#MySQL配置</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.137.14<span class="token punctuation">:</span>3306/gulimall_sms<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和框架有关的写到另外一个配置文件中：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">**/*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>也可以将上面的这些配置交给nacos来进行管理。</p>
<p>实例：将“gulimall-coupon”的“application.yml”文件拆分为多个配置，并放置到nacos配置中心</p>
<p>1、创建“datasource.yml”，用于存储和数据源有关的配置</p>
<pre class="line-numbers language-yml" data-language="yml"><code class="language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token comment">#MySQL配置</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.137.14<span class="token punctuation">:</span>3306/gulimall_sms<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在coupon命名空间中，创建“datasource.yml”配置</p>
<p><img src="/img/spring-cloud/1587722798375.png" alt="1587722798375"></p>
<p>2、将和mybatis相关的配置，放置到“mybatis.yml”中</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">**/*.xml</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="/img/spring-cloud/1587722710432.png" alt="1587722710432"></p>
<p>3、创建“other.yml”配置，保存其他的配置信息</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">7000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>coupon
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span class="token punctuation">:</span><span class="token number">8848</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="/img/spring-cloud/1587722998265.png" alt="1587722998265"></p>
<p>现在“mybatis.yml”、“datasource.yml”和“other.yml”共同构成了微服务的配置。</p>
<p>4、修改“gulimall-coupon”的“bootstrap.properties”文件，加载“mybatis.yml”、“datasource.yml”和“other.yml”配置</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].data-id</span><span class="token punctuation">=</span><span class="token attr-value">mybatis.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].group</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span>

<span class="token attr-name">spring.cloud.nacos.config.extension-configs[1].data-id</span><span class="token punctuation">=</span><span class="token attr-value">datasource.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[1].group</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[1].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span>


<span class="token attr-name">spring.cloud.nacos.config.extension-configs[2].data-id</span><span class="token punctuation">=</span><span class="token attr-value">other.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[2].group</span><span class="token punctuation">=</span><span class="token attr-value">dev</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[2].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>“spring.cloud.nacos.config.ext-config”已经被废弃，建议使用“spring.cloud.nacos.config.extension-configs”</p>
<p>5、注释“application.yml”文件中的所有配置</p>
<p>6、重启“gulimall-coupon”服务，然后访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/test">http://localhost:7000/coupon/coupon/test</a></p>
<p> <img src="/img/spring-cloud/1587724212905.png" alt="1587724212905"></p>
<p>7、访问：<a target="_blank" rel="noopener" href="http://localhost:7000/coupon/coupon/list">http://localhost:7000/coupon/coupon/list</a>，查看是否能够正常的访问数据库</p>
<p><img src="/img/spring-cloud/1587724350548.png" alt="1587724350548"></p>
<p>小结：</p>
<p>1)、微服务任何配置信息，任何配置文件都可以放在配置中心；</p>
<p>2)、只需要在bootstrap.properties中，说明加载配置中心的哪些配置文件即可；</p>
<p>3)、@Value, @ConfigurationProperties。都可以用来获取配置中心中所配置的信息；</p>
<p>4)、配置中心有的优先使用配置中心中的，没有则使用本地的配置。</p>
<h2 id="11-网关"><a href="#11-网关" class="headerlink" title="11. 网关"></a>11. 网关</h2><h3 id="1、注册“gulimall-gateway”到Nacos"><a href="#1、注册“gulimall-gateway”到Nacos" class="headerlink" title="1、注册“gulimall-gateway”到Nacos"></a>1、注册“gulimall-gateway”到Nacos</h3><h4 id="1）创建“gulimall-gateway”"><a href="#1）创建“gulimall-gateway”" class="headerlink" title="1）创建“gulimall-gateway”"></a>1）创建“gulimall-gateway”</h4><p>SpringCloud gateway</p>
<h4 id="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"><a href="#2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖" class="headerlink" title="2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖"></a>2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.bigdata.gulimall<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>gulimall-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解"><a href="#3）“com-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication”类上加上“-EnableDiscoveryClient”注解" class="headerlink" title="3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解"></a>3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解</h4><h4 id="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”"><a href="#4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway-yml”" class="headerlink" title="4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”"></a>4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”</h4><p><img src="/img/spring-cloud/1587729576178.png" alt="1587729576178"></p>
<h4 id="5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间"><a href="#5）创建“bootstrap-properties”文件，添加如下配置，指明配置中心地址和所属命名空间" class="headerlink" title="5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间"></a>5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间</h4><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-gateway</span>
<span class="token attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span>
<span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">1c82552e-1af0-4ced-9a48-26f19c2d315f</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h4 id="6）创建“application-properties”文件，指定服务名和注册中心地址"><a href="#6）创建“application-properties”文件，指定服务名和注册中心地址" class="headerlink" title="6）创建“application.properties”文件，指定服务名和注册中心地址"></a>6）创建“application.properties”文件，指定服务名和注册中心地址</h4><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-gateway</span>
<span class="token attr-name">spring.cloud.nacos.discovery.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span>
<span class="token attr-name">server.port</span><span class="token punctuation">=</span><span class="token attr-value">88</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h4 id="7）启动“gulimall-gateway”"><a href="#7）启动“gulimall-gateway”" class="headerlink" title="7）启动“gulimall-gateway”"></a>7）启动“gulimall-gateway”</h4><p>启动报错：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog">Description<span class="token punctuation">:</span>

Failed to configure a DataSource<span class="token punctuation">:</span> 'url' attribute is <span class="token keyword">not</span> specified <span class="token keyword">and</span> no embedded datasource could be configured<span class="token punctuation">.</span>

Reason<span class="token punctuation">:</span> Failed to determine a suitable driver <span class="token keyword">class</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解决方法：在“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”中排除和数据源相关的配置</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>重新启动</p>
<p>访问：<a target="_blank" rel="noopener" href="http://192.168.137.14:8848/nacos/#">http://192.168.137.14:8848/nacos/#</a>，查看到该服务已经注册到了Nacos中</p>
<p><img src="/img/spring-cloud/1587730035866.png" alt="1587730035866"></p>
<h3 id="2、案例"><a href="#2、案例" class="headerlink" title="2、案例"></a>2、案例</h3><p>现在想要实现针对于“<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=baidu%E2%80%9D%EF%BC%8C%E8%BD%AC%E5%8F%91%E5%88%B0%E2%80%9Chttps://www.baidu.com%E2%80%9D%EF%BC%8C%E9%92%88%E5%AF%B9%E4%BA%8E%E2%80%9Chttp://localhost:88/hello?url=qq%E2%80%9D%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%8C%E8%BD%AC%E5%8F%91%E5%88%B0%E2%80%9Chttps://www.qq.com/%E2%80%9D">http://localhost:88/hello?url=baidu”，转发到“https://www.baidu.com”，针对于“http://localhost:88/hello?url=qq”的请求，转发到“https://www.qq.com/”</a></p>
<h4 id="1）创建“application-yml”"><a href="#1）创建“application-yml”" class="headerlink" title="1）创建“application.yml”"></a>1）创建“application.yml”</h4><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> baidu_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.baidu.com
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Query=url<span class="token punctuation">,</span> baidu
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> qq_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//www.qq.com/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Query=url<span class="token punctuation">,</span> qq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2）启动“gulimall-gateway”"><a href="#2）启动“gulimall-gateway”" class="headerlink" title="2）启动“gulimall-gateway”"></a>2）启动“gulimall-gateway”</h4><h4 id="3）测试"><a href="#3）测试" class="headerlink" title="3）测试"></a>3）测试</h4><p>访问：<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=baidu">http://localhost:88/hello?url=baidu</a></p>
<p>访问：<a target="_blank" rel="noopener" href="http://localhost:88/hello?url=qq">http://localhost:88/hello?url=qq</a></p>
<h2 id="12-Vue"><a href="#12-Vue" class="headerlink" title="12. Vue"></a>12. Vue</h2><p>安装vue</p>
<pre class="line-numbers language-none"><code class="language-none"># 最新稳定版
$ npm install vue<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="1、vue声明式渲染"><a href="#1、vue声明式渲染" class="headerlink" title="1、vue声明式渲染"></a>1、vue声明式渲染</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">
<span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    el<span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span><span class="token comment">//绑定元素</span>
    data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//封装数据</span>
        name<span class="token operator">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span>
        num<span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    methods<span class="token operator">:</span><span class="token punctuation">&#123;</span>  <span class="token comment">//封装方法</span>
        <span class="token function">cancle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">--</span> <span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="2、双向绑定-模型变化，视图变化。反之亦然"><a href="#2、双向绑定-模型变化，视图变化。反之亦然" class="headerlink" title="2、双向绑定,模型变化，视图变化。反之亦然"></a>2、双向绑定,模型变化，视图变化。反之亦然</h3><p>双向绑定使用v-model</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>num<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>h1<span class="token operator">></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">,</span>非常帅，有<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>num<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>个人为他点赞<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<img src="images/1587746815353.png" alt="1587746815353" style="zoom: 67%;" />

<h3 id="3、事件处理"><a href="#3、事件处理" class="headerlink" title="3、事件处理"></a>3、事件处理</h3><p>v-xx：指令<br>1、创建vue实例，关联页面的模板，将自己的数据（data）渲染到关联的模板，响应式的<br>2、指令来简化对dom的一些操作。<br>3、声明方法来做更复杂的操作。methods里面可以封装方法。</p>
<p>v-on是按钮的单击事件：</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;button v-on:click&#x3D;&quot;num++&quot;&gt;点赞&lt;&#x2F;button&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>在VUE中el,data和vue的作用:</p>
<ul>
<li>el：用来绑定数据；</li>
<li>data:用来封装数据；</li>
<li>methods：用来封装方法，并且能够封装多个方法，如何上面封装了cancell和hello方法。</li>
</ul>
<p>安装“Vue 2 Snippets”，用来做代码提示</p>
<p><img src="/img/spring-cloud/1587747283279.png" alt="1587747283279"></p>
<p>为了方便的在浏览器上调试VUE程序，需要安装“<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-devtools">vue-devtools</a>”，编译后安装到chrome中即可。</p>
<p>详细的使用方法见：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/63f09651724c">Vue调试神器vue-devtools安装</a></p>
<p>“v-html”不会对于HTML标签进行转义，而是直接在浏览器上显示data所设置的内容;而“ v-text”会对html标签进行转义</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span>
    <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>msg<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>span v<span class="token operator">-</span>html<span class="token operator">=</span><span class="token string">"msg"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
    <span class="token operator">&lt;</span>br<span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span>span v<span class="token operator">-</span>text<span class="token operator">=</span><span class="token string">"msg"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
   
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../node_modules/vue/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
    <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        el<span class="token operator">:</span><span class="token string">"#app"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span><span class="token punctuation">&#123;</span>
            msg<span class="token operator">:</span><span class="token string">"&lt;h1>Hello&lt;/h1>"</span><span class="token punctuation">,</span>
            link<span class="token operator">:</span><span class="token string">"http://www.baidu.com"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        methods<span class="token operator">:</span><span class="token punctuation">&#123;</span>
            <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"World"</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>运行结果：</p>
<p><img src="/img/spring-cloud/1587748494597.png" alt="1587748494597"></p>
    :称为差值表达式，它必须要写在Html表达式，可以完成数学运算和方法调用



<h3 id="4、v-bind-单向绑定"><a href="#4、v-bind-单向绑定" class="headerlink" title="4、v-bind :单向绑定"></a>4、v-bind :单向绑定</h3><p>给html标签的属性绑定</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 给html标签的属性绑定 <span class="token operator">--</span><span class="token operator">></span>
   <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span> 

       <span class="token operator">&lt;</span>a v<span class="token operator">-</span>bind<span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"link"</span><span class="token operator">></span>gogogo<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">></span>

       <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token keyword">class</span><span class="token punctuation">,</span>style  <span class="token punctuation">&#123;</span><span class="token keyword">class</span>名：加上？<span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">></span>
       <span class="token operator">&lt;</span>span v<span class="token operator">-</span>bind<span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"&#123;active:isActive,'text-danger':hasError&#125;"</span>
         <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">"&#123;color: color1,fontSize: size&#125;"</span><span class="token operator">></span>你好<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>

   <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>

   <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"../node_modules/vue/dist/vue.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span>

   <span class="token operator">&lt;</span>script<span class="token operator">></span>
       <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
           el<span class="token operator">:</span><span class="token string">"#app"</span><span class="token punctuation">,</span>
           data<span class="token operator">:</span><span class="token punctuation">&#123;</span>
               link<span class="token operator">:</span> <span class="token string">"http://www.baidu.com"</span><span class="token punctuation">,</span>
               isActive<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
               hasError<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
               color1<span class="token operator">:</span><span class="token string">'red'</span><span class="token punctuation">,</span>
               size<span class="token operator">:</span><span class="token string">'36px'</span>
           <span class="token punctuation">&#125;</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
   <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面所完成的任务就是给a标签绑定一个超链接。并且当“isActive”和“hasError”都是true的时候，将属性动态的绑定到，则绑定该“active”和 “text-danger”class。这样可以动态的调整属性的存在。</p>
<p>而且如果想要实现修改vm的”color1”和“size”， span元素的style也能够随之变化，则可以写作v-bind:style，也可以省略v-bind。</p>
<h3 id="5、v-model双向绑定"><a href="#5、v-model双向绑定" class="headerlink" title="5、v-model双向绑定"></a>5、v-model双向绑定</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>


    <span class="token comment">&lt;!-- 表单项，自定义组件 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

        精通的语言：
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>language<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Java<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>language<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PHP<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> PHP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>checkbox<span class="token punctuation">"</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>language<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Python<span class="token punctuation">"</span></span><span class="token punctuation">></span></span> Python<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
        选中了 &#123;&#123;language.join(",")&#125;&#125;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../node_modules/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            el<span class="token operator">:</span><span class="token string">"#app"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span><span class="token punctuation">&#123;</span>
                language<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面完成的功能就是通过 <code>v-model</code> 为输入框绑定多个值，能够实现选中的值，在data的language也在不断的发生着变化，</p>
<p><img src="/img/spring-cloud/image-20200425090955705.png" alt="image-20200425090955705"></p>
<p>如果在控制台上指定 <code>vm.language=[&quot;Java&quot;,&quot;PHP&quot;]</code>，则data值也会跟着变化。</p>
<p><img src="/img/spring-cloud/image-20200425091736505.png" alt="image-20200425091736505"></p>
<p>通过“v-model”实现了页面发生了变化，则数据也发生变化，数据发生变化，则页面也发生变化，这样就实现了双向绑定。</p>
<p>数组的连接操作： 选中了 <code>&#123;&#123;language.join(",")&#125;&#125;</code></p>
<h3 id="6、v-on为按钮绑定事件"><a href="#6、v-on为按钮绑定事件" class="headerlink" title="6、v-on为按钮绑定事件"></a>6、v-on为按钮绑定事件</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>事件中直接写js片段<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button v<span class="token operator">-</span>on<span class="token operator">:</span>click<span class="token operator">=</span><span class="token string">"num++"</span><span class="token operator">></span>点赞<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>事件指定一个回调函数，必须是Vue实例中定义的函数<span class="token operator">--</span><span class="token operator">></span>
<span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">"cancle"</span><span class="token operator">></span>取消<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面是为两个按钮绑定了单击事件，其中一个对于num进行自增，另外一个自减。</p>
<p>v-on:click也可以写作@click</p>
<p>事件的冒泡：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 事件修饰符 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">border</span><span class="token punctuation">:</span> 1px solid red<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    大div
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">border</span><span class="token punctuation">:</span> 1px solid blue<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        小div <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.baidu.com<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>去百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的这两个嵌套div中，如果点击了内层的div，则外层的div也会被触发；这种问题可以事件修饰符来完成：</p>
<pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!-- 事件修饰符 --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">border</span><span class="token punctuation">:</span> 1px solid red<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name"><span class="token namespace">v-on:</span>click.once</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    大div
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">border</span><span class="token punctuation">:</span> 1px solid blue<span class="token punctuation">;</span><span class="token property">padding</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span> <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        小div <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.baidu.com<span class="token punctuation">"</span></span> <span class="token attr-name">@click.prevent.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>hello<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>去百度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!--这里禁止了超链接的点击跳转操作，并且只会触发当前对象的操作--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>关于事件修饰符：</p>
<p><img src="/img/spring-cloud/image-20200425094010008.png" alt="image-20200425094010008"></p>
<p>按键修饰符：</p>
<p><img src="/img/spring-cloud/image-20200425094247167.png" alt="image-20200425094247167"></p>
<p><img src="/img/spring-cloud/image-20200425100629676.png" alt="image-20200425100629676"></p>
<h3 id="7、v-for遍历循环"><a href="#7、v-for遍历循环" class="headerlink" title="7、v-for遍历循环"></a>7、v-for遍历循环</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(user,index) in users<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.name<span class="token punctuation">"</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user.gender == <span class="token punctuation">'</span>女<span class="token punctuation">'</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 1、显示user信息：v-for="item in items" --></span>
               当前索引：&#123;&#123;index&#125;&#125; ==> &#123;&#123;user.name&#125;&#125;  ==>   &#123;&#123;user.gender&#125;&#125; ==>&#123;&#123;user.age&#125;&#125; <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 2、获取数组下标：v-for="(item,index) in items" --></span>
                <span class="token comment">&lt;!-- 3、遍历对象：
                        v-for="value in object"
                        v-for="(value,key) in object"
                        v-for="(value,key,index) in object" 
                --></span>
                对象信息：
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(v,k,i) in user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123;k&#125;&#125;==&#123;&#123;v&#125;&#125;==&#123;&#123;i&#125;&#125;；<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
                <span class="token comment">&lt;!-- 4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率 --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>

            
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(num,index) in nums<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../node_modules/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">         
        <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            el<span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                users<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'柳岩'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'女'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">21</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'范冰冰'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'女'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">24</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'刘亦菲'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'女'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'古力娜扎'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token string">'女'</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">25</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                nums<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4、遍历的时候都加上:key来区分不同数据，提高vue渲染效率</p>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token comment">&lt;!-- 过滤器常用来处理文本格式化的操作。过滤器可以用在两个地方：双花括号插值和 v-bind 表达式 --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user in userList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
                &#123;&#123;user.id&#125;&#125; ==> &#123;&#123;user.name&#125;&#125; ==> &#123;&#123;user.gender == 1?"男":"女"&#125;&#125; ==>
                &#123;&#123;user.gender | genderFilter&#125;&#125; ==> &#123;&#123;user.gender | gFilter&#125;&#125;
                <span class="token comment">&lt;!-- 这里的"|"表示的管道，将user.gender的值交给genderFilter --></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../node_modules/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">// 全局过滤器 </span>
        Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">"gFilter"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"男~~~"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token string">"女~~~"</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>

        <span class="token keyword">let</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            el<span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                userList<span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'jacky'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                    <span class="token punctuation">&#123;</span> id<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'peter'</span><span class="token punctuation">,</span> gender<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span>
                <span class="token punctuation">]</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            filters<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//// filters 定义局部过滤器，只可以在当前vue实例中使用</span>
                <span class="token function">genderFilter</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token string">"男"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> <span class="token string">"女"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="组件化"><a href="#组件化" class="headerlink" title="组件化"></a>组件化</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>count++<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>我被点击了 &#123;&#123;count&#125;&#125; 次<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>counter</span><span class="token punctuation">></span></span>
        <span class="token comment">&lt;!-- 使用所定义的组件button-counter --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button-counter</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button-counter</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../node_modules/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">//1、全局声明注册一个组件</span>
        Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">"counter"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
            template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button v-on:click="count++">我被点击了 &#123;&#123;count&#125;&#125; 次&lt;/button></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                    count<span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//2、局部声明一个组件</span>
        <span class="token keyword">const</span> buttonCounter <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button v-on:click="count++">我被点击了 &#123;&#123;count&#125;&#125; 次~~~&lt;/button></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>
                    count<span class="token operator">:</span> <span class="token number">1</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

        <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            el<span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                count<span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            components<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">//声明所定义的局部组件</span>
                <span class="token string">'button-counter'</span><span class="token operator">:</span> buttonCounter
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="/img/spring-cloud/image-20200425110048496.png" alt="image-20200425110048496"></p>
<h3 id="生命周期钩子函数"><a href="#生命周期钩子函数" class="headerlink" title="生命周期钩子函数"></a>生命周期钩子函数</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ie=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>num<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123;num&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>num++<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>赞！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">></span></span>&#123;&#123;name&#125;&#125;，有&#123;&#123;num&#125;&#125;个人点赞<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>../node_modules/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
            el<span class="token operator">:</span> <span class="token string">"#app"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                name<span class="token operator">:</span> <span class="token string">"张三"</span><span class="token punctuation">,</span>
                num<span class="token operator">:</span> <span class="token number">100</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            methods<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
                <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
                <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========beforeCreate============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"数据模型未加载："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"方法未加载："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板未加载："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========created============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"数据模型已加载："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"方法已加载："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板已加载："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板未渲染："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">beforeMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========beforeMount============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板未渲染："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========mounted============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板已渲染："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">beforeUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========beforeUpdate============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"数据模型已更新："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板未更新："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
            <span class="token function">updated</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"=========updated============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"数据模型已更新："</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"html模板已更新："</span> <span class="token operator">+</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"num"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="13-element-ui"><a href="#13-element-ui" class="headerlink" title="13. element ui"></a>13. element ui</h2><p>官网： <a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">https://element.eleme.cn/#/zh-CN/component/installation</a> </p>
<p>安装</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">npm</span> i element-ui -S<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p> 在 main.js 中写入以下内容： </p>
<pre class="line-numbers language-none"><code class="language-none">import ElementUI  from &#39;element-ui&#39;
import &#39;element-ui&#x2F;lib&#x2F;theme-chalk&#x2F;index.css&#39;;

Vue.use(ElementUI);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="14-递归树形结构获取数据"><a href="#14-递归树形结构获取数据" class="headerlink" title="14. 递归树形结构获取数据"></a>14. 递归树形结构获取数据</h2><p>在注册中心中“product”命名空间中，创建“gulimall-product.yml”配置文件：</p>
<p><img src="/img/spring-cloud/image-20200425153735737.png" alt="image-20200425153735737"></p>
<p>将“application.yml”内容拷贝到该配置文件中</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token comment">#MySQL配置</span>
    <span class="token key atrule">driverClassName</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.137.14<span class="token punctuation">:</span>3306/gulimall_pms<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=UTF-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>product
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span class="token punctuation">:</span><span class="token number">8848</span>


<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>/mapper/<span class="token important">**/*.xml</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在本地创建“bootstrap.properties”文件，指明配置中心的位置和使用到的配置文件：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.application.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-product</span>
<span class="token attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span>
<span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">3c50ffaa-010b-4b59-9372-902e35059232</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].data-id</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-product.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].group</span><span class="token punctuation">=</span><span class="token attr-value">DEFAULT_GROUP</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后启动gulimall-product，查看到该服务已经出现在了nacos的注册中心中了</p>
<p>修改“com.bigdata.gulimall.product.service.CategoryService”类，添加如下代码：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 列表
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/list/tree"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> categoryEntities <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">listWithTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> categoryEntities<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>测试：<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree">http://localhost:10000/product/category/list/tree</a></p>
<p><img src="/img/spring-cloud/image-20200425154348716.png" alt="image-20200425154348716"></p>
<p>如何区别是哪种分类级别？</p>
<p>答：可以通过分类的parent_cid来进行判断，如果是一级分类，其值为0.</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token comment">/**
 * 列表
 */</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/list/tree"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> categoryEntities <span class="token operator">=</span> categoryService<span class="token punctuation">.</span><span class="token function">listWithTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//找到所有的一级分类</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> level1Menus <span class="token operator">=</span> categoryEntities<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-></span> item<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>menu<span class="token operator">-></span><span class="token punctuation">&#123;</span>
                menu<span class="token punctuation">.</span><span class="token function">setChildCategoryEntity</span><span class="token punctuation">(</span><span class="token function">getChildrens</span><span class="token punctuation">(</span>menu<span class="token punctuation">,</span>categoryEntities<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> menu<span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>menu1<span class="token punctuation">,</span> menu2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>

              <span class="token keyword">return</span> <span class="token punctuation">(</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span><span class="token operator">:</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token punctuation">(</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>



    <span class="token keyword">return</span> level1Menus<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> <span class="token function">getChildrens</span><span class="token punctuation">(</span><span class="token class-name">CategoryEntity</span> root<span class="token punctuation">,</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> all<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">CategoryEntity</span><span class="token punctuation">></span></span> childrens <span class="token operator">=</span> all<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span><span class="token function">getParentCid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> root<span class="token punctuation">.</span><span class="token function">getCatId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>item <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        item<span class="token punctuation">.</span><span class="token function">setChildCategoryEntity</span><span class="token punctuation">(</span><span class="token function">getChildrens</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> all<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> item<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>menu1<span class="token punctuation">,</span> menu2<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">?</span> <span class="token number">0</span><span class="token operator">:</span>menu1<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span> <span class="token punctuation">(</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token keyword">null</span><span class="token operator">?</span><span class="token number">0</span><span class="token operator">:</span>menu2<span class="token punctuation">.</span><span class="token function">getSort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> childrens<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>下面是得到的部分JSON数据</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">[</span>
  <span class="token punctuation">&#123;</span>
    <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"图书、音像、电子书刊"</span><span class="token punctuation">,</span>
    <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"电子书刊"</span><span class="token punctuation">,</span>
        <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">165</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"电子书"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">166</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"网络原创"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">167</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"数字杂志"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">168</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"多媒体图书"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span>
        <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"音像"</span><span class="token punctuation">,</span>
        <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
        <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">169</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"音乐"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">170</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"影视"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
          <span class="token punctuation">&#123;</span>
            <span class="token property">"catId"</span><span class="token operator">:</span> <span class="token number">171</span><span class="token punctuation">,</span>
            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"教育音像"</span><span class="token punctuation">,</span>
            <span class="token property">"parentCid"</span><span class="token operator">:</span> <span class="token number">23</span><span class="token punctuation">,</span>
            <span class="token property">"catLevel"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
            <span class="token property">"showStatus"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
            <span class="token property">"sort"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"icon"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productUnit"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
            <span class="token property">"productCount"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token property">"childCategoryEntity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>启动后端项目renren-fast</p>
<p>启动前端项目renren-fast-vue：</p>
<pre class="line-numbers language-none"><code class="language-none">npm run dev<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>访问： <a target="_blank" rel="noopener" href="http://localhost:8001/#/login">http://localhost:8001/#/login</a> </p>
<p>创建一级菜单：</p>
<p><img src="/img/spring-cloud/image-20200425164019287.png" alt="image-20200425164019287"></p>
<p>创建完成后，在后台的管理系统中会创建一条记录：</p>
<p><img src="/img/spring-cloud/image-20200425164201813.png" alt="image-20200425164201813"></p>
<p>然后创建子菜单：</p>
<p><img src="/img/spring-cloud/image-20200425164509143.png" alt="image-20200425164509143"></p>
<p>创建renren-fast-vue\src\views\modules\product目录，子所以是这样来创建，是因为product/category，对应于product-category</p>
<p>在该目录下，新建“category.vue”文件：</p>
<pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>刷新页面出现404异常，查看请求发现，请求的是“<a target="_blank" rel="noopener" href="http://localhost:8080/renren-fast/product/category/list/tree%E2%80%9D">http://localhost:8080/renren-fast/product/category/list/tree”</a></p>
<p><img src="/img/spring-cloud/image-20200425173615149.png" alt="image-20200425173615149"></p>
<p>这个请求是不正确的，正确的请求是：<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree%EF%BC%8C">http://localhost:10000/product/category/list/tree，</a></p>
<p>修正这个问题：</p>
<p>替换“static\config\index.js”文件中的“window.SITE_CONFIG[‘baseUrl’]”</p>
<p>替换前：</p>
<pre class="line-numbers language-none"><code class="language-none">window.SITE_CONFIG[&#39;baseUrl&#39;] &#x3D; &#39;http:&#x2F;&#x2F;localhost:8080&#x2F;renren-fast&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>替换后：</p>
<pre class="line-numbers language-none"><code class="language-none">window.SITE_CONFIG[&#39;baseUrl&#39;] &#x3D; &#39;http:&#x2F;&#x2F;localhost:88&#x2F;api&#39;;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a href="http://localhost:88，这个地址是我们网关微服务的接口。">http://localhost:88，这个地址是我们网关微服务的接口。</a></p>
<p>这里我们需要通过网关来完成路径的映射，因此将renren-fast注册到nacos注册中心中，并添加配置中心</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> renren<span class="token punctuation">-</span>fast
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span class="token punctuation">:</span><span class="token number">8848</span>

      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> renren<span class="token punctuation">-</span>fast
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.8848
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ee409c3f<span class="token punctuation">-</span>3206<span class="token punctuation">-</span>4a3b<span class="token punctuation">-</span>ba65<span class="token punctuation">-</span>7376922a886d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>配置网关路由，前台的所有请求都是经由“<a target="_blank" rel="noopener" href="http://localhost:88/api%E2%80%9D%E6%9D%A5%E8%BD%AC%E5%8F%91%E7%9A%84%EF%BC%8C%E5%9C%A8%E2%80%9Cgulimall-gateway%E2%80%9D%E4%B8%AD%E6%B7%BB%E5%8A%A0%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%EF%BC%9A">http://localhost:88/api”来转发的，在“gulimall-gateway”中添加路由规则：</a></p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> admin_route
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//renren<span class="token punctuation">-</span>fast
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>但是这样做也引入了另外的一个问题，再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login%EF%BC%8C%E5%8F%91%E7%8E%B0%E9%AA%8C%E8%AF%81%E7%A0%81%E4%B8%8D%E5%86%8D%E6%98%BE%E7%A4%BA%EF%BC%9A">http://localhost:8001/#/login，发现验证码不再显示：</a></p>
<p>分析原因：</p>
<ol>
<li>现在的验证码请求路径为，<a target="_blank" rel="noopener" href="http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:88/api/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
<li>原始的验证码请求路径：<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6">http://localhost:8001/renren-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</a></li>
</ol>
<p>在admin_route的路由规则下，在访问路径中包含了“api”，因此它会将它转发到renren-fast，网关在转发的时候，会使用网关的前缀信息，为了能够正常的取得验证码，我们需要对请求路径进行重写</p>
<p>关于请求路径重写：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.2.RELEASE/reference/html/#the-rewritepath-gatewayfilter-factory">6.16. The <code>RewritePath</code> <code>GatewayFilter</code> Factory</a></p>
<p>The <code>RewritePath</code> <code>GatewayFilter</code> factory takes a path <code>regexp</code> parameter and a <code>replacement</code> parameter. This uses Java regular expressions for a flexible way to rewrite the request path. The following listing configures a <code>RewritePath</code> <code>GatewayFilter</code>:</p>
<p>Example 41. application.yml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rewritepath_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.org
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Path=/foo/<span class="token important">**</span>
        <span class="token key atrule">filters</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> RewritePath=/red(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">></span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span> $\<span class="token punctuation">&#123;</span>segment<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>For a request path of <code>/red/blue</code>, this sets the path to <code>/blue</code> before making the downstream request. Note that the <code>$</code> should be replaced with <code>$\</code> because of the YAML specification.</p>
<p>修改“admin_route”路由规则：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> admin_route
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//renren<span class="token punctuation">-</span>fast
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/api/<span class="token important">**</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> RewritePath=/api/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">></span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span> /renren<span class="token punctuation">-</span>fast/$\<span class="token punctuation">&#123;</span>segment<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login%EF%BC%8C%E9%AA%8C%E8%AF%81%E7%A0%81%E8%83%BD%E5%A4%9F%E6%AD%A3%E5%B8%B8%E7%9A%84%E5%8A%A0%E8%BD%BD%E4%BA%86%E3%80%82">http://localhost:8001/#/login，验证码能够正常的加载了。</a></p>
<p>但是很不幸新的问题又产生了，访问被拒绝了</p>
<p><img src="/img/spring-cloud/image-20200425192722821.png" alt="image-20200425192722821"></p>
<p> 问题描述：已拦截跨源请求：同源策略禁止读取位于 <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：CORS 头缺少 ‘Access-Control-Allow-Origin’）。 </p>
<p>问题分析：这是一种跨域问题。访问的域名和端口和原来的请求不同，请求就会被限制</p>
<p><img src="/img/spring-cloud/image-20200425192902637.png" alt="image-20200425192902637"></p>
<p>跨域流程：</p>
<p><img src="/img/spring-cloud/image-20200425193136641.png" alt="image-20200425193136641"></p>
<p><img src="/img/spring-cloud/image-20200425193523849.png" alt="image-20200425193523849"></p>
<p><img src="/img/spring-cloud/image-20200425193614185.png" alt="image-20200425193614185"></p>
<p>解决方法：在网关中定义“GulimallCorsConfiguration”类，该类用来做过滤，允许所有的请求跨域。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallCorsConfiguration</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">CorsWebFilter</span> <span class="token function">corsWebFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">UrlBasedCorsConfigurationSource</span> source<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">UrlBasedCorsConfigurationSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">CorsConfiguration</span> corsConfiguration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CorsConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedHeader</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedMethod</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">addAllowedOrigin</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        corsConfiguration<span class="token punctuation">.</span><span class="token function">setAllowCredentials</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        source<span class="token punctuation">.</span><span class="token function">registerCorsConfiguration</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">,</span>corsConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CorsWebFilter</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>再次访问：<a target="_blank" rel="noopener" href="http://localhost:8001/#/login">http://localhost:8001/#/login</a></p>
<p><img src="/img/spring-cloud/image-20200425195437299.png" alt="image-20200425195437299"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8001/renre%E5%B7%B2%E6%8B%A6%E6%88%AA%E8%B7%A8%E6%BA%90%E8%AF%B7%E6%B1%82%EF%BC%9A%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E7%A6%81%E6%AD%A2%E8%AF%BB%E5%8F%96%E4%BD%8D%E4%BA%8E">http://localhost:8001/renre已拦截跨源请求：同源策略禁止读取位于</a> <a target="_blank" rel="noopener" href="http://localhost:88/api/sys/login">http://localhost:88/api/sys/login</a> 的远程资源。（原因：不允许有多个 ‘Access-Control-Allow-Origin’ CORS 头）n-fast/captcha.jpg?uuid=69c79f02-d15b-478a-8465-a07fd09001e6</p>
<p>出现了多个请求，并且也存在多个跨源请求。</p>
<p>为了解决这个问题，需要修改renren-fast项目，注释掉“io.renren.config.CorsConfig”类。然后再次进行访问。</p>
<p>在显示分类信息的时候，出现了404异常，请求的<a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/list/tree%E4%B8%8D%E5%AD%98%E5%9C%A8">http://localhost:88/api/product/category/list/tree不存在</a></p>
<p><img src="/img/spring-cloud/image-20200425213240724.png" alt="image-20200425213240724"></p>
<p>这是因为网关上所做的路径映射不正确，映射后的路径为<a target="_blank" rel="noopener" href="http://localhost:8001/renren-fast/product/category/list/tree">http://localhost:8001/renren-fast/product/category/list/tree</a></p>
<p>但是只有通过<a target="_blank" rel="noopener" href="http://localhost:10000/product/category/list/tree%E8%B7%AF%E5%BE%84%E6%89%8D%E8%83%BD%E5%A4%9F%E6%AD%A3%E5%B8%B8%E8%AE%BF%E9%97%AE%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BC%9A%E6%8A%A5404%E5%BC%82%E5%B8%B8%E3%80%82">http://localhost:10000/product/category/list/tree路径才能够正常访问，所以会报404异常。</a></p>
<p>解决方法就是定义一个product路由规则，进行路径重写：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> product_route
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>product
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/api/product/<span class="token important">**</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> RewritePath=/api/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">></span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span>/$\<span class="token punctuation">&#123;</span>segment<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在路由规则的顺序上，将精确的路由规则放置到模糊的路由规则的前面，否则的话，精确的路由规则将不会被匹配到，类似于异常体系中try catch子句中异常的处理顺序。</p>
<h2 id="15-删除数据"><a href="#15-删除数据" class="headerlink" title="15. 删除数据"></a>15. 删除数据</h2><p>添加delete和append标识，并且增加复选框</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-tree
   :data&#x3D;&quot;menus&quot;
   show-checkbox  &#x2F;&#x2F;显示复选框
   :props&#x3D;&quot;defaultProps&quot;  
   :expand-on-click-node&#x3D;&quot;false&quot; &#x2F;&#x2F;设置节点点击时不展开
   node-key&#x3D;&quot;catId&quot;   
 &gt;
   &lt;span class&#x3D;&quot;custom-tree-node&quot; slot-scope&#x3D;&quot;&#123; node, data &#125;&quot;&gt;
     &lt;span&gt;&#123;&#123; node.label &#125;&#125;&lt;&#x2F;span&gt;
     &lt;span&gt;
       &lt;el-button v-if&#x3D;&quot;node.level &lt;&#x3D; 2&quot; type&#x3D;&quot;text&quot; size&#x3D;&quot;mini&quot; @click&#x3D;&quot;() &#x3D;&gt; append(data)&quot;&gt;Append&lt;&#x2F;el-button&gt;
       &lt;el-button
         v-if&#x3D;&quot;node.childNodes.length &#x3D;&#x3D; 0&quot;
         type&#x3D;&quot;text&quot;
         size&#x3D;&quot;mini&quot;
         @click&#x3D;&quot;() &#x3D;&gt; remove(node, data)&quot;
       &gt;Delete&lt;&#x2F;el-button&gt;
     &lt;&#x2F;span&gt;
   &lt;&#x2F;span&gt;
 &lt;&#x2F;el-tree&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>测试删除数据，打开postman输入“ <a target="_blank" rel="noopener" href="http://localhost:88/api/product/category/delete">http://localhost:88/api/product/category/delete</a> ”，请求方式设置为POST，为了比对效果，可以在删除之前查询数据库的pms_category表：</p>
<p><img src="/img/spring-cloud/image-20200426112814069.png" alt="image-20200426112814069"></p>
<p>由于delete请求接收的是一个数组，所以这里使用JSON方式，传入了一个数组：</p>
<p><img src="/img/spring-cloud/image-20200426113003531.png" alt="image-20200426113003531"></p>
<p>再次查询数据库能够看到cat_id为1000的数据已经被删除了。</p>
<p>修改“com.bigdata.gulimall.product.controller.CategoryController”类，添加如下代码：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"> <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">Long</span><span class="token punctuation">[</span><span class="token punctuation">]</span> catIds<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token comment">//删除之前需要判断待删除的菜单那是否被别的地方所引用。</span>
<span class="token comment">//		categoryService.removeByIds(Arrays.asList(catIds));</span>

        categoryService<span class="token punctuation">.</span><span class="token function">removeMenuByIds</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>catIds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>com.bigdata.gulimall.product.service.impl.CategoryServiceImpl</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span>   <span class="token keyword">void</span> <span class="token function">removeMenuByIds</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">></span></span> asList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">//TODO 检查当前的菜单是否被别的地方所引用</span>
    categoryDao<span class="token punctuation">.</span><span class="token function">deleteBatchIds</span><span class="token punctuation">(</span>asList<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>然而多数时候，我们并不希望删除数据，而是标记它被删除了，这就是逻辑删除；</p>
<p>可以设置show_status为0，标记它已经被删除。</p>
<p><img src="/img/spring-cloud/image-20200426115332899.png" alt="image-20200426115332899"></p>
<p>mybatis-plus的逻辑删除：</p>
<p><img src="/img/spring-cloud/image-20200426115420393.png" alt="image-20200426115420393"></p>
<p>配置全局的逻辑删除规则，在“src/main/resources/application.yml”文件中添加如下内容：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
    <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
      <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
      <span class="token key atrule">logic-delete-value</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">logic-not-delete-value</span><span class="token punctuation">:</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>修改“com.bigdata.gulimall.product.entity.CategoryEntity”类，添加上@TableLogic，表明使用逻辑删除：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 是否显示[0-不显示，1显示]
 */</span>
<span class="token annotation punctuation">@TableLogic</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">,</span>delval <span class="token operator">=</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> showStatus<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后在POSTMan中测试一下是否能够满足需要。另外在“src/main/resources/application.yml”文件中，设置日志级别，打印出SQL语句：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com.bigdata.gulimall.product</span><span class="token punctuation">:</span> debug<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>打印的日志：</p>
<pre class="line-numbers language-verilog" data-language="verilog"><code class="language-verilog"><span class="token operator">==></span>  Preparing<span class="token punctuation">:</span> UPDATE pms_category SET show_status<span class="token operator">=</span><span class="token number">0</span> WHERE cat_id IN <span class="token punctuation">(</span> <span class="token operator">?</span> <span class="token punctuation">)</span> AND show_status<span class="token operator">=</span><span class="token number">1</span> 
<span class="token operator">==></span> Parameters<span class="token punctuation">:</span> <span class="token function">1431</span><span class="token punctuation">(</span>Long<span class="token punctuation">)</span>
<span class="token operator">&lt;==</span>    Updates<span class="token punctuation">:</span> <span class="token number">1</span>
get changedGroupKeys<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="16-菜单拖动"><a href="#16-菜单拖动" class="headerlink" title="16. 菜单拖动"></a>16. 菜单拖动</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>同一个菜单内拖动</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单的前面或后面</td>
<td>正常</td>
</tr>
<tr>
<td>拖动到父菜单同级的另外一个菜单中</td>
<td>正常</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>关注的焦点在于，拖动到目标节点中，使得目标节点的catlevel+deep小于3即可。拖动到目标节点前后的条件是，使得</p>
<h3 id="拖动菜单时需要修改顺序和级别"><a href="#拖动菜单时需要修改顺序和级别" class="headerlink" title="拖动菜单时需要修改顺序和级别"></a>拖动菜单时需要修改顺序和级别</h3><p>需要考虑两种类型节点的catLevel</p>
<p>一种关系是：如果是同一个节点下的子节点的前后移动，则不需要修改其catLevel</p>
<p>如果是拖动到另外一个节点内或父节点中，则要考虑修改其catLevel</p>
<p>如果拖动到与父节点平级的节点关系中，则要将该拖动的节点的catLevel，设置为兄弟节点的Level，</p>
<p>先考虑parentCid还是先考虑catLevel?</p>
<p>两种关系在耦合</p>
<p>另外还有一种是前后拖动的情况</p>
<p>哪个范围最大？</p>
<p>肯定是拖动类型关系最大，</p>
<p>如果是前后拖动，则拖动后需要看待拖动节点的层级和设置待拖动节点的parentId，</p>
<p>​       如果待拖动节点和目标节点的层级相同，则认为是同级拖动，只需要修改节点的先后顺序即可；</p>
<p>​       否则认为是跨级拖动，则需要修改层级和重新设置parentID</p>
<p>​              如果</p>
<p>​      以拖动类型来分，并不合适，比较合适的是跨级拖动和同级拖动</p>
<p>如何判断是跨级拖动还是同级拖动，根据拖动的层级来看，如果是同一级的拖动，只需要修改先后顺序即可，但是这样也会存在一个问题，就是当拖动到另外一个分组下的同级目录中，显然也需要修改parentID，究竟什么样的模型最好呢？</p>
<p>  另外也可以判断在跨级移动时，跨级后的parentID是否相同，如果不相同，则认为是在不同目录下的跨级移动需要修改parentID。</p>
<p>顺序、catLevel和parentID</p>
<p>同级移动：</p>
<p>（1）首先判断待移动节点和目标节点的catLevel是否相同，</p>
<p> （2）相同则认为是同级移动，</p>
<p>​          如果此时移动后目标节点的parentID和待移动节点的相同，但是移动类型是前后移动，只需要调整顺序即可，此时移动类型是inner，则需要修改catLevel和parentId和顺序</p>
<p>​         如果此时移动后目标节点的parentID和待移动节点的不相同，但是移动类型是前后移动，则需要调整顺序和parentId，此时移动类型是inner，则需要修改catLevel和parentId和顺序</p>
<p>通过这两步的操作能看到一些共性，如果抽取移动类型作为大的分类，则在这种分类下，</p>
<p>如果是前后移动，则分为下面几种情况：</p>
<p>​    同级别下的前后移动：界定标准为catLevel相同，但是又可以分为parentID相同和parentID不同，parent相同时，只需要修改顺序即可；parentID不同时，需要修改parentID和顺序</p>
<p>​    不同级别下的前后移动：界定标准为catLevel不同，此时无论如何都要修改parentID，顺序和catLevel</p>
<p>如果是inner类型移动，则分为一下的几种情况。</p>
<p>​     此时不论是同级inner，还是跨级innner，都需要修改parentID，顺序和catLevel</p>
<p>哪种情况需要更新子节点呢？</p>
<p>那就要看要拖拽的节点是否含有子节点，如果有子节点，则需要更新子节点的catLevel，不需要更新它之间的顺序和parentId，只需要更新catLevel即可。这种更新子节点的Level应该归类，目前的目标是只要有子节点就更新它的catLevel，</p>
<p>（2）如果待移动节点和目标节点的catLevel不同，则认为是跨级移动。如果是移动到父节点中，则需要设置catLevel，parentID和顺序。此时需要分两种情况来考虑，如果是移动到父节点中，则需要设置catLevel，parentID和顺序，如果是移动到兄弟节点中，则需要设置</p>
<p>包含移动到父节点同级目录，兄弟节点中。</p>
<h3 id="设置菜单拖动开关"><a href="#设置菜单拖动开关" class="headerlink" title="设置菜单拖动开关"></a>设置菜单拖动开关</h3><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-switch v-model&#x3D;&quot;draggable&quot; active-text&#x3D;&quot;开启拖拽&quot; inactive-text&#x3D;&quot;关闭拖拽&quot;&gt;&lt;&#x2F;el-switch&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>但是现在存在的一个问题是每次拖拽的时候，都会发送请求，更新数据库这样频繁的与数据库交互，现在想要实现一个拖拽过程中不更新数据库，拖拽完成后，统一提交拖拽后的数据。</p>
<p>现在还存在一个问题，如果是将一个菜单连续的拖拽，最终还放到了原来的位置，但是updateNode中却出现了很多节点更新信息，这样显然也是一个问题。</p>
<h3 id="批量删除"><a href="#批量删除" class="headerlink" title="批量删除"></a>批量删除</h3><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-button type&#x3D;&quot;danger&quot; plain size&#x3D;&quot;small&quot; @click&#x3D;&quot;batchDelete&quot;&gt;批量删除&lt;&#x2F;el-button&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//批量删除</span>
   <span class="token function">batchDelete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">let</span> checkNodes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>menuTree<span class="token punctuation">.</span><span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

     <span class="token comment">//  console.log("被选中的节点：",checkNodes);</span>

     <span class="token keyword">let</span> catIds <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> checkNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       catIds<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>checkNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>

     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$confirm</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">确定要删除?</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
       confirmButtonText<span class="token operator">:</span> <span class="token string">"确定"</span><span class="token punctuation">,</span>
       cancelButtonText<span class="token operator">:</span> <span class="token string">"取消"</span><span class="token punctuation">,</span>
       type<span class="token operator">:</span> <span class="token string">"warning"</span>
     <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
           url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">"/product/category/delete"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
           method<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
           data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span>catIds<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
             message<span class="token operator">:</span> <span class="token string">"菜单批量删除成功"</span><span class="token punctuation">,</span>
             type<span class="token operator">:</span> <span class="token string">"success"</span>
           <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//重新刷新页面</span>
           <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMeus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
       <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
         <span class="token comment">//取消删除</span>
       <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="17-品牌管理菜单"><a href="#17-品牌管理菜单" class="headerlink" title="17. 品牌管理菜单"></a>17. 品牌管理菜单</h2><p><img src="/img/spring-cloud/image-20200428164054517.png" alt="image-20200428164054517"></p>
<p>（2）将“”逆向工程得到的resources\src\views\modules\product文件拷贝到gulimall/renren-fast-vue/src/views/modules/product目录下，也就是下面的两个文件</p>
<p>brand.vue  brand-add-or-update.vue</p>
<p>但是显示的页面没有新增和删除功能，这是因为权限控制的原因，</p>
<p><img src="/img/spring-cloud/image-20200428170325515.png" alt="image-20200428170325515"></p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-button v-if&#x3D;&quot;isAuth(&#39;product:brand:save&#39;)&quot; type&#x3D;&quot;primary&quot; @click&#x3D;&quot;addOrUpdateHandle()&quot;&gt;新增&lt;&#x2F;el-button&gt;
&lt;el-button v-if&#x3D;&quot;isAuth(&#39;product:brand:delete&#39;)&quot; type&#x3D;&quot;danger&quot; @click&#x3D;&quot;deleteHandle()&quot; :disabled&#x3D;&quot;dataListSelections.length &lt;&#x3D; 0&quot;&gt;批量删除&lt;&#x2F;el-button&gt;
      <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>查看“isAuth”的定义位置：</p>
<p><img src="/img/spring-cloud/image-20200428170437592.png" alt="image-20200428170437592"></p>
<p>它是在“index.js”中定义，现在将它设置为返回值为true，即可显示添加和删除功能。</p>
<p>再次刷新页面能够看到，按钮已经出现了：</p>
<p><img src="/img/spring-cloud/image-20200428170644511.png" alt="image-20200428170644511"></p>
<h3 id="添加“显示状态按钮”"><a href="#添加“显示状态按钮”" class="headerlink" title="添加“显示状态按钮”"></a>添加“显示状态按钮”</h3><p>brand.vue</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template slot-scope&#x3D;&quot;scope&quot;&gt;
  &lt;el-switch
    v-model&#x3D;&quot;scope.row.showStatus&quot;
    active-color&#x3D;&quot;#13ce66&quot;
    inactive-color&#x3D;&quot;#ff4949&quot;
    @change&#x3D;&quot;updateBrandStatus(scope.row)&quot;
    :active-value &#x3D; &quot;1&quot;
    :inactive-value	&#x3D; &quot;0&quot;
  &gt;&lt;&#x2F;el-switch&gt;
&lt;&#x2F;template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>brand-add-or-update.vue</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-form-item label&#x3D;&quot;显示状态&quot; prop&#x3D;&quot;showStatus&quot;&gt;
   &lt;el-switch v-model&#x3D;&quot;dataForm.showStatus&quot; active-color&#x3D;&quot;#13ce66&quot; inactive-color&#x3D;&quot;#ff4949&quot;&gt;&lt;&#x2F;el-switch&gt;
&lt;&#x2F;el-form-item&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//更新开关的状态</span>
    <span class="token function">updateBrandStatus</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"最新状态"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> <span class="token punctuation">&#123;</span>brandId<span class="token punctuation">,</span>showStatus<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$http</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
        url<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornUrl</span><span class="token punctuation">(</span><span class="token string">"/product/brand/update"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        method<span class="token operator">:</span> <span class="token string">"post"</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$http<span class="token punctuation">.</span><span class="token function">adornData</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>brandId<span class="token punctuation">,</span>showStatus<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$message</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
          message<span class="token operator">:</span> <span class="token string">"状态更新成功"</span><span class="token punctuation">,</span>
          type<span class="token operator">:</span> <span class="token string">"success"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h3 id="添加上传"><a href="#添加上传" class="headerlink" title="添加上传"></a>添加上传</h3><p>和传统的单体应用不同，这里我们选择将数据上传到分布式文件服务器上。</p>
<p>这里我们选择将图片放置到阿里云上，使用对象存储。</p>
<p>阿里云上使使用对象存储方式：</p>
<p><img src="/img/spring-cloud/image-20200428182755992.png" alt="image-20200428182755992"></p>
<p>创建Bucket</p>
<p><img src="/img/spring-cloud/image-20200428183041570.png" alt="image-20200428183041570"></p>
<p>上传文件：</p>
<p><img src="/img/spring-cloud/image-20200428183213694.png" alt="image-20200428183213694"></p>
<p>上传成功后，取得图片的URL</p>
<p><img src="/img/spring-cloud/image-20200428183644020.png" alt="image-20200428183644020"></p>
<p>这种方式是手动上传图片，实际上我们可以在程序中设置自动上传图片到阿里云对象存储。</p>
<p>上传模型：</p>
<p><img src="/img/spring-cloud/image-20200428184029655.png" alt="image-20200428184029655"></p>
<p>查看阿里云关于文件上传的帮助： <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ">https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.768.549d59aaWuZMGJ</a> </p>
<h4 id="1）添加依赖包"><a href="#1）添加依赖包" class="headerlink" title="1）添加依赖包"></a>1）添加依赖包</h4><p>在Maven项目中加入依赖项（推荐方式）</p>
<p>在 Maven 工程中使用 OSS Java SDK，只需在 pom.xml 中加入相应依赖即可。以 3.8.0 版本为例，在 <dependencies> 内加入如下内容：</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.aliyun.oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>aliyun-sdk-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>3.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="2）上传文件流"><a href="#2）上传文件流" class="headerlink" title="2）上传文件流"></a>2）上传文件流</h4><p>以下代码用于上传文件流：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
<span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"http://oss-cn-hangzhou.aliyuncs.com"</span><span class="token punctuation">;</span>
<span class="token comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span>
<span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"&lt;yourAccessKeyId>"</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"&lt;yourAccessKeySecret>"</span><span class="token punctuation">;</span>

<span class="token comment">// 创建OSSClient实例。</span>
<span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 上传文件流。</span>
<span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"&lt;yourlocalFile>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">"&lt;yourBucketName>"</span><span class="token punctuation">,</span> <span class="token string">"&lt;yourObjectName>"</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 关闭OSSClient。</span>
ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>endpoint的取值：</p>
<p><img src="/img/spring-cloud/image-20200428190553350.png" alt="image-20200428190553350"></p>
<p>accessKeyId和accessKeySecret需要创建一个RAM账号：</p>
<p><img src="/img/spring-cloud/image-20200428190532924.png" alt="image-20200428190532924"></p>
<p>创建用户完毕后，会得到一个“AccessKey ID”和“AccessKeySecret”，然后复制这两个值到代码的“AccessKey ID”和“AccessKeySecret”。</p>
<p>另外还需要添加访问控制权限：</p>
<p><img src="/img/spring-cloud/image-20200428191518591.png" alt="image-20200428191518591"></p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
        <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"oss-cn-shanghai.aliyuncs.com"</span><span class="token punctuation">;</span>
        <span class="token comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span>
        <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建OSSClient实例。</span>
        <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 上传文件流。</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">"gulimall-images"</span><span class="token punctuation">,</span> <span class="token string">"time.jpg"</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 关闭OSSClient。</span>
        ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传成功."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>更为简单的使用方式，是使用SpringCloud Alibaba</p>
<p><img src="/img/spring-cloud/image-20200428195507730.png" alt="image-20200428195507730"></p>
<p>详细使用方法，见： <a target="_blank" rel="noopener" href="https://help.aliyun.com/knowledge_detail/108650.html">https://help.aliyun.com/knowledge_detail/108650.html</a>  </p>
<p>（1）添加依赖</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alicloud-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）创建“AccessKey ID”和“AccessKeySecret”</p>
<p>（3）配置key，secret和endpoint相关信息</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">access-key</span><span class="token punctuation">:</span> LTAI4G4W1RA4JXz2QhoDwHhi
<span class="token key atrule">secret-key</span><span class="token punctuation">:</span> R99lmDOJumF2x43ZBKT259Qpe70Oxw
<span class="token key atrule">oss</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>shanghai.aliyuncs.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>（4）注入OSSClient并进行文件上传下载等操作</p>
<p><img src="/img/spring-cloud/image-20200428224840535.png" alt="image-20200428224840535"></p>
<p>但是这样来做还是比较麻烦，如果以后的上传任务都交给gulimall-product来完成，显然耦合度高。最好单独新建一个Module来完成文件上传任务。</p>
<h3 id="其他方式"><a href="#其他方式" class="headerlink" title="其他方式"></a>其他方式</h3><h4 id="1）新建gulimall-third-party"><a href="#1）新建gulimall-third-party" class="headerlink" title="1）新建gulimall-third-party"></a>1）新建gulimall-third-party</h4><h4 id="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"><a href="#2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中" class="headerlink" title="2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中"></a>2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中</h4><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-starter-alicloud-oss<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.0.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.bigdata.gulimall<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>gulimall-common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> 另外也需要在“pom.xml”文件中，添加如下的依赖管理</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">></span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>$&#123;spring-cloud.version&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-cloud-alibaba-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.2.1.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">></span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">></span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">></span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">></span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h4 id="3）在主启动类中开启服务的注册和发现"><a href="#3）在主启动类中开启服务的注册和发现" class="headerlink" title="3）在主启动类中开启服务的注册和发现"></a>3）在主启动类中开启服务的注册和发现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@EnableDiscoveryClient</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="4）在nacos中注册"><a href="#4）在nacos中注册" class="headerlink" title="4）在nacos中注册"></a>4）在nacos中注册</h4><p>（1）创建命名空间“ gulimall-third-party ”</p>
<p><img src="/img/spring-cloud/image-20200429075831984.png" alt="image-20200429075831984"></p>
<p>（2）在“ gulimall-third-party”命名空间中，创建“ gulimall-third-party.yml”文件</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">alicloud</span><span class="token punctuation">:</span>
      <span class="token key atrule">access-key</span><span class="token punctuation">:</span> LTAI4G4W1RA4JXz2QhoDwHhi
      <span class="token key atrule">secret-key</span><span class="token punctuation">:</span> R99lmDOJumF2x43ZBKT259Qpe70Oxw
      <span class="token key atrule">oss</span><span class="token punctuation">:</span>
        <span class="token key atrule">endpoint</span><span class="token punctuation">:</span> oss<span class="token punctuation">-</span>cn<span class="token punctuation">-</span>shanghai.aliyuncs.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="5）编写配置文件"><a href="#5）编写配置文件" class="headerlink" title="5）编写配置文件"></a>5）编写配置文件</h4><p>application.yml</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">30000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>third<span class="token punctuation">-</span>party
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 192.168.137.14<span class="token punctuation">:</span><span class="token number">8848</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com.bigdata.gulimall.product</span><span class="token punctuation">:</span> debug
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>bootstrap.properties</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-third-party</span>
<span class="token attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span>
<span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">f995d8ee-c53a-4d29-8316-a1ef54775e00</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].data-id</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-third-party.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].group</span><span class="token punctuation">=</span><span class="token attr-value">DEFAULT_GROUP</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="6）-编写测试类"><a href="#6）-编写测试类" class="headerlink" title="6） 编写测试类"></a>6） 编写测试类</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>thirdparty</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span>OSS<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSSClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span><span class="token class-name">OSSClientBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileNotFoundException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">GulimallThirdPartyApplicationTests</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OSSClient</span> ossClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testUpload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// Endpoint以杭州为例，其它Region请按实际情况填写。</span>
        <span class="token class-name">String</span> endpoint <span class="token operator">=</span> <span class="token string">"oss-cn-shanghai.aliyuncs.com"</span><span class="token punctuation">;</span>
        <span class="token comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，创建并使用RAM子账号进行API访问或日常运维，请登录 https://ram.console.aliyun.com 创建。</span>
        <span class="token class-name">String</span> accessKeyId <span class="token operator">=</span> <span class="token string">"LTAI4G4W1RA4JXz2QhoDwHhi"</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> accessKeySecret <span class="token operator">=</span> <span class="token string">"R99lmDOJumF2x43ZBKT259Qpe70Oxw"</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建OSSClient实例。</span>
        <span class="token class-name">OSS</span> ossClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OSSClientBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">,</span> accessKeyId<span class="token punctuation">,</span> accessKeySecret<span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token comment">//上传文件流。</span>
        <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Administrator\\Pictures\\timg.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ossClient<span class="token punctuation">.</span><span class="token function">putObject</span><span class="token punctuation">(</span><span class="token string">"gulimall-images"</span><span class="token punctuation">,</span> <span class="token string">"time3.jpg"</span><span class="token punctuation">,</span> inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 关闭OSSClient。</span>
        ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传成功."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p> <a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT">https://help.aliyun.com/document_detail/31926.html?spm=a2c4g.11186623.6.1527.228d74b8V6IZuT</a> </p>
<p><strong>背景</strong></p>
<p>采用JavaScript客户端直接签名（参见<a target="_blank" rel="noopener" href="https://help.aliyun.com/document_detail/31925.html#concept-frd-4gy-5db">JavaScript客户端签名直传</a>）时，AccessKeyID和AcessKeySecret会暴露在前端页面，因此存在严重的安全隐患。因此，OSS提供了服务端签名后直传的方案。</p>
<p><strong>原理介绍</strong></p>
<p><a target="_blank" rel="noopener" href="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6875011751/p1472.png"><img src="http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/6875011751/p1472.png" alt="img"></a></p>
<p>服务端签名后直传的原理如下：</p>
<ol>
<li>用户发送上传Policy请求到应用服务器。</li>
<li>应用服务器返回上传Policy和签名给用户。</li>
<li>用户直接上传数据到OSS。</li>
</ol>
<p>编写“com.bigdata.gulimall.thirdparty.controller.OssController”类：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>thirdparty<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span></span>OSS<span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">BinaryUtil</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">MatchMode</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>oss<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">PolicyConditions</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Value</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedHashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OssController</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">OSS</span> ossClient<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span> <span class="token punctuation">(</span><span class="token string">"$&#123;spring.cloud.alicloud.oss.endpoint&#125;"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> endpoint <span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;spring.cloud.alicloud.oss.bucket&#125;"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> bucket <span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;spring.cloud.alicloud.access-key&#125;"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> accessId <span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"$&#123;spring.cloud.alicloud.secret-key&#125;"</span><span class="token punctuation">)</span>
    <span class="token class-name">String</span> accessKey <span class="token punctuation">;</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/oss/policy"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">policy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>

        <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">"https://"</span> <span class="token operator">+</span> bucket <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> endpoint<span class="token punctuation">;</span> <span class="token comment">// host的格式为 bucketname.endpoint</span>

        <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> dir <span class="token operator">=</span> format<span class="token punctuation">;</span> <span class="token comment">// 用户上传文件时指定的前缀。</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> respMap<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> expireTime <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> expireEndTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expireTime <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
            <span class="token class-name">Date</span> expiration <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>expireEndTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PolicyConditions</span> policyConds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PolicyConditions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            policyConds<span class="token punctuation">.</span><span class="token function">addConditionItem</span><span class="token punctuation">(</span><span class="token class-name">PolicyConditions</span><span class="token punctuation">.</span>COND_CONTENT_LENGTH_RANGE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1048576000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            policyConds<span class="token punctuation">.</span><span class="token function">addConditionItem</span><span class="token punctuation">(</span><span class="token class-name">MatchMode<span class="token punctuation">.</span>StartWith</span><span class="token punctuation">,</span> <span class="token class-name">PolicyConditions</span><span class="token punctuation">.</span>COND_KEY<span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">String</span> postPolicy <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">generatePostPolicy</span><span class="token punctuation">(</span>expiration<span class="token punctuation">,</span> policyConds<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> binaryData <span class="token operator">=</span> postPolicy<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> encodedPolicy <span class="token operator">=</span> <span class="token class-name">BinaryUtil</span><span class="token punctuation">.</span><span class="token function">toBase64String</span><span class="token punctuation">(</span>binaryData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> postSignature <span class="token operator">=</span> ossClient<span class="token punctuation">.</span><span class="token function">calculatePostSignature</span><span class="token punctuation">(</span>postPolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>

            respMap<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"accessid"</span><span class="token punctuation">,</span> accessId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"policy"</span><span class="token punctuation">,</span> encodedPolicy<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"signature"</span><span class="token punctuation">,</span> postSignature<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"dir"</span><span class="token punctuation">,</span> dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"host"</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
            respMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"expire"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>expireEndTime <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// Assert.fail(e.getMessage());</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            ossClient<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> respMap<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>测试： <a target="_blank" rel="noopener" href="http://localhost:30000/oss/policy">http://localhost:30000/oss/policy</a> </p>
<pre class="line-numbers language-none"><code class="language-none">&#123;&quot;accessid&quot;:&quot;LTAI4G4W1RA4JXz2QhoDwHhi&quot;,&quot;policy&quot;:&quot;eyJleHBpcmF0aW9uIjoiMjAyMC0wNC0yOVQwMjo1ODowNy41NzhaIiwiY29uZGl0aW9ucyI6W1siY29udGVudC1sZW5ndGgtcmFuZ2UiLDAsMTA0ODU3NjAwMF0sWyJzdGFydHMtd2l0aCIsIiRrZXkiLCIyMDIwLTA0LTI5LyJdXX0&#x3D;&quot;,&quot;signature&quot;:&quot;s42iRxtxGFmHyG40StM3d9vOfFk&#x3D;&quot;,&quot;dir&quot;:&quot;2020-04-29&#x2F;&quot;,&quot;host&quot;:&quot;https:&#x2F;&#x2F;gulimall-images.oss-cn-shanghai.aliyuncs.com&quot;,&quot;expire&quot;:&quot;1588129087&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>以后在上传文件时的访问路径为“ <a target="_blank" rel="noopener" href="http://localhost:88/api/thirdparty/oss/policy%E2%80%9D%EF%BC%8C">http://localhost:88/api/thirdparty/oss/policy”，</a></p>
<p>在“gulimall-gateway”中配置路由规则：</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> third_party_route
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>gateway
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/api/thirdparty/<span class="token important">**</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> RewritePath=/api/thirdparty/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">></span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span>/$\<span class="token punctuation">&#123;</span>segment<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>测试是否能够正常跳转： <a target="_blank" rel="noopener" href="http://localhost:88/api/thirdparty/oss/policy">http://localhost:88/api/thirdparty/oss/policy</a> </p>
<p><img src="/img/spring-cloud/image-20200429111408164.png" alt="image-20200429111408164"></p>
<h3 id="上传组件"><a href="#上传组件" class="headerlink" title="上传组件"></a>上传组件</h3><p>放置项目提供的upload文件夹到components目录下，一个是单文件上传，另外一个是多文件上传</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">PS D:<span class="token punctuation">\</span>Project<span class="token punctuation">\</span>gulimall<span class="token punctuation">\</span>renren-fast-vue<span class="token punctuation">\</span>src<span class="token punctuation">\</span>components<span class="token punctuation">\</span>upload<span class="token operator">></span> <span class="token function">ls</span>


    目录: D:<span class="token punctuation">\</span>Project<span class="token punctuation">\</span>gulimall<span class="token punctuation">\</span>renren-fast-vue<span class="token punctuation">\</span>src<span class="token punctuation">\</span>components<span class="token punctuation">\</span>upload


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----  <span class="token number">2020</span>/4/29 星期三     <span class="token number">12</span>:0           <span class="token number">3122</span> multiUpload.vue
                                <span class="token number">2</span>
-a----  <span class="token number">2019</span>/11/11 星期一     <span class="token number">21</span>:            <span class="token number">343</span> policy.js
                               <span class="token number">20</span>
-a----  <span class="token number">2020</span>/4/29 星期三     <span class="token number">12</span>:0           <span class="token number">3053</span> singleUpload.vue
                                <span class="token number">1</span>


PS D:<span class="token punctuation">\</span>Project<span class="token punctuation">\</span>gulimall<span class="token punctuation">\</span>renren-fast-vue<span class="token punctuation">\</span>src<span class="token punctuation">\</span>components<span class="token punctuation">\</span>upload<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>修改这两个文件的配置后</p>
<p>开始执行上传，但是在上传过程中，出现了如下的问题：</p>
<p><img src="/img/spring-cloud/image-20200429124629150.png" alt="image-20200429124629150"></p>
<pre class="line-numbers language-none"><code class="language-none">Access to XMLHttpRequest at &#39;http:&#x2F;&#x2F;gulimall-images.oss-cn-shanghai.aliyuncs.com&#x2F;&#39; from origin &#39;http:&#x2F;&#x2F;localhost:8001&#39; has been blocked by CORS policy: Response to preflight request doesn&#39;t pass access control check: No &#39;Access-Control-Allow-Origin&#39; header is present on the requested resource.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这又是一个跨域的问题，解决方法就是在阿里云上开启跨域访问：</p>
<p><img src="/img/spring-cloud/image-20200429124940091.png" alt="image-20200429124940091"></p>
<p>再次执行文件上传。</p>
<h2 id="18-JSR303校验"><a href="#18-JSR303校验" class="headerlink" title="18. JSR303校验"></a>18. JSR303校验</h2><h3 id="步骤1：使用校验注解"><a href="#步骤1：使用校验注解" class="headerlink" title="步骤1：使用校验注解"></a>步骤1：使用校验注解</h3><p>在Java中提供了一系列的校验方式，它这些校验方式在“javax.validation.constraints”包中，提供了如@Email，@NotNull等注解。</p>
<p>在非空处理方式上提供了@NotNull，@Blank和@</p>
<p>（1）@NotNull</p>
<p>The annotated element must not be null. Accepts any type.<br>注解元素禁止为null，能够接收任何类型</p>
<p>（2）@NotEmpty</p>
<p>the annotated element must not be null nor empty.</p>
<p>该注解修饰的字段不能为null或””</p>
<p>Supported types are:</p>
<p>支持以下几种类型</p>
<p>CharSequence (length of character sequence is evaluated)</p>
<p>字符序列（字符序列长度的计算）</p>
<p>Collection (collection size is evaluated)<br>集合长度的计算</p>
<p>Map (map size is evaluated)<br>map长度的计算</p>
<p>Array (array length is evaluated)<br>数组长度的计算</p>
<p>（3）@NotBlank</p>
<p>The annotated element must not be null and must contain at least one non-whitespace character. Accepts CharSequence.<br>该注解不能为null，并且至少包含一个非空白字符。接收字符序列。</p>
<h3 id="步骤2：在请求方法种，使用校验注解-Valid，开启校验，"><a href="#步骤2：在请求方法种，使用校验注解-Valid，开启校验，" class="headerlink" title="步骤2：在请求方法种，使用校验注解@Valid，开启校验，"></a>步骤2：在请求方法种，使用校验注解@Valid，开启校验，</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
brandService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<p>在postman种发送上面的请求</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2020-04-29T09:20:46.383+0000"</span><span class="token punctuation">,</span>
    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
    <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Bad Request"</span><span class="token punctuation">,</span>
    <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"codes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"NotBlank.brandEntity.name"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank.name"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank.java.lang.String"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token property">"codes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"brandEntity.name"</span><span class="token punctuation">,</span>
                        <span class="token string">"name"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                    <span class="token property">"defaultMessage"</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
                    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"name"</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"defaultMessage"</span><span class="token operator">:</span> <span class="token string">"不能为空"</span><span class="token punctuation">,</span>
            <span class="token property">"objectName"</span><span class="token operator">:</span> <span class="token string">"brandEntity"</span><span class="token punctuation">,</span>
            <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
            <span class="token property">"rejectedValue"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"bindingFailure"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"NotBlank"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Validation failed for object='brandEntity'. Error count: 1"</span><span class="token punctuation">,</span>
    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/product/brand/save"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>能够看到”defaultMessage”: “不能为空”，这些错误消息定义在“hibernate-validator”的“\org\hibernate\validator\ValidationMessages_zh_CN.properties”文件中。在该文件中定义了很多的错误规则：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">javax.validation.constraints.AssertFalse.message</span>     <span class="token punctuation">=</span> <span class="token attr-value">只能为false</span>
<span class="token attr-name">javax.validation.constraints.AssertTrue.message</span>      <span class="token punctuation">=</span> <span class="token attr-value">只能为true</span>
<span class="token attr-name">javax.validation.constraints.DecimalMax.message</span>      <span class="token punctuation">=</span> <span class="token attr-value">必须小于或等于&#123;value&#125;</span>
<span class="token attr-name">javax.validation.constraints.DecimalMin.message</span>      <span class="token punctuation">=</span> <span class="token attr-value">必须大于或等于&#123;value&#125;</span>
<span class="token attr-name">javax.validation.constraints.Digits.message</span>          <span class="token punctuation">=</span> <span class="token attr-value">数字的值超出了允许范围(只允许在&#123;integer&#125;位整数和&#123;fraction&#125;位小数范围内)</span>
<span class="token attr-name">javax.validation.constraints.Email.message</span>           <span class="token punctuation">=</span> <span class="token attr-value">不是一个合法的电子邮件地址</span>
<span class="token attr-name">javax.validation.constraints.Future.message</span>          <span class="token punctuation">=</span> <span class="token attr-value">需要是一个将来的时间</span>
<span class="token attr-name">javax.validation.constraints.FutureOrPresent.message</span> <span class="token punctuation">=</span> <span class="token attr-value">需要是一个将来或现在的时间</span>
<span class="token attr-name">javax.validation.constraints.Max.message</span>             <span class="token punctuation">=</span> <span class="token attr-value">最大不能超过&#123;value&#125;</span>
<span class="token attr-name">javax.validation.constraints.Min.message</span>             <span class="token punctuation">=</span> <span class="token attr-value">最小不能小于&#123;value&#125;</span>
<span class="token attr-name">javax.validation.constraints.Negative.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">必须是负数</span>
<span class="token attr-name">javax.validation.constraints.NegativeOrZero.message</span>  <span class="token punctuation">=</span> <span class="token attr-value">必须是负数或零</span>
<span class="token attr-name">javax.validation.constraints.NotBlank.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">不能为空</span>
<span class="token attr-name">javax.validation.constraints.NotEmpty.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">不能为空</span>
<span class="token attr-name">javax.validation.constraints.NotNull.message</span>         <span class="token punctuation">=</span> <span class="token attr-value">不能为null</span>
<span class="token attr-name">javax.validation.constraints.Null.message</span>            <span class="token punctuation">=</span> <span class="token attr-value">必须为null</span>
<span class="token attr-name">javax.validation.constraints.Past.message</span>            <span class="token punctuation">=</span> <span class="token attr-value">需要是一个过去的时间</span>
<span class="token attr-name">javax.validation.constraints.PastOrPresent.message</span>   <span class="token punctuation">=</span> <span class="token attr-value">需要是一个过去或现在的时间</span>
<span class="token attr-name">javax.validation.constraints.Pattern.message</span>         <span class="token punctuation">=</span> <span class="token attr-value">需要匹配正则表达式"&#123;regexp&#125;"</span>
<span class="token attr-name">javax.validation.constraints.Positive.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">必须是正数</span>
<span class="token attr-name">javax.validation.constraints.PositiveOrZero.message</span>  <span class="token punctuation">=</span> <span class="token attr-value">必须是正数或零</span>
<span class="token attr-name">javax.validation.constraints.Size.message</span>            <span class="token punctuation">=</span> <span class="token attr-value">个数必须在&#123;min&#125;和&#123;max&#125;之间</span>

<span class="token attr-name">org.hibernate.validator.constraints.CreditCardNumber.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">不合法的信用卡号码</span>
<span class="token attr-name">org.hibernate.validator.constraints.Currency.message</span>                <span class="token punctuation">=</span> <span class="token attr-value">不合法的货币 (必须是&#123;value&#125;其中之一)</span>
<span class="token attr-name">org.hibernate.validator.constraints.EAN.message</span>                     <span class="token punctuation">=</span> <span class="token attr-value">不合法的&#123;type&#125;条形码</span>
<span class="token attr-name">org.hibernate.validator.constraints.Email.message</span>                   <span class="token punctuation">=</span> <span class="token attr-value">不是一个合法的电子邮件地址</span>
<span class="token attr-name">org.hibernate.validator.constraints.Length.message</span>                  <span class="token punctuation">=</span> <span class="token attr-value">长度需要在&#123;min&#125;和&#123;max&#125;之间</span>
<span class="token attr-name">org.hibernate.validator.constraints.CodePointLength.message</span>         <span class="token punctuation">=</span> <span class="token attr-value">长度需要在&#123;min&#125;和&#123;max&#125;之间</span>
<span class="token attr-name">org.hibernate.validator.constraints.LuhnCheck.message</span>               <span class="token punctuation">=</span> <span class="token attr-value">$&#123;validatedValue&#125;的校验码不合法, Luhn模10校验和不匹配</span>
<span class="token attr-name">org.hibernate.validator.constraints.Mod10Check.message</span>              <span class="token punctuation">=</span> <span class="token attr-value">$&#123;validatedValue&#125;的校验码不合法, 模10校验和不匹配</span>
<span class="token attr-name">org.hibernate.validator.constraints.Mod11Check.message</span>              <span class="token punctuation">=</span> <span class="token attr-value">$&#123;validatedValue&#125;的校验码不合法, 模11校验和不匹配</span>
<span class="token attr-name">org.hibernate.validator.constraints.ModCheck.message</span>                <span class="token punctuation">=</span> <span class="token attr-value">$&#123;validatedValue&#125;的校验码不合法, $&#123;modType&#125;校验和不匹配</span>
<span class="token attr-name">org.hibernate.validator.constraints.NotBlank.message</span>                <span class="token punctuation">=</span> <span class="token attr-value">不能为空</span>
<span class="token attr-name">org.hibernate.validator.constraints.NotEmpty.message</span>                <span class="token punctuation">=</span> <span class="token attr-value">不能为空</span>
<span class="token attr-name">org.hibernate.validator.constraints.ParametersScriptAssert.message</span>  <span class="token punctuation">=</span> <span class="token attr-value">执行脚本表达式"&#123;script&#125;"没有返回期望结果</span>
<span class="token attr-name">org.hibernate.validator.constraints.Range.message</span>                   <span class="token punctuation">=</span> <span class="token attr-value">需要在&#123;min&#125;和&#123;max&#125;之间</span>
<span class="token attr-name">org.hibernate.validator.constraints.SafeHtml.message</span>                <span class="token punctuation">=</span> <span class="token attr-value">可能有不安全的HTML内容</span>
<span class="token attr-name">org.hibernate.validator.constraints.ScriptAssert.message</span>            <span class="token punctuation">=</span> <span class="token attr-value">执行脚本表达式"&#123;script&#125;"没有返回期望结果</span>
<span class="token attr-name">org.hibernate.validator.constraints.URL.message</span>                     <span class="token punctuation">=</span> <span class="token attr-value">需要是一个合法的URL</span>

<span class="token attr-name">org.hibernate.validator.constraints.time.DurationMax.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">必须小于$&#123;inclusive == true ? '或等于' : ''&#125;$&#123;days == 0 ? '' : days += '天'&#125;$&#123;hours == 0 ? '' : hours += '小时'&#125;$&#123;minutes == 0 ? '' : minutes += '分钟'&#125;$&#123;seconds == 0 ? '' : seconds += '秒'&#125;$&#123;millis == 0 ? '' : millis += '毫秒'&#125;$&#123;nanos == 0 ? '' : nanos += '纳秒'&#125;</span>
<span class="token attr-name">org.hibernate.validator.constraints.time.DurationMin.message</span>        <span class="token punctuation">=</span> <span class="token attr-value">必须大于$&#123;inclusive == true ? '或等于' : ''&#125;$&#123;days == 0 ? '' : days += '天'&#125;$&#123;hours == 0 ? '' : hours += '小时'&#125;$&#123;minutes == 0 ? '' : minutes += '分钟'&#125;$&#123;seconds == 0 ? '' : seconds += '秒'&#125;$&#123;millis == 0 ? '' : millis += '毫秒'&#125;$&#123;nanos == 0 ? '' : nanos += '纳秒'&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>想要自定义错误消息，可以覆盖默认的错误提示信息，如@NotBlank的默认message是</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">NotBlank</span> <span class="token punctuation">&#123;</span>

	<span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"&#123;javax.validation.constraints.NotBlank.message&#125;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>可以在添加注解的时候，修改message：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"品牌名必须非空"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>当再次发送请求时，得到的错误提示信息：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token property">"timestamp"</span><span class="token operator">:</span> <span class="token string">"2020-04-29T09:36:04.125+0000"</span><span class="token punctuation">,</span>
    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span>
    <span class="token property">"error"</span><span class="token operator">:</span> <span class="token string">"Bad Request"</span><span class="token punctuation">,</span>
    <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
            <span class="token property">"codes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">"NotBlank.brandEntity.name"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank.name"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank.java.lang.String"</span><span class="token punctuation">,</span>
                <span class="token string">"NotBlank"</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token punctuation">&#123;</span>
                    <span class="token property">"codes"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"brandEntity.name"</span><span class="token punctuation">,</span>
                        <span class="token string">"name"</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token property">"arguments"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
                    <span class="token property">"defaultMessage"</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
                    <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"name"</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">"defaultMessage"</span><span class="token operator">:</span> <span class="token string">"品牌名必须非空"</span><span class="token punctuation">,</span>
            <span class="token property">"objectName"</span><span class="token operator">:</span> <span class="token string">"brandEntity"</span><span class="token punctuation">,</span>
            <span class="token property">"field"</span><span class="token operator">:</span> <span class="token string">"name"</span><span class="token punctuation">,</span>
            <span class="token property">"rejectedValue"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token property">"bindingFailure"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token property">"code"</span><span class="token operator">:</span> <span class="token string">"NotBlank"</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Validation failed for object='brandEntity'. Error count: 1"</span><span class="token punctuation">,</span>
    <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"/product/brand/save"</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>但是这种返回的错误结果并不符合我们的业务需要。</p>
<h3 id="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"><a href="#步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。" class="headerlink" title="步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。"></a>步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">BrandEntity</span> brand<span class="token punctuation">,</span> <span class="token class-name">BindingResult</span> result<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
       <span class="token keyword">if</span><span class="token punctuation">(</span> result<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
           <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">//1.获取错误的校验结果</span>
           result<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token operator">-></span><span class="token punctuation">&#123;</span>
               <span class="token comment">//获取发生错误时的message</span>
               <span class="token class-name">String</span> message <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token comment">//获取发生错误的字段</span>
               <span class="token class-name">String</span> field <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">"提交的数据不合法"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>

       <span class="token punctuation">&#125;</span>
	brandService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>brand<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这种是针对于该请求设置了一个内容校验，如果针对于每个请求都单独进行配置，显然不是太合适，实际上可以统一的对于异常进行处理。</p>
<h3 id="步骤4：统一异常处理"><a href="#步骤4：统一异常处理" class="headerlink" title="步骤4：统一异常处理"></a>步骤4：统一异常处理</h3><p>可以使用SpringMvc所提供的@ControllerAdvice，通过“basePackages”能够说明处理哪些路径下的异常。</p>
<p>（1）抽取一个异常处理类</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>gulimall<span class="token punctuation">.</span>product<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>common<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">R</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>validation<span class="token punctuation">.</span></span><span class="token class-name">BindingResult</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span></span><span class="token class-name">MethodArgumentNotValidException</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ControllerAdvice</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ExceptionHandler</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ResponseBody</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestControllerAdvice</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 集中处理所有异常
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestControllerAdvice</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token string">"com.bigdata.gulimall.product.controller"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GulimallExceptionAdvice</span> <span class="token punctuation">&#123;</span>


    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleValidException</span><span class="token punctuation">(</span><span class="token class-name">MethodArgumentNotValidException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">></span></span> map<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BindingResult</span> bindingResult <span class="token operator">=</span> exception<span class="token punctuation">.</span><span class="token function">getBindingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindingResult<span class="token punctuation">.</span><span class="token function">getFieldErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>fieldError <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">String</span> message <span class="token operator">=</span> fieldError<span class="token punctuation">.</span><span class="token function">getDefaultMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> field <span class="token operator">=</span> fieldError<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"数据校验出现问题&#123;&#125;,异常类型&#123;&#125;"</span><span class="token punctuation">,</span>exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>exception<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token string">"数据校验出现问题"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（2）测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<p><img src="/img/spring-cloud/image-20200429183334783.png" alt="image-20200429183334783"></p>
<p>（3）默认异常处理</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Throwable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
 <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">handleException</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
     log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未知异常&#123;&#125;,异常类型&#123;&#125;"</span><span class="token punctuation">,</span>throwable<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>throwable<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">BizCodeEnum</span><span class="token punctuation">.</span>UNKNOW_EXEPTION<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">BizCodeEnum</span><span class="token punctuation">.</span>UNKNOW_EXEPTION<span class="token punctuation">.</span><span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（4）错误状态码</p>
<p>上面代码中，针对于错误状态码，是我们进行随意定义的，然而正规开发过程中，错误状态码有着严格的定义规则，如该在项目中我们的错误状态码定义</p>
<p><img src="/img/spring-cloud/image-20200429183748249.png" alt="image-20200429183748249"></p>
<p>为了定义这些错误状态码，我们可以单独定义一个常量类，用来存储这些错误状态码</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bigdata<span class="token punctuation">.</span>common<span class="token punctuation">.</span>exception</span><span class="token punctuation">;</span>

<span class="token comment">/***
 * 错误码和错误信息定义类
 * 1. 错误码定义规则为5为数字
 * 2. 前两位表示业务场景，最后三位表示错误码。例如：100001。10:通用 001:系统未知异常
 * 3. 维护错误码后需要维护错误描述，将他们定义为枚举形式
 * 错误码列表：
 *  10: 通用
 *      001：参数格式校验
 *  11: 商品
 *  12: 订单
 *  13: 购物车
 *  14: 物流
 */</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">BizCodeEnum</span> <span class="token punctuation">&#123;</span>

    <span class="token function">UNKNOW_EXEPTION</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">,</span><span class="token string">"系统未知异常"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token function">VALID_EXCEPTION</span><span class="token punctuation">(</span> <span class="token number">10001</span><span class="token punctuation">,</span><span class="token string">"参数格式校验失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg<span class="token punctuation">;</span>

    <span class="token class-name">BizCodeEnum</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">,</span> <span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>msg <span class="token operator">=</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> code<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>（5）测试： <a target="_blank" rel="noopener" href="http://localhost:88/api/product/brand/save">http://localhost:88/api/product/brand/save</a> </p>
<img src="images/image-20200429191830967.png" alt="image-20200429191830967" style="zoom:67%;" />

<h2 id="19-分组校验功能（完成多场景的复杂校验）"><a href="#19-分组校验功能（完成多场景的复杂校验）" class="headerlink" title="19. 分组校验功能（完成多场景的复杂校验）"></a>19. 分组校验功能（完成多场景的复杂校验）</h2><h3 id="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"><a href="#1、给校验注解，标注上groups，指定什么情况下才需要进行校验" class="headerlink" title="1、给校验注解，标注上groups，指定什么情况下才需要进行校验"></a>1、给校验注解，标注上groups，指定什么情况下才需要进行校验</h3><p>如：指定在更新和添加的时候，都需要进行校验</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@NotEmpty</span>
<span class="token annotation punctuation">@NotBlank</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">"品牌名必须非空"</span><span class="token punctuation">,</span>groups <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token class-name">UpdateGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在这种情况下，没有指定分组的校验注解，默认是不起作用的。想要起作用就必须要加groups。</p>
<h3 id="2、业务方法参数上使用-Validated注解"><a href="#2、业务方法参数上使用-Validated注解" class="headerlink" title="2、业务方法参数上使用@Validated注解"></a>2、业务方法参数上使用@Validated注解</h3><p>@Validated的value方法：</p>
<p>Specify one or more validation groups to apply to the validation step kicked off by this annotation.<br> 指定一个或多个验证组以应用于此注释启动的验证步骤。 </p>
<p>JSR-303 defines validation groups as custom annotations which an application declares for the sole purpose of using<br>them as type-safe group arguments, as implemented in SpringValidatorAdapter.</p>
<p> JSR-303 将验证组定义为自定义注释，应用程序声明的唯一目的是将它们用作类型安全组参数，如 SpringValidatorAdapter 中实现的那样。 </p>
<p>Other SmartValidator implementations may support class arguments in other ways as well.</p>
<p> 其他SmartValidator 实现也可以以其他方式支持类参数。 </p>
<h3 id="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"><a href="#3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。" class="headerlink" title="3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。"></a>3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。</h3><h2 id="20-自定义校验功能"><a href="#20-自定义校验功能" class="headerlink" title="20. 自定义校验功能"></a>20. 自定义校验功能</h2><h3 id="1、编写一个自定义的校验注解"><a href="#1、编写一个自定义的校验注解" class="headerlink" title="1、编写一个自定义的校验注解"></a>1、编写一个自定义的校验注解</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token class-name">ListValueConstraintValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> METHOD<span class="token punctuation">,</span> FIELD<span class="token punctuation">,</span> ANNOTATION_TYPE<span class="token punctuation">,</span> CONSTRUCTOR<span class="token punctuation">,</span> PARAMETER<span class="token punctuation">,</span> TYPE_USE <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ListValue</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"&#123;com.bigdata.common.valid.ListValue.message&#125;"</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="2、编写一个自定义的校验器"><a href="#2、编写一个自定义的校验器" class="headerlink" title="2、编写一个自定义的校验器"></a>2、编写一个自定义的校验器</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ListValueConstraintValidator</span> <span class="token keyword">implements</span> <span class="token class-name">ConstraintValidator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ListValue</span><span class="token punctuation">,</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span> set<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">ListValue</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> value <span class="token operator">=</span> constraintAnnotation<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">:</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

    <span class="token punctuation">&#125;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> value<span class="token punctuation">,</span> <span class="token class-name">ConstraintValidatorContext</span> context<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>


        <span class="token keyword">return</span>  set<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="3、关联自定义的校验器和自定义的校验注解"><a href="#3、关联自定义的校验器和自定义的校验注解" class="headerlink" title="3、关联自定义的校验器和自定义的校验注解"></a>3、关联自定义的校验器和自定义的校验注解</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token class-name">ListValueConstraintValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="4、使用实例"><a href="#4、使用实例" class="headerlink" title="4、使用实例"></a>4、使用实例</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 显示状态[0-不显示；1-显示]
 */</span>
<span class="token annotation punctuation">@ListValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>groups <span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token class-name">AddGroup</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Integer</span> showStatus<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="21-商品SPU和SKU管理"><a href="#21-商品SPU和SKU管理" class="headerlink" title="21. 商品SPU和SKU管理"></a>21. 商品SPU和SKU管理</h2><p>重新执行“sys_menus.sql”</p>
<h2 id="22-点击子组件，父组件触发事件"><a href="#22-点击子组件，父组件触发事件" class="headerlink" title="22. 点击子组件，父组件触发事件"></a>22. 点击子组件，父组件触发事件</h2><p>现在想要实现点击菜单的左边，能够实现在右边展示数据</p>
<p><img src="/img/spring-cloud/image-20200430215649355.png" alt="image-20200430215649355"></p>
<p>父子组件传递数据：</p>
<p>1）子组件给父组件传递数据，事件机制；</p>
<p>在category中绑定node-click事件，</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;el-tree :data&#x3D;&quot;menus&quot; :props&#x3D;&quot;defaultProps&quot; node-key&#x3D;&quot;catId&quot; ref&#x3D;&quot;menuTree&quot; @node-click&#x3D;&quot;nodeClick&quot;	&gt;&lt;&#x2F;el-tree&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>2）子组件给父组件发送一个事件，携带上数据；</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">nodeClick</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>Node<span class="token punctuation">,</span>component</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"子组件"</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>Node<span class="token punctuation">,</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">"tree-node-click"</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>Node<span class="token punctuation">,</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>this.$emit(事件名,”携带的数据”);</p>
<p>3）父组件中的获取发送的事件</p>
<pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;category @tree-node-click&#x3D;&quot;treeNodeClick&quot;&gt;&lt;&#x2F;category&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//获取发送的事件数据</span>
<span class="token function">treeNodeClick</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>Node<span class="token punctuation">,</span>component</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"attgroup感知到的category的节点被点击"</span><span class="token punctuation">,</span>data<span class="token punctuation">,</span>Node<span class="token punctuation">,</span>component<span class="token punctuation">)</span><span class="token punctuation">;</span>
 console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"刚才被点击的菜单ID"</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>catId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="23-规格参数新增与VO"><a href="#23-规格参数新增与VO" class="headerlink" title="23. 规格参数新增与VO"></a>23. 规格参数新增与VO</h2><p>规格参数新增时，请求的URL：Request URL: </p>
<p><a target="_blank" rel="noopener" href="http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attr/base/list/0?t=1588731762158&amp;page=1&amp;limit=10&amp;key=</a></p>
<p>当有新增字段时，我们往往会在entity实体类中新建一个字段，并标注数据库中不存在该字段，然而这种方式并不规范</p>
<p><img src="/img/spring-cloud/1588732021702.png" alt="1588732021702"></p>
<p>比较规范的做法是，新建一个vo文件夹，将每种不同的对象，按照它的功能进行了划分。在java中，涉及到了这几种类型</p>
<p><img src="/img/spring-cloud/1588732152646.png" alt="1588732152646"></p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attr/save%EF%BC%8C%E7%8E%B0%E5%9C%A8%E7%9A%84%E6%83%85%E5%86%B5%E6%98%AF%EF%BC%8C%E5%AE%83%E5%9C%A8%E4%BF%9D%E5%AD%98%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AA%E6%98%AF%E4%BF%9D%E5%AD%98%E4%BA%86attr%EF%BC%8C%E5%B9%B6%E6%B2%A1%E6%9C%89%E4%BF%9D%E5%AD%98attrgroup%EF%BC%8C%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3%E8%BF%99%E4%B8%AA%E9%97%AE%E9%A2%98%EF%BC%8C%E6%88%91%E4%BB%AC%E6%96%B0%E5%BB%BA%E4%BA%86%E4%B8%80%E4%B8%AAvo/AttrVo%EF%BC%8C%E5%9C%A8%E5%8E%9FAttrEntity%E5%9F%BA%E7%A1%80%E4%B8%8A%E5%A2%9E%E5%8A%A0%E4%BA%86attrGroupId%E5%AD%97%E6%AE%B5%EF%BC%8C%E4%BD%BF%E5%BE%97%E4%BF%9D%E5%AD%98%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%B9%9F%E4%BF%9D%E5%AD%98%E4%BA%86%E5%AE%83%E4%BB%AC%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB%E3%80%82">http://localhost:88/api/product/attr/save，现在的情况是，它在保存的时候，只是保存了attr，并没有保存attrgroup，为了解决这个问题，我们新建了一个vo/AttrVo，在原AttrEntity基础上增加了attrGroupId字段，使得保存新增数据的时候，也保存了它们之间的关系。</a></p>
<p>通过” BeanUtils.copyProperties(attr,attrEntity);”能够实现在两个Bean之间拷贝数据，但是两个Bean的字段要相同</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
 <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveAttr</span><span class="token punctuation">(</span><span class="token class-name">AttrVo</span> attr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token class-name">AttrEntity</span> attrEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AttrEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">BeanUtils</span><span class="token punctuation">.</span><span class="token function">copyProperties</span><span class="token punctuation">(</span>attr<span class="token punctuation">,</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>attrEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>问题：现在有两个查询，一个是查询部分，另外一个是查询全部，但是又必须这样来做吗？还是有必要的，但是可以在后台进行设计，两种查询是根据catId是否为零进行区分的。</p>
<h2 id="24-查询分组关联属性和删除关联"><a href="#24-查询分组关联属性和删除关联" class="headerlink" title="24. 查询分组关联属性和删除关联"></a>24. 查询分组关联属性和删除关联</h2><p>获取属性分组的关联的所有属性</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj">https://easydoc.xyz/doc/75716633/ZUqEdvA4/LnjzZHPj</a></p>
<p>发送请求：/product/attrgroup/{attrgroupId}/attr/relation</p>
<p>获取当前属性分组所关联的属性</p>
<p><img src="/img/spring-cloud/1588766303205.png" alt="1588766303205"></p>
<p>如何查找：既然给出了attr_group_id，那么到中间表中查询出来所关联的attr_id，然后得到最终的所有属性即可。</p>
<p>可能出现null值的问题</p>
<h2 id="25-查询分组未关联的属性"><a href="#25-查询分组未关联的属性" class="headerlink" title="25. 查询分组未关联的属性"></a>25. 查询分组未关联的属性</h2><p>/product/attrgroup/{attrgroupId}/noattr/relation</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO">https://easydoc.xyz/doc/75716633/ZUqEdvA4/d3EezLdO</a></p>
<p>获取属性分组里面还没有关联的本分类里面的其他基本属性，方便添加新的关联</p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attrgroup/1/noattr/relation?t=1588780783441&amp;page=1&amp;limit=10&amp;key=</a></p>
<p><img src="/img/spring-cloud/1588780868214.png" alt="1588780868214"></p>
<p>属性分组，对应于“pms_attr_group”表，每个分组下，需要查看到关联了哪些属性信息，销售属性不需要和分组进行关联，但是规格参数要和属性分组进行关联。</p>
<p>规格参数：对应于<code>pms_attr</code>表，attr_type=1，需要显示分组信息</p>
<p>销售属性：对应于pms_attr`表，attr_type=0，不需要显示分组信息</p>
<p>分组ID为9的分组：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=">http://localhost:88/api/product/attrgroup/9/noattr/relation?t=1588822258669&amp;page=1&amp;limit=10&amp;key=</a></p>
<p>对应的数据库字段</p>
<p>attr_group_id  attr_group_name    sort  descript                icon    catelog_id  </p>
<hr>
<pre><code>        9  主体                    1  型号 平台                   wu               454
       10  显卡                    1  显存容量                    wu               454
       11  输入设备                  1  鼠标 键盘                   wu               454
       12  主板                    1  显卡类型 芯片组                wu               454
       13  规格                    1  尺寸                      wu               454
</code></pre>
<p>查询attrgroupId=9的属性分组：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">AttrGroupEntity</span> attrGroupEntity <span class="token operator">=</span> attrGroupDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>attrgroupId<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>获取到分类信息：</p>
<pre class="line-numbers language-none"><code class="language-none">Long catelogId &#x3D; attrGroupEntity.getCatelogId();<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>目标：获取属性分组没有关联的其他属性</p>
<p>也就是获取attrgroupId=9的属性分组中，关联的分类catelog_id =454 （台式机），其他基本属性</p>
<p>在该属性分组中，现在已经关联的属性：</p>
<p><img src="/img/spring-cloud/1588822997675.png" alt="1588822997675"></p>
<p>本分类下，存在哪些基本属性？</p>
<p>没有关联的其他属性</p>
<p>已经关联的属性，这些属性是如何关联上的？</p>
<p>答：在创建规格参数的时候，已经设置了需要关联哪些属性分组。</p>
<p>想要知道还没有关联哪些，先查看关联了哪些，如何排除掉这些就是未关联的</p>
<p>在中间表中显示了属性和属性分组之间的关联关系，在属性表中显示了所有的属性，</p>
<p>先查询中间表，得到所有已经关联的属性的id，然后再次查询属性表，排除掉已经建立关联的属性ID，将剩下的属性ID和属性建立起关联关系</p>
<h2 id="26-添加属性和分组的关联关系"><a href="#26-添加属性和分组的关联关系" class="headerlink" title="26. 添加属性和分组的关联关系"></a>26. 添加属性和分组的关联关系</h2><p>请求类型：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/attr/relation">http://localhost:88/api/product/attrgroup/attr/relation</a></p>
<p>请求方式：POST</p>
<p>请求数据：[{“attrId”:10,”attrGroupId”:9}]</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC">https://easydoc.xyz/doc/75716633/ZUqEdvA4/VhgnaedC</a></p>
<p>响应数据：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
	<span class="token property">"msg"</span><span class="token operator">:</span> <span class="token string">"success"</span><span class="token punctuation">,</span>
	<span class="token property">"code"</span><span class="token operator">:</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>本质就是在中间表pms_attr_attrgroup_relation中，添加一条记录的过程</p>
<h2 id="27-发布商品"><a href="#27-发布商品" class="headerlink" title="27. 发布商品"></a>27. 发布商品</h2><p>获取所有会员等级：/member/memberlevel/list</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a></p>
<p>在“gulimall-gateway”中修改“”文件，添加对于member的路由</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gulimall<span class="token punctuation">-</span>member
  <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gulimall<span class="token punctuation">-</span>member
  <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> Path=/api/member/<span class="token important">**</span>
  <span class="token key atrule">filters</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> RewritePath=/api/(<span class="token punctuation">?</span>&lt;segment<span class="token punctuation">></span>/<span class="token punctuation">?</span>.<span class="token important">*)</span><span class="token punctuation">,</span>/$\<span class="token punctuation">&#123;</span>segment<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>在“gulimall-member”中，创建“bootstrap.properties”文件，内容如下：</p>
<pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">spring.cloud.nacos.config.name</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-member</span>
<span class="token attr-name">spring.cloud.nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token attr-value">192.168.137.14:8848</span>
<span class="token attr-name">spring.cloud.nacos.config.namespace</span><span class="token punctuation">=</span><span class="token attr-value">795521fa-77ef-411e-a8d8-0889fdfe6964</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].data-id</span><span class="token punctuation">=</span><span class="token attr-value">gulimall-member.yml</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].group</span><span class="token punctuation">=</span><span class="token attr-value">DEFAULT_GROUP</span>
<span class="token attr-name">spring.cloud.nacos.config.extension-configs[0].refresh</span><span class="token punctuation">=</span><span class="token attr-value">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>获取分类关联的品牌：/product/categorybrandrelation/brands/list</p>
<p>API：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV">https://easydoc.xyz/doc/75716633/ZUqEdvA4/HgVjlzWV</a></p>
<p>遇到PubSub问题</p>
<ol>
<li>首先安装pubsub-js</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">&#96;npm install --save pubsub-js&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ol start="2">
<li>订阅方组件</li>
</ol>
<pre class="line-numbers language-none"><code class="language-none">&#96;import PubSub from &#39;pubsub-js&#39;&#96;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>该this.PubSub为PubSub。</p>
<p>获取分类下所有分组&amp;关联属性</p>
<p>请求类型：/product/attrgroup/{catelogId}/withattr</p>
<p>请求方式：GET</p>
<p>请求URL：<a target="_blank" rel="noopener" href="http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478">http://localhost:88/api/product/attrgroup/225/withattr?t=1588864569478</a></p>
<p>mysql默认的隔离级别为读已提交，为了能够在调试过程中，获取到数据库中的数据信息，可以调整隔离级别为读未提交：</p>
<pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SET</span> <span class="token keyword">SESSION</span> <span class="token keyword">TRANSACTION</span> <span class="token keyword">ISOLATION</span> <span class="token keyword">LEVEL</span> <span class="token keyword">READ</span> <span class="token keyword">UNCOMMITTED</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>但是它对于当前的事务窗口生效，如果想要设置全局的，需要加上global字段。</p>
<h2 id="28-商品管理"><a href="#28-商品管理" class="headerlink" title="28. 商品管理"></a>28. 商品管理</h2><p>当新建时：</p>
<pre class="line-numbers language-none"><code class="language-none">t: 1588983621569
status: 0
key: 
brandId: 0
catelogId: 0
page: 1
limit: 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当上架时：</p>
<pre class="line-numbers language-none"><code class="language-none">t: 1588983754030
status: 1
key: 
brandId: 0
catelogId: 0
page: 1
limit: 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>当下架时：</p>
<pre class="line-numbers language-none"><code class="language-none">t: 1588983789089
status: 2
key: 
brandId: 0
catelogId: 0
page: 1
limit: 10<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>在SPU中，写出的日期数据都不符合规则：<br><img src="/img/spring-cloud/image-20200509083248660.png" alt="image-20200509083248660"></p>
<p>想要符合规则，可以设置写出数据的规则：</p>
<p>spring.jackson</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">jackson</span><span class="token punctuation">:</span>
  <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>SKU检索：</p>
<p>Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0">http://localhost:88/api/product/skuinfo/list?t=1588989437944&amp;page=1&amp;limit=10&amp;key=&amp;catelogId=0&amp;brandId=0&amp;min=0&amp;max=0</a></p>
<p>请求体：</p>
<pre class="line-numbers language-none"><code class="language-none">t: 1588989437944
page: 1
limit: 10
key: 
catelogId: 0
brandId: 0
min: 0
max: 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>API： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D">https://easydoc.xyz/doc/75716633/ZUqEdvA4/ucirLq1D</a> </p>
<h2 id="29-仓库管理"><a href="#29-仓库管理" class="headerlink" title="29. 仓库管理"></a>29. 仓库管理</h2><p> 库存信息表：wms_ware_info</p>
<p>【1】仓库列表功能： </p>
<p>【2】查询商品库存：</p>
<p>【3】查询采购需求：</p>
<p>【4】 合并采购需求：</p>
<p>合并整单选中parcharseID：Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/merge">http://localhost:88/api/ware/purchase/merge</a></p>
<p>请求数据：</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>purchaseId<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>
items<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<p>合并整单未选择parcharseID :Request URL: <a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/merge">http://localhost:88/api/ware/purchase/merge</a></p>
<p><img src="/img/spring-cloud/image-20200509170916557.png" alt="image-20200509170916557"></p>
<pre class="line-numbers language-none"><code class="language-none">items: [1, 2]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>涉及到两张表：wms_purchase_detail，wms_purchase</p>
<p>现在采购单中填写数据，然后关联用户，关联用户后，</p>
<p>总的含义，就是根据采购单中的信息，更新采购需求，在采购单中填写采购人员，采购单号，采购的时候，更新采购细节表中的采购人员ID和采购状态。</p>
<p><img src="/img/spring-cloud/image-20200509191108806.png" alt="image-20200509191108806"></p>
<p>领取采购单</p>
<p><a target="_blank" rel="noopener" href="http://localhost:88/api/ware/purchase/received">http://localhost:88/api/ware/purchase/received</a></p>
<p>（1）某个人领取了采购单后，先看采购单是否处于未分配状态，只有采购单是新建或以领取状态时，才更新采购单的状态</p>
<p>（2）</p>
<p>【1】仓库列表功能： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe">https://easydoc.xyz/doc/75716633/ZUqEdvA4/mZgdqOWe</a> </p>
<p>【2】查询商品库存： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hwXrEXBZ</a> </p>
<p>【3】查询采购需求： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R">https://easydoc.xyz/doc/75716633/ZUqEdvA4/Ss4zsV7R</a> </p>
<p>【4】 合并采购需求：<a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK">https://easydoc.xyz/doc/75716633/ZUqEdvA4/cUlv9QvK</a> </p>
<p>【5】查询未领取的采购单： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH">https://easydoc.xyz/doc/75716633/ZUqEdvA4/hI12DNrH</a> </p>
<p>【6】领取采购单： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1">https://easydoc.xyz/doc/75716633/ZUqEdvA4/vXMBBgw1</a> </p>
<p>完成采购，在完成采购过程中，需要涉及到设置SKU的name信息到仓库中，这是通过远程调用“gulimall-product”来实现根据sku_id查询得到sku_name的，如果这个过程发生了异常，事务不想要回滚，目前采用的方式是通过捕获异常的方式，防止事务回滚，是否还有其他的方式呢？这个问题留待以后解决。</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addStock</span><span class="token punctuation">(</span><span class="token class-name">Long</span> skuId<span class="token punctuation">,</span> <span class="token class-name">Long</span> wareId<span class="token punctuation">,</span> <span class="token class-name">Integer</span> skuNum<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">></span></span> wareSkuEntities <span class="token operator">=</span> wareSkuDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">WareSkuEntity</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"sku_id"</span><span class="token punctuation">,</span> skuId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">"ware_id"</span><span class="token punctuation">,</span> wareId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">if</span><span class="token punctuation">(</span>wareSkuEntities <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> wareSkuEntities<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token comment">//新增</span>
           <span class="token class-name">WareSkuEntity</span> wareSkuEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WareSkuEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuId</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
           wareSkuEntity<span class="token punctuation">.</span><span class="token function">setWareId</span><span class="token punctuation">(</span>wareId<span class="token punctuation">)</span><span class="token punctuation">;</span>
           wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStock</span><span class="token punctuation">(</span>skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
           wareSkuEntity<span class="token punctuation">.</span><span class="token function">setStockLocked</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

           <span class="token comment">//远程查询SKU的name，若失败无需回滚</span>
           <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
               <span class="token class-name">R</span> info <span class="token operator">=</span> productFeignService<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>skuId<span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">if</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
                   <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> data<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">></span></span><span class="token punctuation">)</span>info<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"skuInfo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   wareSkuEntity<span class="token punctuation">.</span><span class="token function">setSkuName</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> data<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"skuName"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token punctuation">&#125;</span>
           <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>

           <span class="token punctuation">&#125;</span>

           wareSkuDao<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>wareSkuEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>
           <span class="token comment">//插入</span>
           wareSkuDao<span class="token punctuation">.</span><span class="token function">addStock</span><span class="token punctuation">(</span>skuId<span class="token punctuation">,</span>wareId<span class="token punctuation">,</span>skuNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">&#125;</span>

   <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="30-获取spu规格"><a href="#30-获取spu规格" class="headerlink" title="30. 获取spu规格"></a>30. 获取spu规格</h2><p>在SPU管理页面，获取商品规格的时候，出现400异常，浏览器显示跳转不了</p>
<p>问题现象：</p>
<p><img src="/img/spring-cloud/image-20200510182051355.png" alt="image-20200510182051355"></p>
<p>出现问题的代码：</p>
<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">attrUpdateShow</span><span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    path<span class="token operator">:</span> <span class="token string">"/product-attrupdate"</span><span class="token punctuation">,</span>
    query<span class="token operator">:</span> <span class="token punctuation">&#123;</span> spuId<span class="token operator">:</span> row<span class="token punctuation">.</span>id<span class="token punctuation">,</span> catalogId<span class="token operator">:</span> row<span class="token punctuation">.</span>catalogId <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>暂时不知道如何解决问题。只能留待以后解决。</p>
<p>经过测试发现，问题和上面的代码没有关系，问题出现在“attrupdate.vue”上，该vue页面无法通过浏览器访问，当输入访问URL（ <a target="_blank" rel="noopener" href="http://localhost:8001/#/product-attrupdate">http://localhost:8001/#/product-attrupdate</a> ）的时候，就会出现404，而其他的请求则不会出现这种情况，不知为何。</p>
<p>通过POSTMAN进行请求的时候，能够请求到数据。</p>
<p>经过分析发现，是因为在数据库中没有该页面的导航所导致的，为了修正这个问题，可以在“sys-menu”表中添加一行，内容位：</p>
<p><img src="/img/spring-cloud/image-20200510231012714.png" alt="image-20200510231012714"></p>
<p>这样当再次访问的时候，在“平台属性”下，会出现“规格维护”菜单，</p>
<p><img src="/img/spring-cloud/image-20200510231041708.png" alt="image-20200510231041708"></p>
<p>当再次点击“规格”的时候，显示出菜单</p>
<p><img src="/img/spring-cloud/image-20200510231200130.png" alt="image-20200510231200130"></p>
<p>不过这种菜单并不符合我们的需要，我们需要让它以弹出框的形式出现。</p>
<h2 id="31-修改商品规格"><a href="#31-修改商品规格" class="headerlink" title="31. 修改商品规格"></a>31. 修改商品规格</h2><p>API： <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85">https://easydoc.xyz/doc/75716633/ZUqEdvA4/GhnJ0L85</a> </p>
<p>URL：/product/attr/update/{spuId}</p>
<h2 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h2><h3 id="1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"><a href="#1-在open-fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。" class="headerlink" title="1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。"></a>1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。</h3><p>调用方：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"gulimall-coupon"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CouponFenService</span> <span class="token punctuation">&#123;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/coupon/spubounds/save"</span><span class="token punctuation">)</span>
    <span class="token class-name">R</span> <span class="token function">saveSpuBounds</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SpuBoundTo</span> spuBoundTo<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/coupon/skufullreduction/saveInfo"</span><span class="token punctuation">)</span>
    <span class="token class-name">R</span> <span class="token function">saveSkuReduction</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SkuReductionTo</span> skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>被调用方：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/save"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SpuBoundsEntity</span> spuBounds<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
spuBoundsService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>spuBounds<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

  <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/saveInfo"</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">R</span> <span class="token function">saveInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SkuReductionTo</span> skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      skuFullReductionService<span class="token punctuation">.</span><span class="token function">saveSkuReduction</span><span class="token punctuation">(</span>skuReductionTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">R</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>调用方JSON化时的对象SpuBoundTo：</p>
<pre class="line-numbers language-none"><code class="language-none">@Data
public class SpuBoundTo &#123;
    private Long spuId;
    private BigDecimal buyBounds;
    private BigDecimal growBounds;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>被调用方JSON数据对象化时的对象SpuBoundsEntity：</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/**
 * 商品spu积分设置
 * 
 * @author cosmoswong
 * @email cosmoswong@sina.com
 * @date 2020-04-23 23:38:48
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"sms_spu_bounds"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpuBoundsEntity</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * id
	 */</span>
	<span class="token annotation punctuation">@TableId</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">Long</span> spuId<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 成长积分
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> growBounds<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 购物积分
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">BigDecimal</span> buyBounds<span class="token punctuation">;</span>
	<span class="token comment">/**
	 * 优惠生效情况[1111（四个状态位，从右到左）;0 - 无优惠，成长积分是否赠送;1 - 无优惠，购物积分是否赠送;2 - 有优惠，成长积分是否赠送;3 - 有优惠，购物积分是否赠送【状态位0：不赠送，1：赠送】]
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">Integer</span> work<span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="2-事务究竟要如何加上？"><a href="#2-事务究竟要如何加上？" class="headerlink" title="2. 事务究竟要如何加上？"></a>2. 事务究竟要如何加上？</h3><p>存在Batch操作的时候，才需要加上事务，单个操作无需添加事务控制。</p>
<p>SpringBoot中的是事务</p>
<p>批量操作的时候，才需要事务</p>
<p>一个事务标注的方法上，方法内存在这些操作：</p>
<p>（1）批量更新一个表中字段</p>
<p>（2）更新多张表中的操作</p>
<p>实际上不论是哪种类型，方法中所有对于数据库的写操作，都会被整体当做一个事务，在这个事务过程中，如果某个操作出现了异常，则整体都不会被提交。这就是对于SpringBoot中的@Transactional的理解。</p>
<p>@EnableTransactionManagement和@Transactional的区别？</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/abysscarry/article/details/80189232">https://blog.csdn.net/abysscarry/article/details/80189232</a><br> <a target="_blank" rel="noopener" href="https://blog.csdn.net/Driver_tu/article/details/99679145">https://blog.csdn.net/Driver_tu/article/details/99679145</a> </p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/leaveast/p/11765503.html">https://www.cnblogs.com/leaveast/p/11765503.html</a> </p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="1-文档参考地址"><a href="#1-文档参考地址" class="headerlink" title="1. 文档参考地址"></a>1. 文档参考地址</h3><p> <a target="_blank" rel="noopener" href="http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97">http://www.jayh.club/#/02.PassJava%E6%9E%B6%E6%9E%84%E7%AF%87/01.%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%B7%BB%E5%8A%A0%E6%A8%A1%E5%9D%97</a> </p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/ok_wolf/article/details/105400748">https://blog.csdn.net/ok_wolf/article/details/105400748</a> </p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/javalbb/p/12690862.html">https://www.cnblogs.com/javalbb/p/12690862.html</a></p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/ok_wolf/article/details/105456170">https://blog.csdn.net/ok_wolf/article/details/105456170</a> </p>
<p> <a target="_blank" rel="noopener" href="https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf">https://easydoc.xyz/doc/75716633/ZUqEdvA4/jCFganpf</a> </p>
<h3 id="2-开机启动docker"><a href="#2-开机启动docker" class="headerlink" title="2. 开机启动docker"></a>2. 开机启动docker</h3><p><img src="/img/spring-cloud/image-20200422221237751.png" alt="image-20200422221237751"></p>
<p>在Docker中设置开机启动容器</p>
<p><img src="/img/spring-cloud/image-20200423005200485.png" alt="image-20200423005200485"></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#查看防火墙状态</span>
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># systemctl status firewalld</span>
  firewalld.service - firewalld - dynamic firewall daemon
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/firewalld.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Wed <span class="token number">2020</span>-04-22 <span class="token number">21</span>:26:23 EDT<span class="token punctuation">;</span> 10min ago
     Docs: man:firewalld<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
 Main PID: <span class="token number">5947</span> <span class="token punctuation">(</span>firewalld<span class="token punctuation">)</span>
   CGroup: /system.slice/firewalld.service
           └─5947 /usr/bin/python -Es /usr/sbin/firewalld --nofork --nopid

Apr <span class="token number">22</span> <span class="token number">21</span>:26:20 hadoop-104 systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting firewalld - dynamic firewall daemon<span class="token punctuation">..</span>.
Apr <span class="token number">22</span> <span class="token number">21</span>:26:23 hadoop-104 systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started firewalld - dynamic firewall daemon.
<span class="token comment">#查看防火墙是否是开机启动</span>
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># systemctl list-unit-files|grep firewalld</span>
firewalld.service                             enabled 
<span class="token comment">#关闭开机启动防火墙</span>
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld             </span>
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
<span class="token comment">#停止防火墙</span>
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld         </span>
<span class="token comment">#再次查看防火墙</span>
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># systemctl list-unit-files|grep firewalld</span>
firewalld.service                             disabled
<span class="token punctuation">[</span>root@hadoop-104 module<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="3-查看命令的安装位置"><a href="#3-查看命令的安装位置" class="headerlink" title="3. 查看命令的安装位置"></a>3. 查看命令的安装位置</h3><p>whereis mysql：查看mysql的安装位置</p>
<h3 id="4-vscode中生成代码片段"><a href="#4-vscode中生成代码片段" class="headerlink" title="4. vscode中生成代码片段"></a>4. vscode中生成代码片段</h3><p><img src="/img/spring-cloud/image-20200425165814903.png" alt="image-20200425165814903"></p>
<p>新建一个全局的代码片段，名字为vue，然后回车：</p>
<p><img src="/img/spring-cloud/image-20200425165929332.png" alt="image-20200425165929332"></p>
<p>将下面的代码片段粘贴到“vue.code-snippets”</p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>
    <span class="token comment">// Place your 全局 snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and </span>
    <span class="token comment">// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope </span>
    <span class="token comment">// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is </span>
    <span class="token comment">// used to trigger the snippet and the body will be expanded and inserted. Possible variables are: </span>
    <span class="token comment">// $1, $2 for tab stops, $0 for the final cursor position, and $&#123;1:label&#125;, $&#123;2:another&#125; for placeholders. </span>
    <span class="token comment">// Placeholders with the same ids are connected.</span>
    <span class="token comment">// Example:</span>
    <span class="token comment">// "Print to console": &#123;</span>
    <span class="token comment">// 	"scope": "javascript,typescript",</span>
    <span class="token comment">// 	"prefix": "log",</span>
    <span class="token comment">// 	"body": [</span>
    <span class="token comment">// 		"console.log('$1');",</span>
    <span class="token comment">// 		"$2"</span>
    <span class="token comment">// 	],</span>
    <span class="token comment">// 	"description": "Log output to console"</span>
    <span class="token comment">// &#125;</span>
    <span class="token property">"生成vue模板"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"prefix"</span><span class="token operator">:</span> <span class="token string">"vue"</span><span class="token punctuation">,</span>
        <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"&lt;!-- $1 -->"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;template>"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;div class='$2'>$5&lt;/div>"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;/template>"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;script>"</span><span class="token punctuation">,</span>
            <span class="token string">"//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）"</span><span class="token punctuation">,</span>
            <span class="token string">"//例如：import 《组件名称》 from '《组件路径》';"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"export default &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">"//import引入的组件需要注入到对象中才能使用"</span><span class="token punctuation">,</span>
            <span class="token string">"components: &#123;&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"data() &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">"//这里存放数据"</span><span class="token punctuation">,</span>
            <span class="token string">"return &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;;"</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"//监听属性 类似于data概念"</span><span class="token punctuation">,</span>
            <span class="token string">"computed: &#123;&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"//监控data中的数据变化"</span><span class="token punctuation">,</span>
            <span class="token string">"watch: &#123;&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"//方法集合"</span><span class="token punctuation">,</span>
            <span class="token string">"methods: &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"//生命周期 - 创建完成（可以访问当前this实例）"</span><span class="token punctuation">,</span>
            <span class="token string">"created() &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"//生命周期 - 挂载完成（可以访问DOM元素）"</span><span class="token punctuation">,</span>
            <span class="token string">"mounted() &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">""</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;,"</span><span class="token punctuation">,</span>
            <span class="token string">"beforeCreate() &#123;&#125;, //生命周期 - 创建之前"</span><span class="token punctuation">,</span>
            <span class="token string">"beforeMount() &#123;&#125;, //生命周期 - 挂载之前"</span><span class="token punctuation">,</span>
            <span class="token string">"beforeUpdate() &#123;&#125;, //生命周期 - 更新之前"</span><span class="token punctuation">,</span>
            <span class="token string">"updated() &#123;&#125;, //生命周期 - 更新之后"</span><span class="token punctuation">,</span>
            <span class="token string">"beforeDestroy() &#123;&#125;, //生命周期 - 销毁之前"</span><span class="token punctuation">,</span>
            <span class="token string">"destroyed() &#123;&#125;, //生命周期 - 销毁完成"</span><span class="token punctuation">,</span>
            <span class="token string">"activated() &#123;&#125;, //如果页面有keep-alive缓存功能，这个函数会触发"</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;/script>"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;style lang='scss' scoped>"</span><span class="token punctuation">,</span>
            <span class="token string">"//@import url($3); 引入公共css类"</span><span class="token punctuation">,</span>
            <span class="token string">"$4"</span><span class="token punctuation">,</span>
            <span class="token string">"&lt;/style>"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"生成VUE模板"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"http-get请求"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"prefix"</span><span class="token operator">:</span> <span class="token string">"httpget"</span><span class="token punctuation">,</span>
        <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"this.\\$http(&#123;"</span><span class="token punctuation">,</span>
            <span class="token string">"url: this.\\$http.adornUrl(''),"</span><span class="token punctuation">,</span>
            <span class="token string">"method: 'get',"</span><span class="token punctuation">,</span>
            <span class="token string">"params: this.\\$http.adornParams(&#123;&#125;)"</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;).then((&#123; data &#125;) => &#123;"</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;)"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"httpGET请求"</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token property">"http-post请求"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token property">"prefix"</span><span class="token operator">:</span> <span class="token string">"httppost"</span><span class="token punctuation">,</span>
        <span class="token property">"body"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">"this.\\$http(&#123;"</span><span class="token punctuation">,</span>
            <span class="token string">"url: this.\\$http.adornUrl(''),"</span><span class="token punctuation">,</span>
            <span class="token string">"method: 'post',"</span><span class="token punctuation">,</span>
            <span class="token string">"data: this.\\$http.adornData(data, false)"</span><span class="token punctuation">,</span>
            <span class="token string">"&#125;).then((&#123; data &#125;) => &#123; &#125;);"</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">"httpPOST请求"</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>更多详细说明见： <a target="_blank" rel="noopener" href="https://blog.csdn.net/z772330927/article/details/105730430/">https://blog.csdn.net/z772330927/article/details/105730430/</a> </p>
<h3 id="5-vscode快捷键"><a href="#5-vscode快捷键" class="headerlink" title="5. vscode快捷键"></a>5. vscode快捷键</h3><p>ctrl+shift+f 全局搜索</p>
<p>alt+shift+f 格式化代码</p>
<h3 id="6-关闭eslint的语法检查"><a href="#6-关闭eslint的语法检查" class="headerlink" title="6.  关闭eslint的语法检查"></a>6.  关闭eslint的语法检查</h3><p><img src="/img/spring-cloud/image-20200428171043110.png" alt="image-20200428171043110"></p>
<pre class="line-numbers language-json" data-language="json"><code class="language-json"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="7-安装mybatisx插件"><a href="#7-安装mybatisx插件" class="headerlink" title="7. 安装mybatisx插件"></a>7. 安装mybatisx插件</h3><p>在Marketplace中搜索“mybatisx”，安装后重启IDEA，使用时会自动在@Mapper标注的接口上，产生小图标，然后alt+enter，generate statement，就会自动的在xml文件中生成SQL。</p>
<p><img src="/img/spring-cloud/1588730028929.png" alt="1588730028929"></p>
<h3 id="8-mysql的批量删除"><a href="#8-mysql的批量删除" class="headerlink" title="8. mysql的批量删除"></a>8. mysql的批量删除</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span>  <span class="token punctuation">`</span>pms_attr_attrgroup_relation<span class="token punctuation">`</span> <span class="token keyword">WHERE</span> <span class="token punctuation">(</span>attr_id<span class="token operator">=</span> ? <span class="token operator">AND</span> attr_group_id <span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">(</span>attr_id<span class="token operator">=</span> ? <span class="token operator">AND</span> attr_group_id <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="9-String-join"><a href="#9-String-join" class="headerlink" title="9. String.join"></a>9. String.join</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span> <span class="token annotation punctuation">@NotNull</span> 
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NotNull</span> <span class="token class-name">CharSequence</span> delimiter<span class="token punctuation">,</span>
                          <span class="token annotation punctuation">@NotNull</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">CharSequence</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>Returns a new String composed of copies of the CharSequence elements joined together with a copy of the specified delimiter.</p>
<p> 返回一个由CharSequence元素的副本和指定分隔符的副本组成的新字符串。 </p>
<p>For example,</p>
<pre><code> List&lt;String&gt; strings = new LinkedList&lt;&gt;();
 strings.add(&quot;Java&quot;);strings.add(&quot;is&quot;);
 strings.add(&quot;cool&quot;);
 String message = String.join(&quot; &quot;, strings);
 //message returned is: &quot;Java is cool&quot;

 Set&lt;String&gt; strings = new LinkedHashSet&lt;&gt;();
 strings.add(&quot;Java&quot;); strings.add(&quot;is&quot;);
 strings.add(&quot;very&quot;); strings.add(&quot;cool&quot;);
 String message = String.join(&quot;-&quot;, strings);
 //message returned is: &quot;Java-is-very-cool&quot;
</code></pre>
<p>Note that if an individual element is null, then “null” is added.</p>
<p> 注意，如果单个元素为null，则添加“null”。 </p>
<p>Params:<br>delimiter – a sequence of characters that is used to separate each of the elements in the resulting String<br>               用于分隔结果字符串中的每个元素的字符序列 </p>
<p>elements – an Iterable that will have its elements joined together.<br>                  将其元素连接在一起的可迭代的。 </p>
<p>Returns:<br>a new String that is composed from the elements argument<br> 由elements参数组成的新字符串 </p>
<p>Throws:<br>NullPointerException – If delimiter or elements is null</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> delimiter<span class="token punctuation">,</span>
        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">CharSequence</span><span class="token punctuation">></span></span> elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">StringJoiner</span> joiner <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">CharSequence</span> cs<span class="token operator">:</span> elements<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        joiner<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>cs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> joiner<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>能够看到实际上它就是通过创建StringJoiner，然后遍历elements，加入每个元素来完成的。</p>
<p>StringJoiner</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java">java<span class="token punctuation">.</span>util <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">StringJoiner</span>
<span class="token keyword">extends</span> <span class="token class-name">Object</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>StringJoiner is used to construct a sequence of characters separated by a delimiter and optionally starting with a supplied prefix and ending with a supplied suffix.<br> tringJoiner用于构造由分隔符分隔的字符序列，可以选择以提供的前缀开始，以提供的后缀结束。 </p>
<p>Prior to adding something to the StringJoiner, its sj.toString() method will, by default, return prefix + suffix. However, if the setEmptyValue method is called, the emptyValue supplied will be returned instead. This can be used, for example, when creating a string using set notation to indicate an empty set, i.e. “{}”, where the prefix is “{“, the suffix is “}” and nothing has been added to the StringJoiner.<br> 在向StringJoiner添加内容之前，它的sj.toString()方法在默认情况下会返回前缀+后缀。但是，如果调用setEmptyValue方法，则返回所提供的emptyValue。例如，当使用set符号创建一个字符串来表示一个空集时，可以使用这种方法。“{}”，其中前缀是“{”，后缀是“}”，没有向StringJoiner添加任何内容。 </p>
<p>apiNote:<br>The String “[George:Sally:Fred]” may be constructed as follows:</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">StringJoiner</span> sj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringJoiner</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"["</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sj<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"George"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Sally"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"Fred"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> desiredString <span class="token operator">=</span> sj<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>A StringJoiner may be employed to create formatted output from a java.util.stream.Stream using java.util.stream.Collectors.joining(CharSequence). For example:<br> 使用StringJoiner从java.util.stream创建格式化输出流，使用java.util.stream.Collectors.joining (CharSequence进行)。例如: </p>
<pre class="line-numbers language-none"><code class="language-none">List&lt;Integer&gt; numbers &#x3D; Arrays.asList(1, 2, 3, 4);
String commaSeparatedNumbers &#x3D; numbers.stream()
    .map(i -&gt; i.toString())
    .collect(Collectors.joining(&quot;, &quot;));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>通过分析源码发现，在“”内部维护了一个StringBuilder，所有加入到它内部的元素都会先拼接上分割符，然后再拼接上加入的元素</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">StringJoiner</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">CharSequence</span> newElement<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
       <span class="token function">prepareBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>newElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token class-name">StringBuilder</span> <span class="token function">prepareBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
         value<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>delimiter<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
         value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
     <span class="token keyword">return</span> value<span class="token punctuation">;</span>
 <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"><a href="#10-在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组" class="headerlink" title="10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组"></a>10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组</h3><p><img src="/img/spring-cloud/image-20200508222508833.png" alt="image-20200508222508833"></p>
<p>以后再运行时，直接选择这个compound即可很方便的运行或停止一组微服务：</p>
<p><img src="/img/spring-cloud/image-20200508223524543.png" alt="image-20200508223524543"></p>
<p>另外可以单独为每个微服务，设置需要的运行时最大堆内存大小：</p>
<p><img src="/img/spring-cloud/image-20200508222812353.png" alt="image-20200508222812353"></p>
<h3 id="11-mysql的dateTime和timestamp的区别？"><a href="#11-mysql的dateTime和timestamp的区别？" class="headerlink" title="11. mysql的dateTime和timestamp的区别？"></a>11. mysql的dateTime和timestamp的区别？</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/mxwz/p/7520309.html">MySQL中datetime和timestamp的区别及使用</a></p>
<p><strong>TIMESTAMP和DATETIME的相同点：</strong></p>
<p>1&gt; 两者都可用来表示YYYY-MM-DD HH:MM:SS[.fraction]类型的日期。</p>
<p><strong>TIMESTAMP和DATETIME的不同点：</strong></p>
<p>1&gt; 两者的存储方式不一样</p>
<p>对于TIMESTAMP，它把客户端插入的时间从当前时区转化为UTC（世界标准时间）进行存储。查询时，将其又转化为客户端当前时区进行返回。</p>
<p>而对于DATETIME，不做任何改变，基本上是原样输入和输出。</p>
<p>2&gt; 两者所能存储的时间范围不一样</p>
<p>timestamp所能存储的时间范围为：’1970-01-01 00:00:01.000000’ 到 ‘2038-01-19 03:14:07.999999’。</p>
<p>datetime所能存储的时间范围为：’1000-01-01 00:00:00.000000’ 到 ‘9999-12-31 23:59:59.999999’。</p>
<p>总结：TIMESTAMP和DATETIME除了存储范围和存储方式不一样，没有太大区别。当然，对于跨时区的业务，TIMESTAMP更为合适。</p>
<p> <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Jashinck/p/10472398.html">https://www.cnblogs.com/Jashinck/p/10472398.html</a> </p>
<h3 id="12-SpringBoot中的事务"><a href="#12-SpringBoot中的事务" class="headerlink" title="12. SpringBoot中的事务"></a>12. SpringBoot中的事务</h3><p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/Z__Sheng/article/details/89489053">https://blog.csdn.net/Z__Sheng/article/details/89489053</a> </p>
<h3 id="13-IDEA-RESTFUll-clinet"><a href="#13-IDEA-RESTFUll-clinet" class="headerlink" title="13. IDEA RESTFUll clinet"></a>13. IDEA RESTFUll clinet</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37502106/article/details/103183492">IntelliJ IDEA 使用 rest client</a></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="1-TypeError-vm-previewHandle-is-not-a-function"><a href="#1-TypeError-vm-previewHandle-is-not-a-function" class="headerlink" title="1. TypeError: _vm.previewHandle is not a function"></a>1. TypeError: _vm.previewHandle is not a function</h3>
                
                
                    <br />
                    <!-- post-content-ad -->
                    <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-3409699730406381"
                            data-ad-slot="9289016056"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                    <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                

                <br>
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/Java/spring-cloud/mall-distributed-advanced/" data-toggle="tooltip" data-placement="top" title="【Spring-cloud】guli商城-分布式进阶">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/Vue/vue3-admin/10-fetch/" data-toggle="tooltip" data-placement="top" title="【Vue3-Admin】数据请求与封装">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!--打赏-->
                
                    <div class="reward">
                        <div class="reward-button">赏 <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="/img/reward/alipay.jpg"><b>支付宝打赏</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="/img/reward/wechat_pay.jpg"><b>微信打赏</b> </span>
                            </span></div>
                        <p class="reward-notice">赞赏一下</p>
                    </div>
                
                <!--打赏-->

                <br>
                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>                       
                
                <!-- require APlayer -->
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
                <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>

                <div class="aplayer"
                    data-id="2297428102"
                    data-server="netease"
                    data-type="playlist"
                    data-fixed="true" >
                </div>
                

                
        
                    
                        <!-- 来必力City版安装代码 --> 
                        <div id="lv-container" data-id="city" data-uid="MTAyMC80Mzg3OC8yMDQxMw==">
                            <script type="text/javascript">
                                (function (d, s) {
                                    var j, e = d.getElementsByTagName(s)[0];
        
                                    if (typeof LivereTower === 'function') { return; }
        
                                    j = d.createElement(s);
                                    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                                    j.async = true;
        
                                    e.parentNode.insertBefore(j, e);
                                })(document, 'script');
                            </script>
                            <noscript> 为正常使用来必力评论功能请激活JavaScript</noscript>
                        </div>
                        <!-- City版安装代码已完成 -->
                    
            </div>
            
            <!-- Table of Contents -->
            
  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        <!-- toc -->
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1-%E6%95%B4%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">1. 整体介绍</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%EF%BC%89%E5%AE%89%E8%A3%85vagrant"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">1）安装vagrant</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%EF%BC%89%E5%AE%89%E8%A3%85Centos7"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">2）安装Centos7</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2-docker%E4%B8%AD%E5%AE%89%E8%A3%85mysql"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">2. docker中安装mysql</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3-docker%E4%B8%AD%E5%AE%89%E8%A3%85redis"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">3. docker中安装redis</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#4-%E5%88%9B%E5%BB%BAmaven%E5%B7%A5%E7%A8%8B"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">4. 创建maven工程</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#5-%E6%89%A7%E8%A1%8Csql%E8%84%9A%E6%9C%AC"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">5. 执行sql脚本</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#6-clone-%E4%BA%BA%E4%BA%BA%E5%BC%80%E6%BA%90"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">6. clone 人人开源</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#7-clone-renren-generator"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">7. clone renren-generator</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#clone"><span class="toc-nav-number">7.1.</span> <span class="toc-nav-text">clone</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE"><span class="toc-nav-number">7.2.</span> <span class="toc-nav-text">修改配置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%BF%90%E8%A1%8C%E2%80%9Crenren-generator%E2%80%9D"><span class="toc-nav-number">7.3.</span> <span class="toc-nav-text">运行“renren-generator”</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#8-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">8. 微服务注册中心</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#9-%E4%BD%BF%E7%94%A8openfen"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">9. 使用openfen</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#10-%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">10. 配置中心</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%EF%BC%89%E4%BF%AE%E6%94%B9%E2%80%9Cgulimall-coupon%E2%80%9D%E6%A8%A1%E5%9D%97"><span class="toc-nav-number">10.1.</span> <span class="toc-nav-text">1）修改“gulimall-coupon”模块</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%EF%BC%89%E4%BC%A0%E7%BB%9F%E6%96%B9%E5%BC%8F"><span class="toc-nav-number">10.2.</span> <span class="toc-nav-text">2）传统方式</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%EF%BC%89nacos-config"><span class="toc-nav-number">10.3.</span> <span class="toc-nav-text">3）nacos config</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4%EF%BC%89Nacos%E6%94%AF%E6%8C%81%E4%B8%89%E7%A7%8D%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E6%96%B9%E6%96%B9%E6%A1%88"><span class="toc-nav-number">10.4.</span> <span class="toc-nav-text">4）Nacos支持三种配置加载方方案</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Namespace%E6%96%B9%E6%A1%88"><span class="toc-nav-number">10.4.0.1.</span> <span class="toc-nav-text">Namespace方案</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#DataID%E6%96%B9%E6%A1%88"><span class="toc-nav-number">10.4.0.2.</span> <span class="toc-nav-text">DataID方案</span></a></li><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Group%E6%96%B9%E6%A1%88"><span class="toc-nav-number">10.4.0.3.</span> <span class="toc-nav-text">Group方案</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5%EF%BC%89%E5%90%8C%E6%97%B6%E5%8A%A0%E8%BD%BD%E5%A4%9A%E4%B8%AA%E9%85%8D%E7%BD%AE%E9%9B%86"><span class="toc-nav-number">10.5.</span> <span class="toc-nav-text">5）同时加载多个配置集</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#11-%E7%BD%91%E5%85%B3"><span class="toc-nav-number">11.</span> <span class="toc-nav-text">11. 网关</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81%E6%B3%A8%E5%86%8C%E2%80%9Cgulimall-gateway%E2%80%9D%E5%88%B0Nacos"><span class="toc-nav-number">11.1.</span> <span class="toc-nav-text">1、注册“gulimall-gateway”到Nacos</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-nav-number">11.1.1.</span> <span class="toc-nav-text">1）创建“gulimall-gateway”</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2%EF%BC%89%E6%B7%BB%E5%8A%A0%E2%80%9Cgulimall-common%E2%80%9D%E4%BE%9D%E8%B5%96%E5%92%8C%E2%80%9Cspring-cloud-starter-gateway%E2%80%9D%E4%BE%9D%E8%B5%96"><span class="toc-nav-number">11.1.2.</span> <span class="toc-nav-text">2）添加“gulimall-common”依赖和“spring-cloud-starter-gateway”依赖</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3%EF%BC%89%E2%80%9Ccom-bigdata-gulimall-gulimallgateway-GulimallGatewayApplication%E2%80%9D%E7%B1%BB%E4%B8%8A%E5%8A%A0%E4%B8%8A%E2%80%9C-EnableDiscoveryClient%E2%80%9D%E6%B3%A8%E8%A7%A3"><span class="toc-nav-number">11.1.3.</span> <span class="toc-nav-text">3）“com.bigdata.gulimall.gulimallgateway.GulimallGatewayApplication”类上加上“@EnableDiscoveryClient”注解</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4%EF%BC%89%E5%9C%A8Nacos%E4%B8%AD%E5%88%9B%E5%BB%BA%E2%80%9Cgateway%E2%80%9D%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%EF%BC%8C%E5%90%8C%E6%97%B6%E5%9C%A8%E8%AF%A5%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E4%B8%AD%E5%88%9B%E5%BB%BA%E2%80%9Cgulimall-gateway-yml%E2%80%9D"><span class="toc-nav-number">11.1.4.</span> <span class="toc-nav-text">4）在Nacos中创建“gateway”命名空间，同时在该命名空间中创建“gulimall-gateway.yml”</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Cbootstrap-properties%E2%80%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E6%B7%BB%E5%8A%A0%E5%A6%82%E4%B8%8B%E9%85%8D%E7%BD%AE%EF%BC%8C%E6%8C%87%E6%98%8E%E9%85%8D%E7%BD%AE%E4%B8%AD%E5%BF%83%E5%9C%B0%E5%9D%80%E5%92%8C%E6%89%80%E5%B1%9E%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-nav-number">11.1.5.</span> <span class="toc-nav-text">5）创建“bootstrap.properties”文件，添加如下配置，指明配置中心地址和所属命名空间</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#6%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Capplication-properties%E2%80%9D%E6%96%87%E4%BB%B6%EF%BC%8C%E6%8C%87%E5%AE%9A%E6%9C%8D%E5%8A%A1%E5%90%8D%E5%92%8C%E6%B3%A8%E5%86%8C%E4%B8%AD%E5%BF%83%E5%9C%B0%E5%9D%80"><span class="toc-nav-number">11.1.6.</span> <span class="toc-nav-text">6）创建“application.properties”文件，指定服务名和注册中心地址</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#7%EF%BC%89%E5%90%AF%E5%8A%A8%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-nav-number">11.1.7.</span> <span class="toc-nav-text">7）启动“gulimall-gateway”</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E6%A1%88%E4%BE%8B"><span class="toc-nav-number">11.2.</span> <span class="toc-nav-text">2、案例</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1%EF%BC%89%E5%88%9B%E5%BB%BA%E2%80%9Capplication-yml%E2%80%9D"><span class="toc-nav-number">11.2.1.</span> <span class="toc-nav-text">1）创建“application.yml”</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2%EF%BC%89%E5%90%AF%E5%8A%A8%E2%80%9Cgulimall-gateway%E2%80%9D"><span class="toc-nav-number">11.2.2.</span> <span class="toc-nav-text">2）启动“gulimall-gateway”</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3%EF%BC%89%E6%B5%8B%E8%AF%95"><span class="toc-nav-number">11.2.3.</span> <span class="toc-nav-text">3）测试</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#12-Vue"><span class="toc-nav-number">12.</span> <span class="toc-nav-text">12. Vue</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81vue%E5%A3%B0%E6%98%8E%E5%BC%8F%E6%B8%B2%E6%9F%93"><span class="toc-nav-number">12.1.</span> <span class="toc-nav-text">1、vue声明式渲染</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A-%E6%A8%A1%E5%9E%8B%E5%8F%98%E5%8C%96%EF%BC%8C%E8%A7%86%E5%9B%BE%E5%8F%98%E5%8C%96%E3%80%82%E5%8F%8D%E4%B9%8B%E4%BA%A6%E7%84%B6"><span class="toc-nav-number">12.2.</span> <span class="toc-nav-text">2、双向绑定,模型变化，视图变化。反之亦然</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%E3%80%81%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86"><span class="toc-nav-number">12.3.</span> <span class="toc-nav-text">3、事件处理</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4%E3%80%81v-bind-%E5%8D%95%E5%90%91%E7%BB%91%E5%AE%9A"><span class="toc-nav-number">12.4.</span> <span class="toc-nav-text">4、v-bind :单向绑定</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5%E3%80%81v-model%E5%8F%8C%E5%90%91%E7%BB%91%E5%AE%9A"><span class="toc-nav-number">12.5.</span> <span class="toc-nav-text">5、v-model双向绑定</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6%E3%80%81v-on%E4%B8%BA%E6%8C%89%E9%92%AE%E7%BB%91%E5%AE%9A%E4%BA%8B%E4%BB%B6"><span class="toc-nav-number">12.6.</span> <span class="toc-nav-text">6、v-on为按钮绑定事件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7%E3%80%81v-for%E9%81%8D%E5%8E%86%E5%BE%AA%E7%8E%AF"><span class="toc-nav-number">12.7.</span> <span class="toc-nav-text">7、v-for遍历循环</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-nav-number">12.8.</span> <span class="toc-nav-text">过滤器</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%BB%84%E4%BB%B6%E5%8C%96"><span class="toc-nav-number">12.9.</span> <span class="toc-nav-text">组件化</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90%E5%87%BD%E6%95%B0"><span class="toc-nav-number">12.10.</span> <span class="toc-nav-text">生命周期钩子函数</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#13-element-ui"><span class="toc-nav-number">13.</span> <span class="toc-nav-text">13. element ui</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link"><span class="toc-nav-number">13.1.</span> <span class="toc-nav-text"></span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#14-%E9%80%92%E5%BD%92%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-nav-number">14.</span> <span class="toc-nav-text">14. 递归树形结构获取数据</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#15-%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-nav-number">15.</span> <span class="toc-nav-text">15. 删除数据</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#16-%E8%8F%9C%E5%8D%95%E6%8B%96%E5%8A%A8"><span class="toc-nav-number">16.</span> <span class="toc-nav-text">16. 菜单拖动</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%8B%96%E5%8A%A8%E8%8F%9C%E5%8D%95%E6%97%B6%E9%9C%80%E8%A6%81%E4%BF%AE%E6%94%B9%E9%A1%BA%E5%BA%8F%E5%92%8C%E7%BA%A7%E5%88%AB"><span class="toc-nav-number">16.1.</span> <span class="toc-nav-text">拖动菜单时需要修改顺序和级别</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%8F%9C%E5%8D%95%E6%8B%96%E5%8A%A8%E5%BC%80%E5%85%B3"><span class="toc-nav-number">16.2.</span> <span class="toc-nav-text">设置菜单拖动开关</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-nav-number">16.3.</span> <span class="toc-nav-text">批量删除</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#17-%E5%93%81%E7%89%8C%E7%AE%A1%E7%90%86%E8%8F%9C%E5%8D%95"><span class="toc-nav-number">17.</span> <span class="toc-nav-text">17. 品牌管理菜单</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%B7%BB%E5%8A%A0%E2%80%9C%E6%98%BE%E7%A4%BA%E7%8A%B6%E6%80%81%E6%8C%89%E9%92%AE%E2%80%9D"><span class="toc-nav-number">17.1.</span> <span class="toc-nav-text">添加“显示状态按钮”</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%B8%8A%E4%BC%A0"><span class="toc-nav-number">17.2.</span> <span class="toc-nav-text">添加上传</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%E5%8C%85"><span class="toc-nav-number">17.2.1.</span> <span class="toc-nav-text">1）添加依赖包</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2%EF%BC%89%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%B5%81"><span class="toc-nav-number">17.2.2.</span> <span class="toc-nav-text">2）上传文件流</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F"><span class="toc-nav-number">17.3.</span> <span class="toc-nav-text">其他方式</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1%EF%BC%89%E6%96%B0%E5%BB%BAgulimall-third-party"><span class="toc-nav-number">17.3.1.</span> <span class="toc-nav-text">1）新建gulimall-third-party</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2%EF%BC%89%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96%EF%BC%8C%E5%B0%86%E5%8E%9F%E6%9D%A5gulimall-common%E4%B8%AD%E7%9A%84%E2%80%9Cspring-cloud-starter-alicloud-oss%E2%80%9D%E4%BE%9D%E8%B5%96%E7%A7%BB%E5%8A%A8%E5%88%B0%E8%AF%A5%E9%A1%B9%E7%9B%AE%E4%B8%AD"><span class="toc-nav-number">17.3.2.</span> <span class="toc-nav-text">2）添加依赖，将原来gulimall-common中的“spring-cloud-starter-alicloud-oss”依赖移动到该项目中</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#3%EF%BC%89%E5%9C%A8%E4%B8%BB%E5%90%AF%E5%8A%A8%E7%B1%BB%E4%B8%AD%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1%E7%9A%84%E6%B3%A8%E5%86%8C%E5%92%8C%E5%8F%91%E7%8E%B0"><span class="toc-nav-number">17.3.3.</span> <span class="toc-nav-text">3）在主启动类中开启服务的注册和发现</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#4%EF%BC%89%E5%9C%A8nacos%E4%B8%AD%E6%B3%A8%E5%86%8C"><span class="toc-nav-number">17.3.4.</span> <span class="toc-nav-text">4）在nacos中注册</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#5%EF%BC%89%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-nav-number">17.3.5.</span> <span class="toc-nav-text">5）编写配置文件</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#6%EF%BC%89-%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-nav-number">17.3.6.</span> <span class="toc-nav-text">6） 编写测试类</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E4%B8%8A%E4%BC%A0%E7%BB%84%E4%BB%B6"><span class="toc-nav-number">17.4.</span> <span class="toc-nav-text">上传组件</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#18-JSR303%E6%A0%A1%E9%AA%8C"><span class="toc-nav-number">18.</span> <span class="toc-nav-text">18. JSR303校验</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%AD%A5%E9%AA%A41%EF%BC%9A%E4%BD%BF%E7%94%A8%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-nav-number">18.1.</span> <span class="toc-nav-text">步骤1：使用校验注解</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%AD%A5%E9%AA%A42%EF%BC%9A%E5%9C%A8%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95%E7%A7%8D%EF%BC%8C%E4%BD%BF%E7%94%A8%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3-Valid%EF%BC%8C%E5%BC%80%E5%90%AF%E6%A0%A1%E9%AA%8C%EF%BC%8C"><span class="toc-nav-number">18.2.</span> <span class="toc-nav-text">步骤2：在请求方法种，使用校验注解@Valid，开启校验，</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%AD%A5%E9%AA%A43%EF%BC%9A%E7%BB%99%E6%A0%A1%E9%AA%8C%E7%9A%84Bean%E5%90%8E%EF%BC%8C%E7%B4%A7%E8%B7%9F%E4%B8%80%E4%B8%AABindResult%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%8E%B7%E5%8F%96%E5%88%B0%E6%A0%A1%E9%AA%8C%E7%9A%84%E7%BB%93%E6%9E%9C%E3%80%82%E6%8B%BF%E5%88%B0%E6%A0%A1%E9%AA%8C%E7%9A%84%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%B0%B1%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E5%B0%81%E8%A3%85%E3%80%82"><span class="toc-nav-number">18.3.</span> <span class="toc-nav-text">步骤3：给校验的Bean后，紧跟一个BindResult，就可以获取到校验的结果。拿到校验的结果，就可以自定义的封装。</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E6%AD%A5%E9%AA%A44%EF%BC%9A%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-nav-number">18.4.</span> <span class="toc-nav-text">步骤4：统一异常处理</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#19-%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C%E5%8A%9F%E8%83%BD%EF%BC%88%E5%AE%8C%E6%88%90%E5%A4%9A%E5%9C%BA%E6%99%AF%E7%9A%84%E5%A4%8D%E6%9D%82%E6%A0%A1%E9%AA%8C%EF%BC%89"><span class="toc-nav-number">19.</span> <span class="toc-nav-text">19. 分组校验功能（完成多场景的复杂校验）</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81%E7%BB%99%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3%EF%BC%8C%E6%A0%87%E6%B3%A8%E4%B8%8Agroups%EF%BC%8C%E6%8C%87%E5%AE%9A%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E6%89%8D%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E6%A0%A1%E9%AA%8C"><span class="toc-nav-number">19.1.</span> <span class="toc-nav-text">1、给校验注解，标注上groups，指定什么情况下才需要进行校验</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E4%B8%8A%E4%BD%BF%E7%94%A8-Validated%E6%B3%A8%E8%A7%A3"><span class="toc-nav-number">19.2.</span> <span class="toc-nav-text">2、业务方法参数上使用@Validated注解</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%E3%80%81%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E5%9C%A8%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C%E6%83%85%E5%86%B5%E4%B8%8B%EF%BC%8C%E6%B2%A1%E6%9C%89%E6%8C%87%E5%AE%9A%E6%8C%87%E5%AE%9A%E5%88%86%E7%BB%84%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3%EF%BC%8C%E5%B0%86%E4%B8%8D%E4%BC%9A%E7%94%9F%E6%95%88%EF%BC%8C%E5%AE%83%E5%8F%AA%E4%BC%9A%E5%9C%A8%E4%B8%8D%E5%88%86%E7%BB%84%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E7%94%9F%E6%95%88%E3%80%82"><span class="toc-nav-number">19.3.</span> <span class="toc-nav-text">3、默认情况下，在分组校验情况下，没有指定指定分组的校验注解，将不会生效，它只会在不分组的情况下生效。</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#20-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%A1%E9%AA%8C%E5%8A%9F%E8%83%BD"><span class="toc-nav-number">20.</span> <span class="toc-nav-text">20. 自定义校验功能</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-nav-number">20.1.</span> <span class="toc-nav-text">1、编写一个自定义的校验注解</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%99%A8"><span class="toc-nav-number">20.2.</span> <span class="toc-nav-text">2、编写一个自定义的校验器</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%E3%80%81%E5%85%B3%E8%81%94%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E5%99%A8%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E6%A0%A1%E9%AA%8C%E6%B3%A8%E8%A7%A3"><span class="toc-nav-number">20.3.</span> <span class="toc-nav-text">3、关联自定义的校验器和自定义的校验注解</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4%E3%80%81%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="toc-nav-number">20.4.</span> <span class="toc-nav-text">4、使用实例</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#21-%E5%95%86%E5%93%81SPU%E5%92%8CSKU%E7%AE%A1%E7%90%86"><span class="toc-nav-number">21.</span> <span class="toc-nav-text">21. 商品SPU和SKU管理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#22-%E7%82%B9%E5%87%BB%E5%AD%90%E7%BB%84%E4%BB%B6%EF%BC%8C%E7%88%B6%E7%BB%84%E4%BB%B6%E8%A7%A6%E5%8F%91%E4%BA%8B%E4%BB%B6"><span class="toc-nav-number">22.</span> <span class="toc-nav-text">22. 点击子组件，父组件触发事件</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#23-%E8%A7%84%E6%A0%BC%E5%8F%82%E6%95%B0%E6%96%B0%E5%A2%9E%E4%B8%8EVO"><span class="toc-nav-number">23.</span> <span class="toc-nav-text">23. 规格参数新增与VO</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#24-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E5%85%B3%E8%81%94%E5%B1%9E%E6%80%A7%E5%92%8C%E5%88%A0%E9%99%A4%E5%85%B3%E8%81%94"><span class="toc-nav-number">24.</span> <span class="toc-nav-text">24. 查询分组关联属性和删除关联</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#25-%E6%9F%A5%E8%AF%A2%E5%88%86%E7%BB%84%E6%9C%AA%E5%85%B3%E8%81%94%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-nav-number">25.</span> <span class="toc-nav-text">25. 查询分组未关联的属性</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#26-%E6%B7%BB%E5%8A%A0%E5%B1%9E%E6%80%A7%E5%92%8C%E5%88%86%E7%BB%84%E7%9A%84%E5%85%B3%E8%81%94%E5%85%B3%E7%B3%BB"><span class="toc-nav-number">26.</span> <span class="toc-nav-text">26. 添加属性和分组的关联关系</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#27-%E5%8F%91%E5%B8%83%E5%95%86%E5%93%81"><span class="toc-nav-number">27.</span> <span class="toc-nav-text">27. 发布商品</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#28-%E5%95%86%E5%93%81%E7%AE%A1%E7%90%86"><span class="toc-nav-number">28.</span> <span class="toc-nav-text">28. 商品管理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#29-%E4%BB%93%E5%BA%93%E7%AE%A1%E7%90%86"><span class="toc-nav-number">29.</span> <span class="toc-nav-text">29. 仓库管理</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#30-%E8%8E%B7%E5%8F%96spu%E8%A7%84%E6%A0%BC"><span class="toc-nav-number">30.</span> <span class="toc-nav-text">30. 获取spu规格</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#31-%E4%BF%AE%E6%94%B9%E5%95%86%E5%93%81%E8%A7%84%E6%A0%BC"><span class="toc-nav-number">31.</span> <span class="toc-nav-text">31. 修改商品规格</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%B0%8F%E7%BB%93%EF%BC%9A"><span class="toc-nav-number">32.</span> <span class="toc-nav-text">小结：</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E5%9C%A8open-fen%E4%B8%AD%E4%BC%9A%E5%B0%86%E8%B0%83%E7%94%A8%E7%9A%84%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2%E4%B8%BAJSON%EF%BC%8C%E6%8E%A5%E6%94%B6%E6%96%B9%E6%8E%A5%E6%94%B6%E5%90%8E%EF%BC%8C%E5%B0%86JSON%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%AF%B9%E8%B1%A1%EF%BC%8C%E6%AD%A4%E6%97%B6%E8%B0%83%E7%94%A8%E6%96%B9%E5%92%8C%E8%A2%AB%E8%B0%83%E7%94%A8%E6%96%B9%E7%9A%84%E5%A4%84%E7%90%86JSON%E7%9A%84%E5%AF%B9%E8%B1%A1%E4%B8%8D%E4%B8%80%E5%AE%9A%E9%83%BD%E6%98%AF%E5%90%8C%E4%B8%80%E4%B8%AA%E7%B1%BB%EF%BC%8C%E5%8F%AA%E8%A6%81%E5%AE%83%E4%BB%AC%E7%9A%84%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B%E5%90%BB%E5%90%88%E5%8D%B3%E5%8F%AF%E3%80%82"><span class="toc-nav-number">32.1.</span> <span class="toc-nav-text">1.  在open fen中会将调用的数据转换为JSON，接收方接收后，将JSON转换为对象，此时调用方和被调用方的处理JSON的对象不一定都是同一个类，只要它们的字段类型吻合即可。</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E4%BA%8B%E5%8A%A1%E7%A9%B6%E7%AB%9F%E8%A6%81%E5%A6%82%E4%BD%95%E5%8A%A0%E4%B8%8A%EF%BC%9F"><span class="toc-nav-number">32.2.</span> <span class="toc-nav-text">2. 事务究竟要如何加上？</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%85%B6%E4%BB%96"><span class="toc-nav-number">33.</span> <span class="toc-nav-text">其他</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-%E6%96%87%E6%A1%A3%E5%8F%82%E8%80%83%E5%9C%B0%E5%9D%80"><span class="toc-nav-number">33.1.</span> <span class="toc-nav-text">1. 文档参考地址</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2-%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8docker"><span class="toc-nav-number">33.2.</span> <span class="toc-nav-text">2. 开机启动docker</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3-%E6%9F%A5%E7%9C%8B%E5%91%BD%E4%BB%A4%E7%9A%84%E5%AE%89%E8%A3%85%E4%BD%8D%E7%BD%AE"><span class="toc-nav-number">33.3.</span> <span class="toc-nav-text">3. 查看命令的安装位置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4-vscode%E4%B8%AD%E7%94%9F%E6%88%90%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="toc-nav-number">33.4.</span> <span class="toc-nav-text">4. vscode中生成代码片段</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5-vscode%E5%BF%AB%E6%8D%B7%E9%94%AE"><span class="toc-nav-number">33.5.</span> <span class="toc-nav-text">5. vscode快捷键</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6-%E5%85%B3%E9%97%ADeslint%E7%9A%84%E8%AF%AD%E6%B3%95%E6%A3%80%E6%9F%A5"><span class="toc-nav-number">33.6.</span> <span class="toc-nav-text">6.  关闭eslint的语法检查</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7-%E5%AE%89%E8%A3%85mybatisx%E6%8F%92%E4%BB%B6"><span class="toc-nav-number">33.7.</span> <span class="toc-nav-text">7. 安装mybatisx插件</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#8-mysql%E7%9A%84%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4"><span class="toc-nav-number">33.8.</span> <span class="toc-nav-text">8. mysql的批量删除</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#9-String-join"><span class="toc-nav-number">33.9.</span> <span class="toc-nav-text">9. String.join</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#10-%E5%9C%A8Service%E4%B8%AD%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%AF%94%E8%BE%83%E5%A4%9A%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%85%8D%E7%BD%AE%E5%B0%86%E4%B8%80%E4%BA%9B%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%94%BE%E7%BD%AE%E5%88%B0compound%E4%B8%AD%EF%BC%8C%E7%BB%84%E6%88%90%E4%B8%80%E4%B8%AA%E5%B0%8F%E7%BB%84"><span class="toc-nav-number">33.10.</span> <span class="toc-nav-text">10. 在Service中微服务比较多的时候，可以配置将一些微服务放置到compound中，组成一个小组</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#11-mysql%E7%9A%84dateTime%E5%92%8Ctimestamp%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F"><span class="toc-nav-number">33.11.</span> <span class="toc-nav-text">11. mysql的dateTime和timestamp的区别？</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#12-SpringBoot%E4%B8%AD%E7%9A%84%E4%BA%8B%E5%8A%A1"><span class="toc-nav-number">33.12.</span> <span class="toc-nav-text">12. SpringBoot中的事务</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#13-IDEA-RESTFUll-clinet"><span class="toc-nav-number">33.13.</span> <span class="toc-nav-text">13. IDEA RESTFUll clinet</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#-1"><span class="toc-nav-number">33.14.</span> <span class="toc-nav-text"></span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#FAQ"><span class="toc-nav-number">34.</span> <span class="toc-nav-text">FAQ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1-TypeError-vm-previewHandle-is-not-a-function"><span class="toc-nav-number">34.1.</span> <span class="toc-nav-text">1. TypeError: _vm.previewHandle is not a function</span></a></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Recommended Posts  -->
                
                    <hr>
                    <h5>推荐文章</h5>
                    

    <div class="recommended_posts">
        <ul>
            
                <li><a href="https://fangzhioo.github.io/Java/spring-cloud/mall-high-availability-cluster/">【Spring-cloud】guli商城-高可用集群</a></li>
            
                <li><a href="https://fangzhioo.github.io/Java/spring-cloud/mall-distributed-advanced/">【Spring-cloud】guli商城-分布式进阶</a></li>
            
        </ul>
    </div>
 
                

                <!-- Featured Tags -->
                
                <section>
                    <div class="tags">
                        
                            <a class="tag" href="/tags/#SpringCloud" title="SpringCloud">SpringCloud</a>
                        
                    </div>
                </section>
                
            </div>
        </div>
    </div>
</article>

<!-- 复制添加版权申明-->
<script>
    /**/
    function setClipboardText(event){
        event.preventDefault();//阻止元素发生默认的行为（例如，当点击提交按钮时阻止对表单的提交）。
        var node = document.createElement('div');
        //对documentfragment不熟，不知道怎么获取里面的内容，用了一个比较笨的方式
        node.appendChild(window.getSelection().getRangeAt(0).cloneContents());
        //getRangeAt(0)返回对基于零的数字索引与传递参数匹配的选择对象中的范围的引用。对于连续选择，参数应为零。
        var htmlData = '<div>'
            + node.innerHTML
            + '<br /><br />著作权归作者所有。<br />'
            + '商业转载请联系作者获得授权，非商业转载请注明出处。<br />'
            + '作者：fangzhioo <br />链接：'
            + location.href
            + '<br />来源：fangzhioo.github.io<br /><br />'
            + '</div>';
        var textData = window.getSelection().getRangeAt(0)
            + '\n\n著作权归作者所有。\n'
            + '商业转载请联系作者获得授权，非商业转载请注明出处。\n'
            + '作者：fangzhioo\n'
            + '链接：'
            + location.href
            + '来源：fangzhioo.github.io\n\n';
        if(event.clipboardData){
            event.clipboardData.setData("text/html", htmlData);
            //setData(剪贴板格式, 数据) 给剪贴板赋予指定格式的数据。返回 true 表示操作成功。
            event.clipboardData.setData("text/plain",textData);
        }
        else if(window.clipboardData){ //window.clipboardData的作用是在页面上将需要的东西复制到剪贴板上，提供了对于预定义的剪贴板格式的访问，以便在编辑操作中使用。
            return window.clipboardData.setData("text", textData);
        }
    };
 
    document.addEventListener('copy',function(e){
        setClipboardText(e);
    });
</script>

<!-- smooth scroll behavior polyfill  -->
<!-- <script type="text/javascript" src="/js/smoothscroll.js"></script> -->



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/fang-zhi-4-73">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/fangzhioooo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/fangzhioo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; 方志 2021 
                    <br>
                    Theme by <a target="_blank" rel="noopener" href="https://huangxuan.me/">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="https://fangzhioo.github.io">Fz</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=fangzhioo&repo=fangzhioo.github.io&type=star&count=true" >
                    </iframe>
                    <br />
                    <!--总访问量统计-->
                    
                        <span id="busuanzi_container_site_pv" style="margin-left: 3px;">
                            总访问量<span id="busuanzi_value_site_pv"></span>次
                        </span>
                    
                    <!--总访问量统计-->

                </p>
            </div>
        </div>
    </div>
</footer>

<!-- Custom Theme JavaScript -->

<script src="/js/my-blog.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://fangzhioo.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-138588101-1';
    var _gaDomain = 'fangzhioo.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'dce5d892b228cc0a253520da429e7f11';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://fangzhioo.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

<!-- live2d -->
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":true,"debug":false,"model":{"position":"right","width":200,"height":400,"jsonPath":"/live2dw/assets/sagiri.model.json"},"mobile":{"show":true},"react":{"opacity":0.6},"log":false});</script>

</body>

</html>
