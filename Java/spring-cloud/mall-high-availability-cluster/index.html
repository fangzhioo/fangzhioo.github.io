<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="æ–¹å¿—çš„ä¸ªäººåšå®¢,fangzhioo,blog">
    <meta name="keyword"  content="æ–¹å¿—,fangzhioo,Fz&#39;s Blog,Kirito,æ¡äºº,åšå®¢,äº’è”ç½‘,Web,JavaScript,Html,Css,Vue.js,React.js,å‰ç«¯,è®¾è®¡,spring, spring cloud, spring cloud alibaba, spring boot, mall, docker, mysql, nacos, kubernetes">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          ã€Spring-cloudã€‘guliå•†åŸ-é«˜å¯ç”¨é›†ç¾¤ - æ–¹å¿— | fangzhioo
        
    </title>

    <link rel="canonical" href="https://fangzhioo.github.io/Java/spring-cloud/mall-high-availability-cluster/">

    <!-- Bootstrap Core CSS -->
    
<link rel="stylesheet" href="/css/bootstrap.min.css">


    <!-- Custom CSS --> 
    
<link rel="stylesheet" href="/css/beantech.min.css">


    
<link rel="stylesheet" href="/css/donate.css">

    
    <!-- Pygments Highlight CSS -->
    
<link rel="stylesheet" href="/css/prism.css">


    
<link rel="stylesheet" href="/css/widget.css">


    
<link rel="stylesheet" href="/css/rocket.css">


    
<link rel="stylesheet" href="/css/signature.css">


    
<link rel="stylesheet" href="/css/toc.css">


    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script>
      // ga
      window.onload = function() {
        setTimeout(function() {
          let script = document.createElement("script");
          script.setAttribute("async", "");
          script.src = "//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3409699730406381";
          document.body.appendChild(script);
        }, 2e3);
      }
    </script>

    <!--ä¸è’œå­-->
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- jQuery -->
    <!-- 
<script src="/js/jquery.min.js"></script>
 -->
    <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <!-- 
<script src="/js/bootstrap.min.js"></script>
 -->
    <script src="https://cdn.bootcss.com/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>

    <!-- google ad -->
    <script data-ad-client="ca-pub-3409699730406381" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    
<meta name="generator" content="Hexo 5.4.0"></head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('//www.talklee.com/api/bing?rand=true')
            /*post*/
        
    }
    
</style>

<header class="intro-header" >
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                
                    <div class="post-heading">
                        <div class="tags">
                            
                              <a class="tag" href="/tags/#SpringCloud" title="SpringCloud">SpringCloud</a>
                            
                              <a class="tag" href="/tags/#Kubernetes" title="Kubernetes">Kubernetes</a>
                            
                        </div>
                        <h1>ã€Spring-cloudã€‘guliå•†åŸ-é«˜å¯ç”¨é›†ç¾¤</h1>
                        <h2 class="subheading">K8så¿«é€Ÿå…¥é—¨ã€é›†ç¾¤å®‰è£…</h2>

                        <!--æ–‡ç« è®¿é—®é‡ç»Ÿè®¡-->
                        
                            <span id="busuanzi_container_page_pv">æœ¬æ–‡å·²è¢«é˜…è¯»è¿‡<span id="busuanzi_value_page_pv"></span>æ¬¡</span>
                        
                        <!--æ–‡ç« è®¿é—®é‡ç»Ÿè®¡-->

                        <span class="meta">
                            Posted by æ–¹å¿— on
                            2021-06-03
                        </span>
                    </div>
                


                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Fz Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    
                        <li>
                            <a href="/archive/" >Archives</a>
                        </li>
                    
                        <li>
                            <a href="/tags/" >Tags</a>
                        </li>
                    
                        <li>
                            <a href="/about/" >About</a>
                        </li>
                    

                    <!-- 

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                    

                        
                        <li>
                            <a href="/love/">âœ¨è‡´æˆ‘çš„å°å¯çˆ±ğŸ’•ï½</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                     -->
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    
<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <blockquote>
<p>ä¸€ä¸‹å†…å®¹æ¥è‡ª <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1np4y1C7Yf">å°šç¡…è°·â€”â€”å…¨ç½‘æœ€å¼ºç”µå•†æ•™ç¨‹ã€Šè°·ç²’å•†åŸã€‹</a></p>
</blockquote>
<h2 id="1ã€K8så¿«é€Ÿå…¥é—¨"><a href="#1ã€K8så¿«é€Ÿå…¥é—¨" class="headerlink" title="1ã€K8så¿«é€Ÿå…¥é—¨"></a>1ã€K8så¿«é€Ÿå…¥é—¨</h2><h3 id="1ï¼‰ç®€ä»‹"><a href="#1ï¼‰ç®€ä»‹" class="headerlink" title="1ï¼‰ç®€ä»‹"></a>1ï¼‰ç®€ä»‹</h3><p>kubernetesç®€ç§°k8sã€‚æ˜¯ç”¨äºè‡ªåŠ¨éƒ¨ç½²ï¼Œæ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å¼€æºç³»ç»Ÿã€‚<br>ä¸­æ–‡å®˜ç½‘ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/Zh/">https://kubernetes.io/Zh/</a><br>ä¸­æ–‡ç¤¾åŒºï¼š<a target="_blank" rel="noopener" href="https://www.kubernetes.org.cn/">https://www.kubernetes.org.cn/</a><br>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/home/">https://kubernetes.io/zh/docs/home/</a><br>ç¤¾åŒºæ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://docs.kubernetes.org.cn/">https://docs.kubernetes.org.cn/</a></p>
<p>éƒ¨ç½²æ–¹å¼çš„è¿›åŒ–ï¼š</p>
<p> <img src="https://d33wubrfki0l68.cloudfront.net/26a177ede4d7b032362289c6fccd448fc4a91174/eb693/images/docs/container_evolution.svg" alt="éƒ¨ç½²æ¼”è¿›"> </p>
<p><img src="/img/spring-cloud/image-20200503105948619.png" alt="image-20200503105948619"></p>
<p><img src="/img/spring-cloud/image-20200503110101659.png" alt="image-20200503110101659"></p>
<h3 id="2ï¼‰æ¶æ„"><a href="#2ï¼‰æ¶æ„" class="headerlink" title="2ï¼‰æ¶æ„"></a>2ï¼‰æ¶æ„</h3><h4 id="ï¼ˆ1ï¼‰æ•´ä½“ä¸»ä»æ–¹å¼"><a href="#ï¼ˆ1ï¼‰æ•´ä½“ä¸»ä»æ–¹å¼" class="headerlink" title="ï¼ˆ1ï¼‰æ•´ä½“ä¸»ä»æ–¹å¼"></a>ï¼ˆ1ï¼‰æ•´ä½“ä¸»ä»æ–¹å¼</h4><p><img src="/img/spring-cloud/image-20200503110244940.png" alt="image-20200503110244940"></p>
<p><img src="/img/spring-cloud/image-20200503110350256.png" alt="image-20200503110350256"></p>
<h4 id="ï¼ˆ2ï¼‰masterèŠ‚ç‚¹æ¶æ„"><a href="#ï¼ˆ2ï¼‰masterèŠ‚ç‚¹æ¶æ„" class="headerlink" title="ï¼ˆ2ï¼‰masterèŠ‚ç‚¹æ¶æ„"></a>ï¼ˆ2ï¼‰masterèŠ‚ç‚¹æ¶æ„</h4><p><img src="/img/spring-cloud/image-20200503110458806.png" alt="image-20200503110458806"></p>
<p><img src="/img/spring-cloud/image-20200503110631219.png" alt="image-20200503110631219"></p>
<p><img src="/img/spring-cloud/image-20200503110732773.png" alt="image-20200503110732773"></p>
<h4 id="ï¼ˆ3ï¼‰NodeèŠ‚ç‚¹æ¶æ„"><a href="#ï¼ˆ3ï¼‰NodeèŠ‚ç‚¹æ¶æ„" class="headerlink" title="ï¼ˆ3ï¼‰NodeèŠ‚ç‚¹æ¶æ„"></a>ï¼ˆ3ï¼‰NodeèŠ‚ç‚¹æ¶æ„</h4><p><img src="/img/spring-cloud/image-20200503110804361.png" alt="image-20200503110804361"></p>
<p><img src="/img/spring-cloud/image-20200503111032457.png" alt="image-20200503111032457"></p>
<h3 id="3ï¼‰æ¦‚å¿µ"><a href="#3ï¼‰æ¦‚å¿µ" class="headerlink" title="3ï¼‰æ¦‚å¿µ"></a>3ï¼‰æ¦‚å¿µ</h3><p><img src="/img/spring-cloud/image-20200503112551188.png" alt="image-20200503112551188"></p>
<p><img src="/img/spring-cloud/image-20200503112627449.png" alt="image-20200503112627449"></p>
<p><img src="/img/spring-cloud/image-20200503112723747.png" alt="image-20200503112723747"></p>
<p><img src="/img/spring-cloud/image-20200503112810938.png" alt="image-20200503112810938"></p>
<p><img src="/img/spring-cloud/image-20200503113055314.png" alt="image-20200503113055314"></p>
<p><img src="/img/spring-cloud/image-20200503113619233.png" alt="image-20200503113619233"></p>
<p><img src="/img/spring-cloud/image-20200503113701902.png" alt="image-20200503113701902"></p>
<h3 id="4ï¼‰å¿«é€Ÿä½“éªŒ"><a href="#4ï¼‰å¿«é€Ÿä½“éªŒ" class="headerlink" title="4ï¼‰å¿«é€Ÿä½“éªŒ"></a>4ï¼‰å¿«é€Ÿä½“éªŒ</h3><h4 id="ï¼ˆ1ï¼‰å®‰è£…minikube"><a href="#ï¼ˆ1ï¼‰å®‰è£…minikube" class="headerlink" title="ï¼ˆ1ï¼‰å®‰è£…minikube"></a>ï¼ˆ1ï¼‰å®‰è£…minikube</h4><p><a target="_blank" rel="noopener" href="https://github.com/kubernetes/minikube/releases">https://github.com/kubernetes/minikube/releases</a><br>ä¸‹è½½minikuber-windows-amd64.exe æ”¹åä¸ºminikube.exe<br>æ‰“å¼€virtualBoxï¼Œæ‰“å¼€cmd<br>è¿è¡Œ<br>minikube start â€“vm-driver=virtualbox â€“registry-mirror=<a target="_blank" rel="noopener" href="https://registry.docker-cn.com/">https://registry.docker-cn.com</a><br>ç­‰å¾…20åˆ†é’Ÿå³å¯ã€‚</p>
<h4 id="ï¼ˆ2ï¼‰ä½“éªŒnginxéƒ¨ç½²å‡çº§"><a href="#ï¼ˆ2ï¼‰ä½“éªŒnginxéƒ¨ç½²å‡çº§" class="headerlink" title="ï¼ˆ2ï¼‰ä½“éªŒnginxéƒ¨ç½²å‡çº§"></a>ï¼ˆ2ï¼‰ä½“éªŒnginxéƒ¨ç½²å‡çº§</h4><ol>
<li><p>æäº¤ä¸€ä¸ªnginx deployment<br>kubectl apply -f <a target="_blank" rel="noopener" href="https://k8s.io/examples/application/deployment.yaml">https://k8s.io/examples/application/deployment.yaml</a></p>
</li>
<li><p>å‡çº§ nginx deployment<br>kubectl apply -f <a target="_blank" rel="noopener" href="https://k8s.io/examples/application/deployment-update.yaml">https://k8s.io/examples/application/deployment-update.yaml</a></p>
</li>
<li><p>æ‰©å®¹ nginx deployment</p>
</li>
</ol>
<h2 id="2ã€K8sé›†ç¾¤å®‰è£…"><a href="#2ã€K8sé›†ç¾¤å®‰è£…" class="headerlink" title="2ã€K8sé›†ç¾¤å®‰è£…"></a>2ã€K8sé›†ç¾¤å®‰è£…</h2><h3 id="1ï¼‰kubeadm"><a href="#1ï¼‰kubeadm" class="headerlink" title="1ï¼‰kubeadm"></a>1ï¼‰kubeadm</h3><p>kubeadmæ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetersé›†ç¾¤çš„å·¥å…·ã€‚<br>è¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetersé›†ç¾¤çš„éƒ¨ç½²</p>
<p>åˆ›å»ºä¸€ä¸ªmasterèŠ‚ç‚¹</p>
<pre class="line-numbers language-none"><code class="language-none">$ kuberneters init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å°†ä¸€ä¸ªnodeèŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubeadm join &lt;MasterèŠ‚ç‚¹çš„IPå’Œç«¯å£&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h3 id="2ï¼‰å‰ç½®è¦æ±‚"><a href="#2ï¼‰å‰ç½®è¦æ±‚" class="headerlink" title="2ï¼‰å‰ç½®è¦æ±‚"></a>2ï¼‰å‰ç½®è¦æ±‚</h3><p>ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»ŸCentos7.x-86_x64<br>ç¡¬ä»¶é…ç½®ï¼š2GBæˆ–æ›´å¤šRAMï¼Œ2ä¸ªCPUæˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GBæˆ–æ›´å¤š<br>é›†ç¾¤ä¸­æ‰€æœ‰çš„æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š<br>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ<br>ç¦æ­¢Swapåˆ†åŒº</p>
<h3 id="3ï¼‰éƒ¨ç½²æ­¥éª¤"><a href="#3ï¼‰éƒ¨ç½²æ­¥éª¤" class="headerlink" title="3ï¼‰éƒ¨ç½²æ­¥éª¤"></a>3ï¼‰éƒ¨ç½²æ­¥éª¤</h3><ol>
<li>åœ¨æ‰€æœ‰çš„èŠ‚ç‚¹ä¸Šå®‰è£…Dockerå’Œkubeadm</li>
<li>ä¸æ˜¯Kubernetes Master</li>
<li>éƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶</li>
<li>éƒ¨ç½²Kubernetes Nodeï¼Œå°†èŠ‚ç‚¹åŠ å…¥Kubernetesé›†ç¾¤ä¸­</li>
<li>éƒ¨ç½²DashBoard webé¡µé¢ï¼Œå¯è§†åŒ–æŸ¥çœ‹Kubernetesèµ„æº</li>
</ol>
<p><img src="/img/spring-cloud/image-20200503144120720.png" alt="image-20200503144120720"></p>
<h3 id="4ï¼‰ç¯å¢ƒå‡†å¤‡"><a href="#4ï¼‰ç¯å¢ƒå‡†å¤‡" class="headerlink" title="4ï¼‰ç¯å¢ƒå‡†å¤‡"></a>4ï¼‰ç¯å¢ƒå‡†å¤‡</h3><h4 id="ï¼ˆ1ï¼‰å‡†å¤‡å·¥ä½œ"><a href="#ï¼ˆ1ï¼‰å‡†å¤‡å·¥ä½œ" class="headerlink" title="ï¼ˆ1ï¼‰å‡†å¤‡å·¥ä½œ"></a>ï¼ˆ1ï¼‰å‡†å¤‡å·¥ä½œ</h4><ul>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨vagrantå¿«é€Ÿåˆ›å»ºä¸‰ä¸ªè™šæ‹Ÿæœºã€‚è™šæ‹Ÿæœºå¯åŠ¨å‰å…ˆè®¾ç½®virtualboxçš„ä¸»æœºç½‘ç»œã€‚ç°åœ¨å…¨éƒ¨ç»Ÿä¸€ä¸º192.168.56.1ï¼Œä»¥åæ‰€æœ‰è™šæ‹Ÿæœºéƒ½æ˜¯56.xçš„ipåœ°å€ã€‚</li>
</ul>
<p><img src="/img/spring-cloud/image-20200503175351320.png" alt="image-20200503175351320"></p>
<ul>
<li>åœ¨å…¨å±€è®¾å®šä¸­ï¼Œæ‰¾åˆ°ä¸€ä¸ªç©ºé—´æ¯”è¾ƒå¤§çš„ç£ç›˜ç”¨ç”¨æ¥å­˜æ”¾é•œåƒã€‚ </li>
</ul>
<p><img src="/img/spring-cloud/image-20200503180202640.png" alt="image-20200503180202640"></p>
<h4 id="ï¼ˆ2ï¼‰å¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœº"><a href="#ï¼ˆ2ï¼‰å¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœº" class="headerlink" title="ï¼ˆ2ï¼‰å¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœº"></a>ï¼ˆ2ï¼‰å¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœº</h4><ul>
<li>ä½¿ç”¨æˆ‘ä»¬æä¾›çš„vagrantæ–‡ä»¶ï¼Œå¤åˆ¶åˆ°éä¸­æ–‡æ— ç©ºæ ¼ç›®å½•ä¸‹ï¼Œè¿è¡Œvagrant upå¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœºã€‚å…¶å®vagrantå®Œå…¨å¯ä»¥ä¸€é”®éƒ¨ç½²å…¨éƒ¨K8sé›†ç¾¤<br><a target="_blank" rel="noopener" href="https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster">https://github.com/rootsongjc/kubernetes-vagrant-centos-cluster</a><br><a target="_blank" rel="noopener" href="http://github.com/davidkbainbridge/k8s-playground">http://github.com/davidkbainbridge/k8s-playground</a></li>
</ul>
<p>ä¸‹é¢æ˜¯vagrantfileï¼Œä½¿ç”¨å®ƒæ¥åˆ›å»ºä¸‰ä¸ªè™šæ‹Ÿæœºï¼Œåˆ†åˆ«ä¸ºk8s-node1ï¼Œk8s-node2å’Œk8s-node3.</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">Vagrant.configure("2") do <span class="token punctuation">|</span>config<span class="token punctuation">|</span>
   (1..3).each do <span class="token punctuation">|</span>i<span class="token punctuation">|</span>
        config.vm.define "k8s<span class="token punctuation">-</span>node<span class="token comment">#&#123;i&#125;" do |node|</span>
            <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„Box</span>
            node.vm.box = "centos/7"

            <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„ä¸»æœºå</span>
            node.vm.hostname="k8s<span class="token punctuation">-</span>node<span class="token comment">#&#123;i&#125;"</span>

            <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„IP</span>
            node.vm.network "private_network"<span class="token punctuation">,</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> <span class="token string">"192.168.56.#&#123;99+i&#125;"</span><span class="token punctuation">,</span> <span class="token key atrule">netmask</span><span class="token punctuation">:</span> <span class="token string">"255.255.255.0"</span>

            <span class="token comment"># è®¾ç½®ä¸»æœºä¸è™šæ‹Ÿæœºçš„å…±äº«ç›®å½•</span>
            <span class="token comment"># node.vm.synced_folder "~/Documents/vagrant/share", "/home/vagrant/share"</span>

            <span class="token comment"># VirtaulBoxç›¸å…³é…ç½®</span>
            node.vm.provider "virtualbox" do <span class="token punctuation">|</span>v<span class="token punctuation">|</span>
                <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„åç§°</span>
                v.name = "k8s<span class="token punctuation">-</span>node<span class="token comment">#&#123;i&#125;"</span>
                <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„å†…å­˜å¤§å°</span>
                v.memory = 4096
                <span class="token comment"># è®¾ç½®è™šæ‹Ÿæœºçš„CPUä¸ªæ•°</span>
                v.cpus = 4
            end
        end
   end
end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<ul>
<li>è¿›å…¥åˆ°ä¸‰ä¸ªè™šæ‹Ÿæœºï¼Œå¼€å¯rootçš„å¯†ç è®¿é—®æƒé™</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">Vagrant <span class="token function">ssh</span> xxxè¿›å…¥åˆ°ç³»ç»Ÿå

<span class="token function">su</span> root å¯†ç ä¸ºvagrant

<span class="token function">vi</span> /etc/ssh/sshd_config

ä¿®æ”¹
PermitRootLogin <span class="token function">yes</span> 
PasswordAuthentication <span class="token function">yes</span>

æ‰€æœ‰çš„è™šæ‹Ÿæœºè®¾ä¸º4æ ¸4G<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>å…³äºåœ¨â€ç½‘ç»œåœ°å€è½¬æ¢â€çš„è¿æ¥æ–¹å¼ä¸‹ï¼Œä¸‰ä¸ªèŠ‚ç‚¹çš„eth0ï¼ŒIPåœ°å€ç›¸åŒçš„é—®é¢˜ã€‚</p>
<p><strong>é—®é¢˜æè¿°ï¼š</strong>æŸ¥çœ‹k8s-node1çš„è·¯ç”±è¡¨ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]# ip route show
default via 10.0.2.2 dev eth0 proto dhcp metric 100 
10.0.2.0&#x2F;24 dev eth0 proto kernel scope link src 10.0.2.15 metric 100 
192.168.56.0&#x2F;24 dev eth1 proto kernel scope link src 192.168.56.100 metric 101 
[root@k8s-node1 ~<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>èƒ½å¤Ÿçœ‹åˆ°è·¯ç”±è¡¨ä¸­è®°å½•çš„æ˜¯ï¼Œé€šè¿‡ç«¯å£eth0è¿›è¡Œæ•°æ®åŒ…çš„æ”¶å‘ã€‚</p>
<p>åˆ†åˆ«æŸ¥çœ‹k8s-node1ï¼Œk8s-node2å’Œk8s-node3çš„eth0æ‰€ç»‘å®šçš„IPåœ°å€ï¼Œå‘ç°å®ƒä»¬éƒ½æ˜¯ç›¸åŒçš„ï¼Œå…¨éƒ½æ˜¯10.0.2.15ï¼Œè¿™äº›åœ°å€æ˜¯ä¾›kubernetesé›†ç¾¤é€šä¿¡ç”¨çš„ï¼ŒåŒºåˆ«äºeth1ä¸Šçš„IPåœ°å€ï¼Œæ˜¯é€šè¿œç¨‹ç®¡ç†ä½¿ç”¨çš„ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># ip addr</span>
<span class="token punctuation">..</span>.
<span class="token number">2</span>: eth0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether <span class="token number">52</span>:54:00:8a:fe:e6 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">10.0</span>.2.15/24 brd <span class="token number">10.0</span>.2.255 scope global noprefixroute dynamic eth0
       valid_lft 84418sec preferred_lft 84418sec
    inet6 fe80::5054:ff:fe8a:fee6/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: eth1: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">></span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 08:00:27:a3:ca:c0 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.56.100/24 brd <span class="token number">192.168</span>.56.255 scope global noprefixroute eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fea3:cac0/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong>åŸå› åˆ†æï¼š</strong>è¿™æ˜¯å› ä¸ºå®ƒä»¬ä½¿ç”¨æ˜¯ç«¯å£è½¬å‘è§„åˆ™ï¼Œä½¿ç”¨åŒä¸€ä¸ªåœ°å€ï¼Œé€šè¿‡ä¸åŒçš„ç«¯å£æ¥åŒºåˆ†ã€‚ä½†æ˜¯è¿™ç§ç«¯å£è½¬å‘è§„åˆ™åœ¨ä»¥åçš„ä½¿ç”¨ä¸­ä¼šäº§ç”Ÿå¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸ºNATç½‘ç»œç±»å‹ã€‚</p>
<p><img src="/img/spring-cloud/image-20200503184536343.png" alt="image-20200503184536343"></p>
<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>
<ul>
<li>é€‰æ‹©ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œç„¶åæ‰§è¡Œâ€œç®¡ç†â€-&gt;â€å…¨å±€è®¾å®šâ€-&gt;â€œç½‘ç»œâ€ï¼Œæ·»åŠ ä¸€ä¸ªNATç½‘ç»œã€‚</li>
</ul>
<img src="images/image-20200503184919936.png" alt="image-20200503184919936" style="zoom:67%;" />

<ul>
<li>åˆ†åˆ«ä¿®æ”¹æ¯å°è®¾å¤‡çš„ç½‘ç»œç±»å‹ï¼Œå¹¶åˆ·æ–°é‡æ–°ç”ŸæˆMACåœ°å€ã€‚</li>
</ul>
<img src="images/image-20200503185344246.png" alt="image-20200503185344246" style="zoom: 50%;" />



<ul>
<li>å†æ¬¡æŸ¥çœ‹ä¸‰ä¸ªèŠ‚ç‚¹çš„IP</li>
</ul>
<img src="images/image-20200503190101156.png" alt="image-20200503190101156" style="zoom:50%;" />





<h4 id="ï¼ˆ3ï¼‰è®¾ç½®Linuxç¯å¢ƒï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œï¼‰"><a href="#ï¼ˆ3ï¼‰è®¾ç½®Linuxç¯å¢ƒï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰è®¾ç½®Linuxç¯å¢ƒï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œï¼‰"></a>ï¼ˆ3ï¼‰è®¾ç½®Linuxç¯å¢ƒï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œï¼‰</h4><ul>
<li>å…³é—­é˜²ç«å¢™</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl stop firewalld
systemctl disable firewalld<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>å…³é—­Linux</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">sed -i &#39;s&#x2F;enforcing&#x2F;disabled&#x2F;&#39; &#x2F;etc&#x2F;selinux&#x2F;config
setenforce 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<ul>
<li>å…³é—­swap </li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">swapoff -a <span class="token comment">#ä¸´æ—¶å…³é—­</span>
<span class="token function">sed</span> -ri <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab <span class="token comment">#æ°¸ä¹…å…³é—­</span>
<span class="token function">free</span> -g <span class="token comment">#éªŒè¯ï¼Œswapå¿…é¡»ä¸º0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<ul>
<li>æ·»åŠ ä¸»æœºåä¸IPå¯¹åº”å…³ç³»ï¼š</li>
</ul>
<p>æŸ¥çœ‹ä¸»æœºåï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">hostname<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¦‚æœä¸»æœºåä¸æ­£ç¡®ï¼Œå¯ä»¥é€šè¿‡â€œhostnamectl set-hostname &lt;newhostname&gt; :æŒ‡å®šæ–°çš„hostnameâ€å‘½ä»¤æ¥è¿›è¡Œä¿®æ”¹ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">vi</span> /etc/hosts
<span class="token number">10.0</span>.2.15 k8s-node1
<span class="token number">10.0</span>.2.4 k8s-node2
<span class="token number">10.0</span>.2.5 k8s-node3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p>å°†æ¡¥æ¥çš„IPV4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> <span class="token operator">></span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF

net.bridge.bridge-nf-call-ip6tables = 1

net.bridge.bridge-nf-call-iptables = 1

EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åº”ç”¨è§„åˆ™ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">sysctl --system<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>ç–‘éš¾é—®é¢˜ï¼šé‡è§æç¤ºæ˜¯åªè¯»çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤</p>
<pre class="line-numbers language-none"><code class="language-none">mount -o remount rw &#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<ul>
<li>date æŸ¥çœ‹æ—¶é—´ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum -y <span class="token function">install</span> ntpupdate

ntpupdate time.window.com <span class="token comment">#åŒæ­¥æœ€æ–°æ—¶é—´</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h3 id="5ï¼‰æ‰€æœ‰èŠ‚ç‚¹å®‰è£…dockerã€kubeadmã€kubeletã€kubectl"><a href="#5ï¼‰æ‰€æœ‰èŠ‚ç‚¹å®‰è£…dockerã€kubeadmã€kubeletã€kubectl" class="headerlink" title="5ï¼‰æ‰€æœ‰èŠ‚ç‚¹å®‰è£…dockerã€kubeadmã€kubeletã€kubectl"></a>5ï¼‰æ‰€æœ‰èŠ‚ç‚¹å®‰è£…dockerã€kubeadmã€kubeletã€kubectl</h3><p>Kubenetesé»˜è®¤CRIï¼ˆå®¹å™¨è¿è¡Œæ—¶ï¼‰ä¸ºDockerï¼Œå› æ­¤å…ˆå®‰è£…Dockerã€‚</p>
<h4 id="ï¼ˆ1ï¼‰å®‰è£…Docker"><a href="#ï¼ˆ1ï¼‰å®‰è£…Docker" class="headerlink" title="ï¼ˆ1ï¼‰å®‰è£…Docker"></a>ï¼ˆ1ï¼‰å®‰è£…Docker</h4><p>1ã€å¸è½½ä¹‹å‰çš„docker</p>
<pre class="line-numbers language-none"><code class="language-none">$ sudo yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2ã€å®‰è£…Docker  -CE</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y yum-utils

$ <span class="token function">sudo</span> yum-config-manager <span class="token punctuation">\</span>
    --add-repo <span class="token punctuation">\</span>
    https://download.docker.com/linux/centos/docker-ce.repo
    
$ <span class="token function">sudo</span> yum -y <span class="token function">install</span> docker-ce docker-ce-cli containerd.io   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>3ã€é…ç½®é•œåƒåŠ é€Ÿ</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /etc/docker
<span class="token function">sudo</span> <span class="token function">tee</span> /etc/docker/daemon.json <span class="token operator">&lt;&lt;-</span><span class="token string">'EOF'
&#123;
  "registry-mirrors": ["https://ke9h1pt4.mirror.aliyuncs.com"]
&#125;
EOF</span>
<span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart docker<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>4ã€å¯åŠ¨Docker &amp;&amp; è®¾ç½®dockerå¼€æœºå¯åŠ¨</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl <span class="token builtin class-name">enable</span> docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>åŸºç¡€ç¯å¢ƒå‡†å¤‡å¥½ï¼Œå¯ä»¥ç»™ä¸‰ä¸ªè™šæ‹Ÿæœºå¤‡ä»½ä¸€ä¸‹ï¼›</p>
<p><img src="/img/spring-cloud/image-20200503192940651.png" alt="image-20200503192940651"></p>
<h4 id="ï¼ˆ2ï¼‰æ·»åŠ é˜¿é‡Œä¸Yumæº"><a href="#ï¼ˆ2ï¼‰æ·»åŠ é˜¿é‡Œä¸Yumæº" class="headerlink" title="ï¼ˆ2ï¼‰æ·»åŠ é˜¿é‡Œä¸Yumæº"></a>ï¼ˆ2ï¼‰æ·»åŠ é˜¿é‡Œä¸Yumæº</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">></span> /etc/yum.repos.d/kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ›´å¤šè¯¦æƒ…è§ï¼š <a target="_blank" rel="noopener" href="https://developer.aliyun.com/mirror/kubernetes">https://developer.aliyun.com/mirror/kubernetes</a> </p>
<h4 id="ï¼ˆ3ï¼‰å®‰è£…kubeadmï¼Œkubeletå’Œkubectl"><a href="#ï¼ˆ3ï¼‰å®‰è£…kubeadmï¼Œkubeletå’Œkubectl" class="headerlink" title="ï¼ˆ3ï¼‰å®‰è£…kubeadmï¼Œkubeletå’Œkubectl"></a>ï¼ˆ3ï¼‰å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</h4><pre class="line-numbers language-none"><code class="language-none">yum list|grep kube<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å®‰è£…</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">yum <span class="token function">install</span> -y kubelet-1.17.3 kubeadm-1.17.3 kubectl-1.17.3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>å¼€æœºå¯åŠ¨</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>æŸ¥çœ‹kubeletçš„çŠ¶æ€ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">systemctl status kubelet<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æŸ¥çœ‹kubeletç‰ˆæœ¬ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node2 ~<span class="token punctuation">]</span><span class="token comment"># kubelet --version</span>
Kubernetes v1.17.3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<h3 id="6ï¼‰éƒ¨ç½²k8s-master"><a href="#6ï¼‰éƒ¨ç½²k8s-master" class="headerlink" title="6ï¼‰éƒ¨ç½²k8s-master"></a>6ï¼‰éƒ¨ç½²k8s-master</h3><h4 id="ï¼ˆ1ï¼‰masterèŠ‚ç‚¹åˆå§‹åŒ–"><a href="#ï¼ˆ1ï¼‰masterèŠ‚ç‚¹åˆå§‹åŒ–" class="headerlink" title="ï¼ˆ1ï¼‰masterèŠ‚ç‚¹åˆå§‹åŒ–"></a>ï¼ˆ1ï¼‰masterèŠ‚ç‚¹åˆå§‹åŒ–</h4><p>åœ¨MasterèŠ‚ç‚¹ä¸Šï¼Œåˆ›å»ºå¹¶æ‰§è¡Œmaster_images.sh</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">#!&#x2F;bin&#x2F;bash

images&#x3D;(
	kube-apiserver:v1.17.3
    kube-proxy:v1.17.3
	kube-controller-manager:v1.17.3
	kube-scheduler:v1.17.3
	coredns:1.6.5
	etcd:3.4.3-0
    pause:3.1
)

for imageName in $&#123;images[@]&#125; ; do
    docker pull registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName
#   docker tag registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers&#x2F;$imageName  k8s.gcr.io&#x2F;$imageName
done<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>




<p>åˆå§‹åŒ–kubeadm</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ kubeadm init <span class="token punctuation">\</span>
--apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.0</span>.2.15 <span class="token punctuation">\</span>
--image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span class="token punctuation">\</span>
--kubernetes-version   v1.17.3 <span class="token punctuation">\</span>
--service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/16  <span class="token punctuation">\</span>
--pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æ³¨ï¼š</p>
<ul>
<li>â€“apiserver-advertise-address=10.0.2.21 ï¼šè¿™é‡Œçš„IPåœ°å€æ˜¯masterä¸»æœºçš„åœ°å€ï¼Œä¸ºä¸Šé¢çš„eth0ç½‘å¡çš„åœ°å€ï¼›</li>
<li></li>
</ul>
<p>æ‰§è¡Œç»“æœï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># kubeadm init \</span>
<span class="token operator">></span> --apiserver-advertise-address<span class="token operator">=</span><span class="token number">10.0</span>.2.15 <span class="token punctuation">\</span>
<span class="token operator">></span> --image-repository registry.cn-hangzhou.aliyuncs.com/google_containers <span class="token punctuation">\</span>
<span class="token operator">></span> --kubernetes-version   v1.17.3 <span class="token punctuation">\</span>
<span class="token operator">></span> --service-cidr<span class="token operator">=</span><span class="token number">10.96</span>.0.0/16  <span class="token punctuation">\</span>
<span class="token operator">></span> --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16
W0503 <span class="token number">14</span>:07:12.594252   <span class="token number">10124</span> configset.go:202<span class="token punctuation">]</span> WARNING: kubeadm cannot validate component configs <span class="token keyword">for</span> API <span class="token function">groups</span> <span class="token punctuation">[</span>kubelet.config.k8s.io kubeproxy.config.k8s.io<span class="token punctuation">]</span>
<span class="token punctuation">[</span>init<span class="token punctuation">]</span> Using Kubernetes version: v1.17.3
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
        <span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">"cgroupfs"</span> as the Docker cgroup driver. The recommended driver is <span class="token string">"systemd"</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Pulling images required <span class="token keyword">for</span> setting up a Kubernetes cluster
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> This might take a minute or two, depending on the speed of your internet connection
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> You can also perform this action <span class="token keyword">in</span> beforehand using <span class="token string">'kubeadm config images pull'</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/kubeadm-flags.env"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">"/var/lib/kubelet/config.yaml"</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Using certificateDir folder <span class="token string">"/etc/kubernetes/pki"</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"ca"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"apiserver"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> apiserver serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.96</span>.0.1 <span class="token number">10.0</span>.2.15<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"apiserver-kubelet-client"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"front-proxy-ca"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"front-proxy-client"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"etcd/ca"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"etcd/server"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/server serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.0</span>.2.15 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"etcd/peer"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/peer serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>k8s-node1 localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.0</span>.2.15 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"etcd/healthcheck-client"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"apiserver-etcd-client"</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">"sa"</span> key and public key
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Using kubeconfig folder <span class="token string">"/etc/kubernetes"</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">"admin.conf"</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">"kubelet.conf"</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">"controller-manager.conf"</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">"scheduler.conf"</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Using manifest folder <span class="token string">"/etc/kubernetes/manifests"</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">"kube-apiserver"</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">"kube-controller-manager"</span>
W0503 <span class="token number">14</span>:07:30.908642   <span class="token number">10124</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">"Node,RBAC"</span><span class="token punctuation">;</span> using <span class="token string">"Node,RBAC"</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">"kube-scheduler"</span>
W0503 <span class="token number">14</span>:07:30.911330   <span class="token number">10124</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">"Node,RBAC"</span><span class="token punctuation">;</span> using <span class="token string">"Node,RBAC"</span>
<span class="token punctuation">[</span>etcd<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token builtin class-name">local</span> etcd <span class="token keyword">in</span> <span class="token string">"/etc/kubernetes/manifests"</span>
<span class="token punctuation">[</span>wait-control-plane<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="token string">"/etc/kubernetes/manifests"</span><span class="token builtin class-name">.</span> This can take up to 4m0s
<span class="token punctuation">[</span>apiclient<span class="token punctuation">]</span> All control plane components are healthy after <span class="token number">22.506521</span> seconds
<span class="token punctuation">[</span>upload-config<span class="token punctuation">]</span> Storing the configuration used <span class="token keyword">in</span> ConfigMap <span class="token string">"kubeadm-config"</span> <span class="token keyword">in</span> the <span class="token string">"kube-system"</span> Namespace
<span class="token punctuation">[</span>kubelet<span class="token punctuation">]</span> Creating a ConfigMap <span class="token string">"kubelet-config-1.18"</span> <span class="token keyword">in</span> namespace kube-system with the configuration <span class="token keyword">for</span> the kubelets <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>upload-certs<span class="token punctuation">]</span> Skipping phase. Please see --upload-certs
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the node k8s-node1 as control-plane by adding the label <span class="token string">"node-role.kubernetes.io/master=''"</span>
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the node k8s-node1 as control-plane by adding the taints <span class="token punctuation">[</span>node-role.kubernetes.io/master:NoSchedule<span class="token punctuation">]</span>
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Using token: sg47f3.4asffoi6ijb8ljhq
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to get nodes
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="token keyword">in</span> order <span class="token keyword">for</span> nodes to get long term certificate credentials
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow certificate rotation <span class="token keyword">for</span> all node client certificates <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Creating the <span class="token string">"cluster-info"</span> ConfigMap <span class="token keyword">in</span> the <span class="token string">"kube-public"</span> namespace
<span class="token punctuation">[</span>kubelet-finalize<span class="token punctuation">]</span> Updating <span class="token string">"/etc/kubernetes/kubelet.conf"</span> to point to a rotatable kubelet client certificate and key
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy
<span class="token comment">#è¡¨ç¤ºkuberneteså·²ç»åˆå§‹åŒ–æˆåŠŸäº†</span>
Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">"kubectl apply -f [podnetwork].yaml"</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb 
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€k8s.cr.ioå›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘ä»“åº“åœ°å€ã€‚å¯ä»¥æ‰‹åŠ¨æŒ‰ç…§æˆ‘ä»¬çš„images.shå…ˆæ‹‰å–é•œåƒã€‚</p>
<p>åœ°å€å˜ä¸ºï¼šregistry.aliyuncs.com/googole_containersä¹Ÿå¯ä»¥ã€‚<br>ç§‘æ™®ï¼šæ— ç±»åˆ«åŸŸé—´è·¯ç”±ï¼ˆClassless Inter-Domain Routing ã€CIDRï¼‰æ˜¯ä¸€ä¸ªç”¨äºç»™ç”¨æˆ·åˆ†é…IPåœ°å€ä»¥åŠåœ¨äº’è”ç½‘ä¸Šæœ‰æ•ˆç¬¬è·¯ç”±IPæ•°æ®åŒ…çš„å¯¹IPåœ°å€è¿›è¡Œå½’ç±»çš„æ–¹æ³•ã€‚<br>æ‹‰å–å¯èƒ½å¤±è´¥ï¼Œéœ€è¦ä¸‹è½½é•œåƒã€‚</p>
<p>è¿è¡Œå®Œæˆæå‰å¤åˆ¶ï¼šåŠ å…¥é›†ç¾¤çš„ä»¤ç‰Œã€‚</p>
<h4 id="ï¼ˆ2ï¼‰æµ‹è¯•Kubectlï¼ˆä¸»èŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#ï¼ˆ2ï¼‰æµ‹è¯•Kubectlï¼ˆä¸»èŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰æµ‹è¯•Kubectlï¼ˆä¸»èŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>ï¼ˆ2ï¼‰æµ‹è¯•Kubectlï¼ˆä¸»èŠ‚ç‚¹æ‰§è¡Œï¼‰</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
<span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
<span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>è¯¦ç»†éƒ¨ç½²æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ kubectl get nodes <span class="token comment">#è·å–æ‰€æœ‰èŠ‚ç‚¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç›®å‰MasterçŠ¶æ€ä¸ºnotreadyã€‚ç­‰å¾…ç½‘ç»œåŠ å…¥å®Œæˆå³å¯ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ journalctl -u kubelet <span class="token comment">#æŸ¥çœ‹kubeletæ—¥å¿—</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="7ï¼‰å®‰è£…PODç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰"><a href="#7ï¼‰å®‰è£…PODç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰" class="headerlink" title="7ï¼‰å®‰è£…PODç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰"></a>7ï¼‰å®‰è£…PODç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰</h3><p>åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡ŒæŒ‰ç…§PODç½‘ç»œæ’ä»¶</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl apply -f \
https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;coreos&#x2F;flanne&#x2F;master&#x2F;Documentation&#x2F;kube-flannel.yml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ä»¥ä¸Šåœ°å€å¯èƒ½è¢«å¢™ï¼Œå¯ä»¥ç›´æ¥è·å–æœ¬åœ°å·²ç»ä¸‹è½½çš„flannel.ymlè¿è¡Œå³å¯ï¼Œå¦‚ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f  kube-flannel.yml    </span>
podsecuritypolicy.policy/psp.flannel.unprivileged created
clusterrole.rbac.authorization.k8s.io/flannel created
clusterrolebinding.rbac.authorization.k8s.io/flannel created
serviceaccount/flannel created
configmap/kube-flannel-cfg created
daemonset.apps/kube-flannel-ds-amd64 created
daemonset.apps/kube-flannel-ds-arm64 created
daemonset.apps/kube-flannel-ds-arm created
daemonset.apps/kube-flannel-ds-ppc64le created
daemonset.apps/kube-flannel-ds-s390x created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åŒæ—¶flannel.ymlä¸­æŒ‡å®šçš„imagesè®¿é—®ä¸åˆ°å¯ä»¥å»docker hubæ‰¾ä¸€ä¸ªwget ymlåœ°å€<br>vi ä¿®æ”¹yml æ‰€æœ‰amd64çš„åœ°å€ä¿®æ”¹äº†å³å¯<br>ç­‰å¾…å¤§çº¦3åˆ†é’Ÿ<br>kubectl get pods -n kube-system æŸ¥çœ‹æŒ‡å®šåç§°ç©ºé—´çš„pods<br>kubectl get pods -all-namespace æŸ¥çœ‹æ‰€æœ‰åç§°ç©ºé—´çš„pods</p>
<p>$ ip link set cni0 down å¦‚æœç½‘ç»œå‡ºç°é—®é¢˜ï¼Œå…³é—­cni0ï¼Œé‡å¯è™šæ‹Ÿæœºç»§ç»­æµ‹è¯•<br>æ‰§è¡Œwatch kubectl get pod -n kube-system -o wide ç›‘æ§podè¿›åº¦<br>ç­‰å¾…3-10åˆ†é’Ÿï¼Œå®Œå…¨éƒ½æ˜¯runningä»¥åç»§ç»­</p>
<p>æŸ¥çœ‹å‘½åç©ºé—´ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 k8s]# kubectl get ns
NAME              STATUS   AGE
default           Active   30m
kube-node-lease   Active   30m
kube-public       Active   30m
kube-system       Active   30m
[root@k8s-node1 k8s]#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces       </span>
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
kube-system   coredns-546565776c-9sbmk            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          31m
kube-system   coredns-546565776c-t68mr            <span class="token number">0</span>/1     Pending   <span class="token number">0</span>          31m
kube-system   etcd-k8s-node1                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          2m50s
kube-system   kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
kube-system   kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          31m
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> æŸ¥çœ‹masterä¸Šçš„èŠ‚ç‚¹ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME        STATUS   ROLES    AGE   VERSION
k8s-node1   Ready    master   34m   v1.17.3   <span class="token comment">#statusä¸ºreadyæ‰èƒ½å¤Ÿæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</span>
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åå†æ¬¡æ‰§è¡Œï¼Œå¹¶ä¸”åˆ†åˆ«åœ¨â€œk8s-node2â€å’Œâ€œk8s-node3â€ä¸Šä¹Ÿæ‰§è¡Œè¿™é‡Œå‘½ä»¤ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubeadm <span class="token function">join</span> <span class="token number">10.0</span>.2.15:6443 --token sg47f3.4asffoi6ijb8ljhq <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:81fccdd29970cbc1b7dc7f171ac0234d53825bdf9b05428fc9e6767436991bfb <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes;</span>
NAME        STATUS     ROLES    AGE   VERSION
k8s-node1   Ready      master   47m   v1.17.3
k8s-node2   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   75s   v1.17.3
k8s-node3   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   76s   v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 opt<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ç›‘æ§podè¿›åº¦</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token function">watch</span> kubectl get pod -n kube-system -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç­‰åˆ°æ‰€æœ‰çš„statuséƒ½å˜ä¸ºrunningçŠ¶æ€åï¼Œå†æ¬¡æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#  kubectl get nodes;                         </span>
NAME        STATUS   ROLES    AGE     VERSION
k8s-node1   Ready    master   3h50m   v1.17.3
k8s-node2   Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   3h3m    v1.17.3
k8s-node3   Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   3h3m    v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h3 id="8ï¼‰åŠ å…¥kubenetesçš„NodeèŠ‚ç‚¹"><a href="#8ï¼‰åŠ å…¥kubenetesçš„NodeèŠ‚ç‚¹" class="headerlink" title="8ï¼‰åŠ å…¥kubenetesçš„NodeèŠ‚ç‚¹"></a>8ï¼‰åŠ å…¥kubenetesçš„NodeèŠ‚ç‚¹</h3><p>åœ¨nodeèŠ‚ç‚¹ä¸­æ‰§è¡Œï¼Œå‘é›†ç¾¤ä¸­æ·»åŠ æ–°çš„èŠ‚ç‚¹ï¼Œæ‰§è¡Œåœ¨kubeadm init è¾“å‡ºçš„kubeadm joinå‘½ä»¤ï¼›<br>ç¡®ä¿nodeèŠ‚ç‚¹æˆåŠŸï¼š<br>tokenè¿‡æœŸæ€ä¹ˆåŠ<br>kubeadm token create â€“print-join-command</p>
<h3 id="9ï¼‰å…¥é—¨æ“ä½œkubernetesé›†ç¾¤"><a href="#9ï¼‰å…¥é—¨æ“ä½œkubernetesé›†ç¾¤" class="headerlink" title="9ï¼‰å…¥é—¨æ“ä½œkubernetesé›†ç¾¤"></a>9ï¼‰å…¥é—¨æ“ä½œkubernetesé›†ç¾¤</h3><p>1ã€åœ¨ä¸»èŠ‚ç‚¹ä¸Šéƒ¨ç½²ä¸€ä¸ªtomcat</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl create deployment tomcat6 --image<span class="token operator">=</span>tomcat:6.0.53-jre8<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>è·å–æ‰€æœ‰çš„èµ„æºï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS              RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-cfd8g   <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          41s

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   70m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">0</span>/1     <span class="token number">1</span>            <span class="token number">0</span>           41s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">0</span>       41s
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>kubectl get pods -o wide å¯ä»¥è·å–åˆ°tomcatéƒ¨ç½²ä¿¡æ¯ï¼Œèƒ½å¤Ÿçœ‹åˆ°å®ƒè¢«éƒ¨ç½²åˆ°äº†k8s-node2ä¸Šäº†</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get all -o wide</span>
NAME                           READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
pod/tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          114s   <span class="token number">10.244</span>.2.2   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE   SELECTOR
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   71m   <span class="token operator">&lt;</span>none<span class="token operator">></span>

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE    CONTAINERS   IMAGES               SELECTOR
deployment.apps/tomcat6   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           114s   tomcat       tomcat:6.0.53-jre8   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6

NAME                                 DESIRED   CURRENT   READY   AGE    CONTAINERS   IMAGES               SELECTOR
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       114s   tomcat       tomcat:6.0.53-jre8   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6,pod-template-hash<span class="token operator">=</span>7b84fb5fdc
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æŸ¥çœ‹node2èŠ‚ç‚¹ä¸Šï¼Œä¸‹è½½äº†å“ªäº›é•œåƒï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># docker images</span>
REPOSITORY                                                       TAG                 IMAGE ID            CREATED             SIZE
registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy   v1.17.3             0d40868643c6        <span class="token number">2</span> weeks ago         117MB
registry.cn-hangzhou.aliyuncs.com/google_containers/pause        <span class="token number">3.2</span>                 80d28bedfe5d        <span class="token number">2</span> months ago        683kB
quay.io/coreos/flannel                                           v0.11.0-amd64       ff281650a721        <span class="token number">15</span> months ago       <span class="token number">52</span>.6MB
tomcat                                                           <span class="token number">6.0</span>.53-jre8         49ab0583115a        <span class="token number">2</span> years ago         290MB
<span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æŸ¥çœ‹Node2èŠ‚ç‚¹ä¸Šï¼Œæ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE                                                            COMMAND                  CREATED             STATUS              PORTS               NAMES
9194cc4f0b7a        tomcat                                                           <span class="token string">"catalina.sh run"</span>        <span class="token number">2</span> minutes ago       Up <span class="token number">2</span> minutes                            k8s_tomcat_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
f44af0c7c345        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">"/pause"</span>                 <span class="token number">3</span> minutes ago       Up <span class="token number">3</span> minutes                            k8s_POD_tomcat6-7b84fb5fdc-cfd8g_default_0c9ebba2-992d-4c0e-99ef-3c4c3294bc59_0
ef74c90491e4        ff281650a721                                                     <span class="token string">"/opt/bin/flanneld -â€¦"</span>   <span class="token number">20</span> minutes ago      Up <span class="token number">20</span> minutes                           k8s_kube-flannel_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
c8a524e5a193        registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy   <span class="token string">"/usr/local/bin/kubeâ€¦"</span>   <span class="token number">25</span> minutes ago      Up <span class="token number">25</span> minutes                           k8s_kube-proxy_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
4590685c519a        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">"/pause"</span>                 <span class="token number">26</span> minutes ago      Up <span class="token number">26</span> minutes                           k8s_POD_kube-flannel-ds-amd64-5xs5j_kube-system_11a94346-316d-470b-9668-c15ce183abec_0
54e00af5cde4        registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.2    <span class="token string">"/pause"</span>                 <span class="token number">26</span> minutes ago      Up <span class="token number">26</span> minutes                           k8s_POD_kube-proxy-mvlnk_kube-system_519de79a-e8d8-4b1c-a74e-94634cebabce_0
<span class="token punctuation">[</span>root@k8s-node2 opt<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>åœ¨node1ä¸Šæ‰§è¡Œï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5m35s

<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces</span>
NAMESPACE     NAME                                READY   STATUS    RESTARTS   AGE
default       tomcat6-7b84fb5fdc-cfd8g            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          163m
kube-system   coredns-546565776c-9sbmk            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   coredns-546565776c-t68mr            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   etcd-k8s-node1                      <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-flannel-ds-amd64-5xs5j         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h24m
kube-system   kube-flannel-ds-amd64-fvnvx         <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-7tkvl                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-mvlnk                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h6m
kube-system   kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
kube-system   kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running   <span class="token number">0</span>          3h52m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>ä»å‰é¢çœ‹åˆ°tomcatéƒ¨ç½²åœ¨Node2ä¸Šï¼Œç°åœ¨æ¨¡æ‹Ÿå› ä¸ºå„ç§åŸå› å®•æœºçš„æƒ…å†µï¼Œå°†node2å…³é—­ç”µæºï¼Œè§‚å¯Ÿæƒ…å†µã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get nodes</span>
NAME        STATUS     ROLES    AGE     VERSION
k8s-node1   Ready      master   4h4m    v1.17.3
k8s-node2   NotReady   <span class="token operator">&lt;</span>none<span class="token operator">></span>   3h18m   v1.17.3
k8s-node3   Ready      <span class="token operator">&lt;</span>none<span class="token operator">></span>   3h18m   v1.17.3
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME                       READY   STATUS    RESTARTS   AGE    IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-cfd8g   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          177m   <span class="token number">10.244</span>.2.2   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<p><img src="/img/spring-cloud/image-20200504104925236.png" alt="image-20200504104925236"></p>
<p>2ã€æš´éœ²nginxè®¿é—®</p>
<p>åœ¨masterä¸Šæ‰§è¡Œ</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl expose deployment tomcat6 --port<span class="token operator">=</span><span class="token number">80</span> --target-port<span class="token operator">=</span><span class="token number">8080</span> --type<span class="token operator">=</span>NodePort <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>podçš„80æ˜ å°„å®¹å™¨çš„8080ï¼›serverä¼šå¸¦æ¥podçš„80</p>
<p>æŸ¥çœ‹æœåŠ¡ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc</span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        12h
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   49s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -o wide</span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE     SELECTOR
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        12h     <span class="token operator">&lt;</span>none<span class="token operator">></span>
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   3m30s   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p> <a target="_blank" rel="noopener" href="http://192.168.56.100:30526/">http://192.168.56.100:30526/</a> </p>
<p><img src="/img/spring-cloud/image-20200504105723874.png" alt="image-20200504105723874"></p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          13m

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        12h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   9m50s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">1</span>       11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>3ã€åŠ¨æ€æ‰©å®¹æµ‹è¯•</p>
<p>kubectl get deployment</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deployment</span>
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
tomcat6   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>


<p>åº”ç”¨å‡çº§ï¼š kubectl set image (â€“helpæŸ¥çœ‹å¸®åŠ©)<br>æ‰©å®¹ï¼škubectl scale â€“replicas=3 deployment tomcat6</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl scale --replicas=3 deployment tomcat6</span>
deployment.apps/tomcat6 scaled
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME                       READY   STATUS    RESTARTS   AGE   IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          61s   <span class="token number">10.244</span>.2.5   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>
tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19m   <span class="token number">10.244</span>.1.2   k8s-node3   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>
tomcat6-7b84fb5fdc-vlrh6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          61s   <span class="token number">10.244</span>.2.4   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">></span>           <span class="token operator">&lt;</span>none<span class="token operator">></span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -o wide    </span>
NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE   SELECTOR
kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        13h   <span class="token operator">&lt;</span>none<span class="token operator">></span>
tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   16m   <span class="token assign-left variable">app</span><span class="token operator">=</span>tomcat6
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>æ‰©å®¹äº†å¤šä»½ï¼Œæ‰€æœ‰æ— è®ºè®¿é—®å“ªä¸ªnodeçš„æŒ‡å®šç«¯å£ï¼Œéƒ½å¯ä»¥è®¿é—®åˆ°tomcat6</p>
<p> <a target="_blank" rel="noopener" href="http://192.168.56.101:30526/">http://192.168.56.101:30526/</a> </p>
<p><img src="/img/spring-cloud/image-20200504111008668.png" alt="image-20200504111008668"></p>
<p> <a target="_blank" rel="noopener" href="http://192.168.56.102:30526/">http://192.168.56.102:30526/</a> </p>
<p><img src="/img/spring-cloud/image-20200504111028496.png" alt="image-20200504111028496"></p>
<p>ç¼©å®¹ï¼škubectl scale â€“replicas=2 deployment tomcat6</p>
<pre class="line-numbers language-none"><code class="language-none">[root@k8s-node1 ~]#  kubectl scale --replicas&#x3D;2 deployment tomcat6
deployment.apps&#x2F;tomcat6 scaled
[root@k8s-node1 ~]# kubectl get pods -o wide                       
NAME                       READY   STATUS        RESTARTS   AGE     IP           NODE        NOMINATED NODE   READINESS GATES
tomcat6-7b84fb5fdc-hdgmc   0&#x2F;1     Terminating   0          4m47s   &lt;none&gt;       k8s-node2   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-qt5jm   1&#x2F;1     Running       0          22m     10.244.1.2   k8s-node3   &lt;none&gt;           &lt;none&gt;
tomcat6-7b84fb5fdc-vlrh6   1&#x2F;1     Running       0          4m47s   10.244.2.4   k8s-node2   &lt;none&gt;           &lt;none&gt;
[root@k8s-node1 ~]# <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>4ã€ä»¥ä¸Šæ“ä½œçš„yamlè·å–<br>å‚ç…§k8sç»†èŠ‚</p>
<p>5ã€åˆ é™¤<br>kubectl get all</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#æŸ¥çœ‹æ‰€æœ‰èµ„æº</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-qt5jm   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          26m
pod/tomcat6-7b84fb5fdc-vlrh6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8m16s

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        13h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   22m

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">2</span>/2     <span class="token number">2</span>            <span class="token number">2</span>           11h

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">2</span>         <span class="token number">2</span>         <span class="token number">2</span>       11h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#åˆ é™¤deployment.apps/tomcat6 </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete  deployment.apps/tomcat6 </span>
deployment.apps <span class="token string">"tomcat6"</span> deleted

<span class="token comment">#æŸ¥çœ‹å‰©ä½™çš„èµ„æº</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all   </span>
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1      <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        13h
service/tomcat6      NodePort    <span class="token number">10.96</span>.24.191   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30526/TCP   30m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token comment">#åˆ é™¤service/tomcat6 </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete service/tomcat6  </span>
<span class="token function">service</span> <span class="token string">"tomcat6"</span> deleted
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   13h
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>kubectl delete deploye/nginx<br>kubectl delete service/nginx-service</p>
<h2 id="3ã€K8sç»†èŠ‚"><a href="#3ã€K8sç»†èŠ‚" class="headerlink" title="3ã€K8sç»†èŠ‚"></a>3ã€K8sç»†èŠ‚</h2><h3 id="1ã€kubectlæ–‡æ¡£"><a href="#1ã€kubectlæ–‡æ¡£" class="headerlink" title="1ã€kubectlæ–‡æ¡£"></a>1ã€kubectlæ–‡æ¡£</h3><p>â€‹    <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/">https://kubernetes.io/zh/docs/reference/kubectl/overview/</a></p>
<h3 id="2ã€èµ„æºç±»å‹"><a href="#2ã€èµ„æºç±»å‹" class="headerlink" title="2ã€èµ„æºç±»å‹"></a>2ã€èµ„æºç±»å‹</h3><p>   <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#%e8%b5%84%e6%ba%90%e7%b1%bb%e5%9e%8b">https://kubernetes.io/zh/docs/reference/kubectl/overview/#%e8%b5%84%e6%ba%90%e7%b1%bb%e5%9e%8b</a></p>
<h3 id="3ã€æ ¼å¼åŒ–è¾“å‡º"><a href="#3ã€æ ¼å¼åŒ–è¾“å‡º" class="headerlink" title="3ã€æ ¼å¼åŒ–è¾“å‡º"></a>3ã€æ ¼å¼åŒ–è¾“å‡º</h3><p> <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/">https://kubernetes.io/zh/docs/reference/kubectl/overview/</a> </p>
<blockquote>
<p>æ‰€æœ‰ <code>kubectl</code> å‘½ä»¤çš„é»˜è®¤è¾“å‡ºæ ¼å¼éƒ½æ˜¯äººç±»å¯è¯»çš„çº¯æ–‡æœ¬æ ¼å¼ã€‚è¦ä»¥ç‰¹å®šæ ¼å¼å‘ç»ˆç«¯çª—å£è¾“å‡ºè¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥å°† <code>-o</code> æˆ– <code>--output</code> å‚æ•°æ·»åŠ åˆ°å—æ”¯æŒçš„ <code>kubectl</code> å‘½ä»¤ä¸­ã€‚</p>
<h4 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h4><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token operator">></span>kubectl <span class="token punctuation">[</span>command<span class="token punctuation">]</span> <span class="token punctuation">[</span>TYPE<span class="token punctuation">]</span> <span class="token punctuation">[</span>NAME<span class="token punctuation">]</span> -o<span class="token operator">=</span><span class="token operator">&lt;</span>output_format<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>æ ¹æ® <code>kubectl</code> æ“ä½œï¼Œæ”¯æŒä»¥ä¸‹è¾“å‡ºæ ¼å¼ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Output format</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>-o custom-columns=</code></td>
<td align="left">ä½¿ç”¨é€—å·åˆ†éš”çš„<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns">è‡ªå®šä¹‰åˆ—</a>åˆ—è¡¨æ‰“å°è¡¨ã€‚</td>
</tr>
<tr>
<td align="left"><code>-o custom-columns-file=</code></td>
<td align="left">ä½¿ç”¨ `` æ–‡ä»¶ä¸­çš„<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/kubectl/overview/#custom-columns">è‡ªå®šä¹‰åˆ—</a>æ¨¡æ¿æ‰“å°è¡¨ã€‚</td>
</tr>
<tr>
<td align="left"><code>-o json</code></td>
<td align="left">è¾“å‡º JSON æ ¼å¼çš„ API å¯¹è±¡</td>
</tr>
<tr>
<td align="left">`-o jsonpath=</td>
<td align="left">æ‰“å° <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">jsonpath</a> è¡¨è¾¾å¼å®šä¹‰çš„å­—æ®µ</td>
</tr>
<tr>
<td align="left"><code>-o jsonpath-file=</code></td>
<td align="left">æ‰“å° `` æ–‡ä»¶ä¸­ <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/jsonpath/">jsonpath</a> è¡¨è¾¾å¼å®šä¹‰çš„å­—æ®µã€‚</td>
</tr>
<tr>
<td align="left"><code>-o name</code></td>
<td align="left">ä»…æ‰“å°èµ„æºåç§°è€Œä¸æ‰“å°ä»»ä½•å…¶ä»–å†…å®¹ã€‚</td>
</tr>
<tr>
<td align="left"><code>-o wide</code></td>
<td align="left">ä»¥çº¯æ–‡æœ¬æ ¼å¼è¾“å‡ºï¼ŒåŒ…å«ä»»ä½•é™„åŠ ä¿¡æ¯ã€‚å¯¹äº pod åŒ…å«èŠ‚ç‚¹åã€‚</td>
</tr>
<tr>
<td align="left"><code>-o yaml</code></td>
<td align="left">è¾“å‡º YAML æ ¼å¼çš„ API å¯¹è±¡ã€‚</td>
</tr>
</tbody></table>
<h5 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h5><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œä»¥ä¸‹å‘½ä»¤å°†å•ä¸ª pod çš„è¯¦ç»†ä¿¡æ¯è¾“å‡ºä¸º YAML æ ¼å¼çš„å¯¹è±¡ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token operator">></span>kubectl get pod web-pod-13je7 -o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>è¯·è®°ä½ï¼šæœ‰å…³æ¯ä¸ªå‘½ä»¤æ”¯æŒå“ªç§è¾“å‡ºæ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/user-guide/kubectl/">kubectl</a> å‚è€ƒæ–‡æ¡£ã€‚</p>
</blockquote>
<p>â€“dry-runï¼š</p>
<blockquote>
<p>â€“dry-run=â€™noneâ€™: Must be â€œnoneâ€, â€œserverâ€, or â€œclientâ€. If client strategy, only print the object that would be</p>
<p>sent, without sending it. If server strategy, submit server-side request without persisting the resource.</p>
<p>å€¼å¿…é¡»ä¸ºnoneï¼Œserveræˆ–clientã€‚å¦‚æœæ˜¯å®¢æˆ·ç«¯ç­–ç•¥ï¼Œåˆ™åªæ‰“å°è¯¥å‘é€å¯¹è±¡ï¼Œä½†ä¸å‘é€å®ƒã€‚å¦‚æœæœåŠ¡å™¨ç­–ç•¥ï¼Œæäº¤æœåŠ¡å™¨ç«¯è¯·æ±‚è€Œä¸æŒä¹…åŒ–èµ„æºã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡â€“dry-runé€‰é¡¹ï¼Œå¹¶ä¸ä¼šçœŸæ­£çš„æ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚</p>
</blockquote>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml</span>
W0504 03<span class="token punctuation">:</span>39<span class="token punctuation">:</span>08.389369    8107 helpers.go<span class="token punctuation">:</span><span class="token number">535</span><span class="token punctuation">]</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>dry<span class="token punctuation">-</span>run is deprecated and can be replaced with <span class="token punctuation">-</span><span class="token punctuation">-</span>dry<span class="token punctuation">-</span>run=client.
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
        <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">[</span>root@k8s<span class="token punctuation">-</span>node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>å®é™…ä¸Šæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿™ä¸ªyamlè¾“å‡ºåˆ°æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨kubectl apply -fæ¥åº”ç”¨å®ƒ</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#è¾“å‡ºåˆ°tomcat6.yaml </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml >tomcat6.yaml</span>
W0504 03:46:18.180366   <span class="token number">11151</span> helpers.go:535<span class="token punctuation">]</span> --dry-run is deprecated and can be replaced with --dry-run<span class="token operator">=</span>client.

<span class="token comment">#ä¿®æ”¹å‰¯æœ¬æ•°ä¸º3</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># cat tomcat6.yaml </span>
apiVersion: apps/v1
kind: Deployment
metadata:
  creationTimestamp: null
  labels:
    app: tomcat6
  name: tomcat6
spec:
  replicas: <span class="token number">3</span>     <span class="token comment">#ä¿®æ”¹å‰¯æœ¬æ•°ä¸º3</span>
  selector:
    matchLabels:
      app: tomcat6
  strategy: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  template:
    metadata:
      creationTimestamp: null
      labels:
        app: tomcat6
    spec:
      containers:
      - image: tomcat:6.0.53-jre8
        name: tomcat
        resources: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
status: <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token comment">#åº”ç”¨tomcat6.yaml </span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6.yaml </span>
deployment.apps/tomcat6 created
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æŸ¥çœ‹podsï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods  </span>
NAME                       READY   STATUS    RESTARTS   AGE
tomcat6-7b84fb5fdc-5jh6t   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
tomcat6-7b84fb5fdc-8lhwv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
tomcat6-7b84fb5fdc-j4qmh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          8s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æŸ¥çœ‹æŸä¸ªpodçš„å…·ä½“ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods tomcat6-7b84fb5fdc-5jh6t  -o yaml</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:47Z"</span>
  <span class="token key atrule">generateName</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">pod-template-hash</span><span class="token punctuation">:</span> 7b84fb5fdc
  <span class="token key atrule">managedFields</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:metadata</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:generateName</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:labels</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          <span class="token key atrule">f:app</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          <span class="token key atrule">f:pod-template-hash</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:ownerReferences</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"uid"<span class="token punctuation">:</span><span class="token string">"292bfe3b-dd63-442e-95ce-c796ab5bdcc1"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:apiVersion</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:blockOwnerDeletion</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:controller</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:kind</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:name</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:uid</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
      <span class="token key atrule">f:spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:containers</span><span class="token punctuation">:</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"name"<span class="token punctuation">:</span><span class="token string">"tomcat"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:image</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:imagePullPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:name</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:resources</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:terminationMessagePath</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:terminationMessagePolicy</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:dnsPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:enableServiceLinks</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:restartPolicy</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:schedulerName</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>controller<span class="token punctuation">-</span>manager
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:47Z"</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
    <span class="token key atrule">fieldsType</span><span class="token punctuation">:</span> FieldsV1
    <span class="token key atrule">fieldsV1</span><span class="token punctuation">:</span>
      <span class="token key atrule">f:status</span><span class="token punctuation">:</span>
        <span class="token key atrule">f:conditions</span><span class="token punctuation">:</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"type"<span class="token punctuation">:</span><span class="token string">"ContainersReady"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"type"<span class="token punctuation">:</span><span class="token string">"Initialized"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"type"<span class="token punctuation">:</span><span class="token string">"Ready"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastProbeTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:lastTransitionTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:status</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:type</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:containerStatuses</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:hostIP</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:phase</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:podIP</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:podIPs</span><span class="token punctuation">:</span>
          <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
          k<span class="token punctuation">:</span><span class="token punctuation">&#123;</span>"ip"<span class="token punctuation">:</span><span class="token string">"10.244.2.7"</span><span class="token punctuation">&#125;</span><span class="token punctuation">:</span>
            <span class="token key atrule">.</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
            <span class="token key atrule">f:ip</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
        <span class="token key atrule">f:startTime</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">manager</span><span class="token punctuation">:</span> kubelet
    <span class="token key atrule">operation</span><span class="token punctuation">:</span> Update
    <span class="token key atrule">time</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:49Z"</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>5jh6t
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">ownerReferences</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
    <span class="token key atrule">blockOwnerDeletion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">controller</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">kind</span><span class="token punctuation">:</span> ReplicaSet
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6<span class="token punctuation">-</span>7b84fb5fdc
    <span class="token key atrule">uid</span><span class="token punctuation">:</span> 292bfe3b<span class="token punctuation">-</span>dd63<span class="token punctuation">-</span>442e<span class="token punctuation">-</span>95ce<span class="token punctuation">-</span>c796ab5bdcc1
  <span class="token key atrule">resourceVersion</span><span class="token punctuation">:</span> <span class="token string">"46229"</span>
  <span class="token key atrule">selfLink</span><span class="token punctuation">:</span> /api/v1/namespaces/default/pods/tomcat6<span class="token punctuation">-</span>7b84fb5fdc<span class="token punctuation">-</span>5jh6t
  <span class="token key atrule">uid</span><span class="token punctuation">:</span> 2f661212<span class="token punctuation">-</span>3b03<span class="token punctuation">-</span>47e4<span class="token punctuation">-</span>bcb8<span class="token punctuation">-</span>79782d5c7578
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
    <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">terminationMessagePath</span><span class="token punctuation">:</span> /dev/termination<span class="token punctuation">-</span>log
    <span class="token key atrule">terminationMessagePolicy</span><span class="token punctuation">:</span> File
    <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/run/secrets/kubernetes.io/serviceaccount
      <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
      <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
  <span class="token key atrule">enableServiceLinks</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">nodeName</span><span class="token punctuation">:</span> k8s<span class="token punctuation">-</span>node2
  <span class="token key atrule">priority</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Always
  <span class="token key atrule">schedulerName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>scheduler
  <span class="token key atrule">securityContext</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
  <span class="token key atrule">serviceAccount</span><span class="token punctuation">:</span> default
  <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> default
  <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
  <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoExecute
    <span class="token key atrule">key</span><span class="token punctuation">:</span> node.kubernetes.io/not<span class="token punctuation">-</span>ready
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">300</span>
  <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoExecute
    <span class="token key atrule">key</span><span class="token punctuation">:</span> node.kubernetes.io/unreachable
    <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
    <span class="token key atrule">tolerationSeconds</span><span class="token punctuation">:</span> <span class="token number">300</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
    <span class="token key atrule">secret</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultMode</span><span class="token punctuation">:</span> <span class="token number">420</span>
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> default<span class="token punctuation">-</span>token<span class="token punctuation">-</span>bxqtw
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:47Z"</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Initialized
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:49Z"</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Ready
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:49Z"</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> ContainersReady
  <span class="token punctuation">-</span> <span class="token key atrule">lastProbeTime</span><span class="token punctuation">:</span> <span class="token null important">null</span>
    <span class="token key atrule">lastTransitionTime</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:47Z"</span>
    <span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token string">"True"</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> PodScheduled
  <span class="token key atrule">containerStatuses</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">containerID</span><span class="token punctuation">:</span> docker<span class="token punctuation">:</span>//18eb0798384ea44ff68712cda9be94b6fb96265206c554a15cee28c288879304
    <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
    <span class="token key atrule">imageID</span><span class="token punctuation">:</span> docker<span class="token punctuation">-</span>pullable<span class="token punctuation">:</span>//tomcat@sha256<span class="token punctuation">:</span>8c643303012290f89c6f6852fa133b7c36ea6fbb8eb8b8c9588a432beb24dc5d
    <span class="token key atrule">lastState</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
    <span class="token key atrule">ready</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">restartCount</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">started</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">state</span><span class="token punctuation">:</span>
      <span class="token key atrule">running</span><span class="token punctuation">:</span>
        <span class="token key atrule">startedAt</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:49Z"</span>
  <span class="token key atrule">hostIP</span><span class="token punctuation">:</span> 10.0.2.4
  <span class="token key atrule">phase</span><span class="token punctuation">:</span> Running
  <span class="token key atrule">podIP</span><span class="token punctuation">:</span> 10.244.2.7
  <span class="token key atrule">podIPs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">ip</span><span class="token punctuation">:</span> 10.244.2.7
  <span class="token key atrule">qosClass</span><span class="token punctuation">:</span> BestEffort
  <span class="token key atrule">startTime</span><span class="token punctuation">:</span> <span class="token string">"2020-05-04T03:50:47Z"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h3 id="å‘½ä»¤å‚è€ƒ"><a href="#å‘½ä»¤å‚è€ƒ" class="headerlink" title="å‘½ä»¤å‚è€ƒ"></a>å‘½ä»¤å‚è€ƒ</h3><p><img src="/img/spring-cloud/image-20200504115823058.png" alt="image-20200504115823058"></p>
<h3 id="serviceçš„æ„ä¹‰"><a href="#serviceçš„æ„ä¹‰" class="headerlink" title="serviceçš„æ„ä¹‰"></a>serviceçš„æ„ä¹‰</h3><p><img src="/img/spring-cloud/image-20200504120856830.png" alt="image-20200504120856830"></p>
<p>å‰é¢æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œéƒ¨ç½²å’Œæš´éœ²äº†tomcatï¼Œå®é™…ä¸Šä¹Ÿå¯ä»¥é€šè¿‡yamlçš„æ–¹å¼æ¥å®Œæˆè¿™äº›æ“ä½œã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#è¿™äº›æ“ä½œå®é™…ä¸Šæ˜¯ä¸ºäº†è·å–Deploymentçš„yamlæ¨¡æ¿</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#  kubectl create deployment tomcat6 --image=tomcat:6.0.53-jre8 --dry-run -o yaml >tomcat6-deployment.yaml</span>
W0504 04:13:28.265432   <span class="token number">24263</span> helpers.go:535<span class="token punctuation">]</span> --dry-run is deprecated and can be replaced with --dry-run<span class="token operator">=</span>client.
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># ls tomcat6-deployment.yaml</span>
tomcat6-deployment.yaml
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¿®æ”¹â€œtomcat6-deployment.yamlâ€å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment">#éƒ¨ç½²</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6-deployment.yaml</span>
deployment.apps/tomcat6 configured


<span class="token comment">#æŸ¥çœ‹èµ„æº</span>
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-5jh6t   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m
pod/tomcat6-7b84fb5fdc-8lhwv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m
pod/tomcat6-7b84fb5fdc-j4qmh   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          27m

NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1    <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP   14h

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           27m

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       27m
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">kubectl expose deployment tomcat6 --port<span class="token operator">=</span><span class="token number">80</span> --target-port<span class="token operator">=</span><span class="token number">8080</span> --type<span class="token operator">=</span>NodePort  --dry-run -o yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">loadBalancer</span><span class="token punctuation">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>å°†è¿™æ®µè¾“å‡ºå’Œâ€œtomcat6-deployment.yamlâ€è¿›è¡Œæ‹¼æ¥ï¼Œè¡¨ç¤ºéƒ¨ç½²å®Œæ¯•å¹¶è¿›è¡Œæš´éœ²æœåŠ¡ï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>6.0.53<span class="token punctuation">-</span>jre8
        <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat6
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat6
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>éƒ¨ç½²å¹¶æš´éœ²æœåŠ¡</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat6-deployment.yaml</span>
deployment.apps/tomcat6 created
service/tomcat6 created<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>æŸ¥çœ‹æœåŠ¡å’Œéƒ¨ç½²ä¿¡æ¯</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get all</span>
NAME                           READY   STATUS    RESTARTS   AGE
pod/tomcat6-7b84fb5fdc-dsqmb   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4s
pod/tomcat6-7b84fb5fdc-gbmxc   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          5s
pod/tomcat6-7b84fb5fdc-kjlc6   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          4s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE
service/kubernetes   ClusterIP   <span class="token number">10.96</span>.0.1       <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">443</span>/TCP        14h
service/tomcat6      NodePort    <span class="token number">10.96</span>.147.210   <span class="token operator">&lt;</span>none<span class="token operator">></span>        <span class="token number">80</span>:30172/TCP   4s

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/tomcat6   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           5s

NAME                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/tomcat6-7b84fb5fdc   <span class="token number">3</span>         <span class="token number">3</span>         <span class="token number">3</span>       5s
<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è®¿é—®node1ï¼Œnode1å’Œnode3çš„30172ç«¯å£ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># curl -I http://192.168.56.&#123;100,101,102&#125;:30172/</span>
HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">"7454-1491118183000"</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">"7454-1491118183000"</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

HTTP/1.1 <span class="token number">200</span> OK
Server: Apache-Coyote/1.1
Accept-Ranges: bytes
ETag: W/<span class="token string">"7454-1491118183000"</span>
Last-Modified: Sun, 02 Apr <span class="token number">2017</span> 07:29:43 GMT
Content-Type: text/html
Content-Length: <span class="token number">7454</span>
Date: Mon, 04 May <span class="token number">2020</span> 04:35:35 GMT

<span class="token punctuation">[</span>root@k8s-node1 ~<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="Ingress"><a href="#Ingress" class="headerlink" title="Ingress"></a>Ingress</h3><p>é€šè¿‡Ingresså‘ç°podè¿›è¡Œå…³è”ã€‚åŸºäºåŸŸåè®¿é—®<br>é€šè¿‡Ingress controllerå®ç°PODè´Ÿè½½å‡è¡¡<br>æ”¯æŒTCP/UDP 4å±‚è´Ÿè½½å‡è¡¡å’ŒHTTP 7å±‚è´Ÿè½½å‡è¡¡</p>
<p><img src="/img/spring-cloud/image-20200504123948771.png" alt="image-20200504123948771"></p>
<p>æ­¥éª¤ï¼š<br>ï¼ˆ1ï¼‰éƒ¨ç½²Ingress controller</p>
<p>æ‰§è¡Œâ€œk8s/ingress-controller.yamlâ€</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f ingress-controller.yaml </span>
namespace/ingress-nginx created
configmap/nginx-configuration created
configmap/tcp-services created
configmap/udp-services created
serviceaccount/nginx-ingress-serviceaccount created
clusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole created
role.rbac.authorization.k8s.io/nginx-ingress-role created
rolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-binding created
clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-clusterrole-nisa-binding created
daemonset.apps/nginx-ingress-controller created
service/ingress-nginx created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æŸ¥çœ‹</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl get pods --all-namespaces</span>
NAMESPACE       NAME                                READY   STATUS              RESTARTS   AGE
default         tomcat6-7b84fb5fdc-dsqmb            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
default         tomcat6-7b84fb5fdc-gbmxc            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
default         tomcat6-7b84fb5fdc-kjlc6            <span class="token number">1</span>/1     Running             <span class="token number">0</span>          16m
ingress-nginx   nginx-ingress-controller-9q6cs      <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          40s
ingress-nginx   nginx-ingress-controller-qx572      <span class="token number">0</span>/1     ContainerCreating   <span class="token number">0</span>          40s
kube-system     coredns-546565776c-9sbmk            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     coredns-546565776c-t68mr            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     etcd-k8s-node1                      <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-apiserver-k8s-node1            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-controller-manager-k8s-node1   <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-flannel-ds-amd64-5xs5j         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          13h
kube-system     kube-flannel-ds-amd64-6xwth         <span class="token number">1</span>/1     Running             <span class="token number">2</span>          14h
kube-system     kube-flannel-ds-amd64-fvnvx         <span class="token number">1</span>/1     Running             <span class="token number">1</span>          13h
kube-system     kube-proxy-7tkvl                    <span class="token number">1</span>/1     Running             <span class="token number">1</span>          13h
kube-system     kube-proxy-mvlnk                    <span class="token number">1</span>/1     Running             <span class="token number">2</span>          13h
kube-system     kube-proxy-sz2vz                    <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
kube-system     kube-scheduler-k8s-node1            <span class="token number">1</span>/1     Running             <span class="token number">1</span>          14h
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è¿™é‡ŒmasterèŠ‚ç‚¹è´Ÿè´£è°ƒåº¦ï¼Œå…·ä½“æ‰§è¡Œäº¤ç»™node2å’Œnode3æ¥å®Œæˆï¼Œèƒ½å¤Ÿçœ‹åˆ°å®ƒä»¬æ­£åœ¨ä¸‹è½½é•œåƒ</p>
<p><img src="/img/spring-cloud/image-20200504124608258.png" alt="image-20200504124608258"></p>
<p>ï¼ˆ2ï¼‰åˆ›å»ºIngressè§„åˆ™</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> web
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tomcat6.kubenetes.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
       <span class="token key atrule">paths</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> <span class="token key atrule">backend</span><span class="token punctuation">:</span> 
              <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> tomcat6
              <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># touch ingress-tomcat6.yaml</span>
<span class="token comment">#å°†ä¸Šé¢çš„è§„åˆ™ï¼Œæ·»åŠ åˆ°ingress-tomcat6.yamlæ–‡ä»¶ä¸­</span>
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># vi  ingress-tomcat6.yaml  </span>
 
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f ingress-tomcat6.yaml </span>
ingress.extensions/web created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ä¿®æ”¹æœ¬æœºçš„hostsæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹çš„åŸŸåè½¬æ¢è§„åˆ™ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">192.168.56.102 tomcat6.kubenetes.com<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<p>æµ‹è¯•: <a target="_blank" rel="noopener" href="http://tomcat6.kubenetes.com/">http://tomcat6.kubenetes.com/</a> </p>
<p><img src="/img/spring-cloud/image-20200504131325267.png" alt="image-20200504131325267"></p>
<p>å¹¶ä¸”é›†ç¾¤ä¸­å³ä¾¿æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œä¹Ÿä¸å½±å“æ•´ä½“çš„è¿è¡Œã€‚</p>
<h2 id="å®‰è£…kuberneteså¯è§†åŒ–ç•Œé¢â€”â€”DashBoard"><a href="#å®‰è£…kuberneteså¯è§†åŒ–ç•Œé¢â€”â€”DashBoard" class="headerlink" title="å®‰è£…kuberneteså¯è§†åŒ–ç•Œé¢â€”â€”DashBoard"></a>å®‰è£…kuberneteså¯è§†åŒ–ç•Œé¢â€”â€”DashBoard</h2><p>1ã€éƒ¨ç½²DashBoard</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ kubectl appy -f  kubernetes-dashboard.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> æ–‡ä»¶åœ¨â€œk8sâ€æºç ç›®å½•æä¾›</p>
<p>2ã€æš´éœ²DashBoardä¸ºå…¬å…±è®¿é—®</p>
<p>é»˜è®¤DashBoardåªèƒ½é›†ç¾¤å†…éƒ¨è®¿é—®ï¼Œä¿®æ”¹Serviceä¸ºNodePortç±»å‹ï¼Œæš´éœ²åˆ°å¤–éƒ¨</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
      <span class="token key atrule">nodePort</span><span class="token punctuation">:</span> <span class="token number">3001</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>è®¿é—®åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://nodeip:30001/">http://NodeIP:30001</a></p>
<p>3ã€åˆ›å»ºæˆæƒè´¦å·</p>
<pre class="line-numbers language-none"><code class="language-none">$ kubectl create serviceaccount dashboar-admin -n kube-sysem<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">$ kubectl create clusterrolebinding dashboar-admin --clusterrole&#x3D;cluter-admin --serviceaccount&#x3D;kube-system:dashboard-admin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">$ kubectl describe secrets -n kube-system $( kubectl -n kube-system get secret |awk &#39;&#x2F;dashboard-admin&#x2F;&#123;print $1&#125;&#39; )<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ä½¿ç”¨è¾“å‡ºçš„tokenç™»å½•dashboard</p>
<p><img src="/img/spring-cloud/image-20200504153630775.png" alt="image-20200504153630775"></p>
<h2 id="kubesphere"><a href="#kubesphere" class="headerlink" title="kubesphere"></a>kubesphere</h2><p>é»˜è®¤çš„dashboardæ²¡å•¥ç”¨ï¼Œæˆ‘ä»¬ç”¨kubesphereå¯ä»¥æ‰“é€šå…¨éƒ¨çš„devopsé“¾è·¯ï¼Œkubesphereé›†æˆäº†å¾ˆå¤šå¥—ä»¶ï¼Œé›†ç¾¤è¦æ±‚æ¯”è¾ƒé«˜<br><a target="_blank" rel="noopener" href="https://kubesphere.io/">https://kubesphere.io</a></p>
<p>kuboardä¹Ÿå¾ˆä¸é”™ï¼Œé›†ç¾¤è¦æ±‚ä¸é«˜<br><a target="_blank" rel="noopener" href="https://kuboard.cn/support/">https://kuboard.cn/support/</a></p>
<h3 id="1ã€ç®€æ´"><a href="#1ã€ç®€æ´" class="headerlink" title="1ã€ç®€æ´"></a>1ã€ç®€æ´</h3><p>kubesphereæ˜¯ä¸€æ¬¾é¢å‘äº‘åŸå£°è®¾è®¡çš„å¼€æºé¡¹ç›®ï¼Œåœ¨ç›®å‰ä¸»æµå®¹å™¨è°ƒåº¦å¹³å°kubernetsæ™ºå•†æ„å»ºçš„åˆ†å¸ƒå¼å¤šç”¨æˆ·å®¹å™¨ç®¡ç†å¹³å°ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„æ“ä½œç•Œé¢ä»¥åŠå‘å¯¼å¼æ“ä½œæ–¹å¼ï¼Œåœ¨é™ä½ç”¨æˆ·ä½¿ç”¨å®¹å™¨è°ƒåº¦å¹³å°å­¦ä¹ æˆæœ¬çš„åŒæ—¶ï¼Œæå¤§é™ä½å¼€å‘ã€æµ‹è¯•ã€è¿ç»´çš„æ—¥å¸¸å·¥ä½œçš„å¤æ‚åº¦ã€‚</p>
<h3 id="2ã€å®‰è£…å‰ææäº¤"><a href="#2ã€å®‰è£…å‰ææäº¤" class="headerlink" title="2ã€å®‰è£…å‰ææäº¤"></a>2ã€å®‰è£…å‰ææäº¤</h3><h4 id="1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹æ‰§è¡Œï¼‰"><a href="#1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹æ‰§è¡Œï¼‰" class="headerlink" title="1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹æ‰§è¡Œï¼‰"></a>1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹æ‰§è¡Œï¼‰</h4><p>helmæ˜¯kubernetesçš„åŒ…ç®¡ç†å™¨ã€‚åŒ…ç®¡ç†å™¨ç±»ä¼¼äºåœ¨Ubuntuä¸­ä½¿ç”¨çš„aptï¼Œcentosä¸­çš„yumæˆ–è€…pythonä¸­çš„pipä¸€æ ·ï¼Œèƒ½å¤Ÿå¿«é€ŸæŸ¥æ‰¾ï¼Œä¸‹è½½å’Œå®‰è£…è½¯ä»¶åŒ…ã€‚Helmæœ‰å®¢æˆ·ç«¯ç»„ä»¶helmå’ŒæœåŠ¡ç«¯ç»„ä»¶Tillerç»„æˆï¼Œèƒ½å¤Ÿå°†ä¸€ç»„K8Sèµ„æºæ‰“åŒ…ç»Ÿä¸€ç®¡ç†ï¼Œæ˜¯æŸ¥æ‰¾ã€å…±äº«å’Œä½¿ç”¨ä¸ºKubernetesæ„å»ºçš„è½¯ä»¶çš„æœ€ä½³æ–¹å¼ã€‚</p>
<p>1ï¼‰å®‰è£…</p>
<pre class="line-numbers language-none"><code class="language-none">curl -L https:&#x2F;&#x2F;git.io&#x2F;get_helm.sh|bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç”±äºè¢«å¢™çš„åŸå› ï¼Œä½¿ç”¨æˆ‘ä»¬ç»™å®šçš„get_helm.shã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># ll</span>
total <span class="token number">68</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">7149</span> Feb <span class="token number">27</span> 01:58 get_helm.sh
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">6310</span> Feb <span class="token number">28</span> 05:16 ingress-controller.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">209</span> Feb <span class="token number">28</span> <span class="token number">13</span>:18 ingress-demo.yml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">236</span> May  <span class="token number">4</span> 05:09 ingress-tomcat6.yaml
-rwxr--r-- <span class="token number">1</span> root root <span class="token number">15016</span> Feb <span class="token number">26</span> <span class="token number">15</span>:05 kube-flannel.yml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">4737</span> Feb <span class="token number">26</span> <span class="token number">15</span>:38 kubernetes-dashboard.yaml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">3841</span> Feb <span class="token number">27</span> 01:09 kubesphere-complete-setup.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">392</span> Feb <span class="token number">28</span> <span class="token number">11</span>:33 master_images.sh
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">283</span> Feb <span class="token number">28</span> <span class="token number">11</span>:34 node_images.sh
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">1053</span> Feb <span class="token number">28</span> 03:53 product.yaml
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">931</span> May  <span class="token number">3</span> <span class="token number">10</span>:08 Vagrantfile
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># sh get_helm.sh </span>
Downloading https://get.helm.sh/helm-v2.16.6-linux-amd64.tar.gz
Preparing to <span class="token function">install</span> helm and tiller into /usr/local/bin
helm installed into /usr/local/bin/helm
tiller installed into /usr/local/bin/tiller
Run <span class="token string">'helm init'</span> to configure helm.
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>2ï¼‰éªŒè¯ç‰ˆæœ¬</p>
<pre class="line-numbers language-none"><code class="language-none">helm version<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>3ï¼‰åˆ›å»ºæƒé™ï¼ˆmasteræ‰§è¡Œï¼‰</p>
<p>åˆ›å»ºhelm-rbac.yamlï¼Œå†™å…¥å¦‚ä¸‹å†…å®¹</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tiller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tiller
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åº”ç”¨é…ç½®ï¼š</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl apply -f helm-rbac.yaml</span>
serviceaccount/tiller created
clusterrolebinding.rbac.authorization.k8s.io/tiller created
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="2ã€å®‰è£…Tilllerï¼ˆMasteræ‰§è¡Œï¼‰"><a href="#2ã€å®‰è£…Tilllerï¼ˆMasteræ‰§è¡Œï¼‰" class="headerlink" title="2ã€å®‰è£…Tilllerï¼ˆMasteræ‰§è¡Œï¼‰"></a>2ã€å®‰è£…Tilllerï¼ˆMasteræ‰§è¡Œï¼‰</h4><p>1ã€åˆå§‹åŒ–</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># helm init --service-account=tiller --tiller-image=sapcc/tiller:v2.16.3 --history-max 300 </span>
Creating /root/.helm 
Creating /root/.helm/repository 
Creating /root/.helm/repository/cache 
Creating /root/.helm/repository/local 
Creating /root/.helm/plugins 
Creating /root/.helm/starters 
Creating /root/.helm/cache/archive 
Creating /root/.helm/repository/repositories.yaml 
Adding stable repo with URL: https://kubernetes-charts.storage.googleapis.com 
Adding <span class="token builtin class-name">local</span> repo with URL: http://127.0.0.1:8879/charts 
<span class="token variable">$HELM_HOME</span> has been configured at /root/.helm.

Tiller <span class="token punctuation">(</span>the Helm server-side component<span class="token punctuation">)</span> has been installed into your Kubernetes Cluster.

Please note: by default, Tiller is deployed with an insecure <span class="token string">'allow unauthenticated users'</span> policy.
To prevent this, run <span class="token variable"><span class="token variable">`</span>helm init<span class="token variable">`</span></span> with the --tiller-tls-verify flag.
For <span class="token function">more</span> information on securing your installation see: https://v2.helm.sh/docs/securing_installation/
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>â€“tiller-image æŒ‡å®šé•œåƒï¼Œå¦åˆ™ä¼šè¢«å¢™ï¼Œç­‰å¾…èŠ‚ç‚¹ä¸Šéƒ¨ç½²çš„tillerå®Œæˆå³å¯ã€‚</p>
<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl get pods -n kube-system</span>
NAME                                   READY   STATUS             RESTARTS   AGE
coredns-546565776c-9sbmk               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
coredns-546565776c-t68mr               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
etcd-k8s-node1                         <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-apiserver-k8s-node1               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-controller-manager-k8s-node1      <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-flannel-ds-amd64-5xs5j            <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-flannel-ds-amd64-6xwth            <span class="token number">1</span>/1     Running            <span class="token number">5</span>          23h
kube-flannel-ds-amd64-fvnvx            <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-proxy-7tkvl                       <span class="token number">1</span>/1     Running            <span class="token number">3</span>          22h
kube-proxy-mvlnk                       <span class="token number">1</span>/1     Running            <span class="token number">4</span>          22h
kube-proxy-sz2vz                       <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kube-scheduler-k8s-node1               <span class="token number">1</span>/1     Running            <span class="token number">3</span>          23h
kubernetes-dashboard-975499656-jxczv   <span class="token number">0</span>/1     ImagePullBackOff   <span class="token number">0</span>          7h45m
tiller-deploy-8cc566858-67bxb          <span class="token number">1</span>/1     Running            <span class="token number">0</span>          31s
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>æŸ¥çœ‹é›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯ï¼š</p>
<pre class="line-numbers language-none"><code class="language-none">kubectl get node -o wide<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment">#  kubectl get node -o wide</span>
NAME        STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
k8s-node1   Ready    master   23h   v1.17.3   <span class="token number">10.0</span>.2.15     <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
k8s-node2   Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   22h   v1.17.3   <span class="token number">10.0</span>.2.4      <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
k8s-node3   Ready    <span class="token operator">&lt;</span>none<span class="token operator">></span>   22h   v1.17.3   <span class="token number">10.0</span>.2.5      <span class="token operator">&lt;</span>none<span class="token operator">></span>        CentOS Linux <span class="token number">7</span> <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>   <span class="token number">3.10</span>.0-957.12.2.el7.x86_64   docker://19.3.8
<span class="token punctuation">[</span>root@k8s-node1 k8s<span class="token punctuation">]</span><span class="token comment"># </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<p>2ã€æµ‹è¯•</p>
<pre class="line-numbers language-none"><code class="language-none">helm install stable&#x2F;nginx-ingress --name nginx-ingress<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>





<p>æœ€å°åŒ–å®‰è£… KubeSphere</p>
<p>è‹¥é›†ç¾¤å¯ç”¨ CPU &gt; 1 Core ä¸”å¯ç”¨å†…å­˜ &gt; 2 Gï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æœ€å°åŒ–å®‰è£… KubeSphereï¼š</p>
<pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">kubectl apply <span class="token punctuation">-</span>f https<span class="token punctuation">:</span>//raw.githubusercontent.com/kubesphere/ks<span class="token punctuation">-</span>installer/master/kubesphere<span class="token punctuation">-</span>minimal.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p> <strong>æç¤ºï¼šè‹¥æ‚¨çš„æœåŠ¡å™¨æç¤ºæ— æ³•è®¿é—® GitHubï¼Œå¯å°†</strong> <a target="_blank" rel="noopener" href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-minimal.yaml">kubesphere-minimal.yaml</a> <strong>æˆ–</strong> <a target="_blank" rel="noopener" href="https://github.com/kubesphere/ks-installer/blob/master/kubesphere-complete-setup.yaml">kubesphere-complete-setup.yaml</a> <strong>æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ä½œä¸ºæœ¬åœ°çš„é™æ€æ–‡ä»¶ï¼Œå†å‚è€ƒä¸Šè¿°å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</strong> </p>
<ol>
<li>æŸ¥çœ‹æ»šåŠ¨åˆ·æ–°çš„å®‰è£…æ—¥å¿—ï¼Œè¯·è€å¿ƒç­‰å¾…å®‰è£…æˆåŠŸã€‚</li>
</ol>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ kubectl logs -n kubesphere-system <span class="token variable"><span class="token variable">$(</span>kubectl get pod -n kubesphere-system -l <span class="token assign-left variable">app</span><span class="token operator">=</span>ks-install -o <span class="token assign-left variable">jsonpath</span><span class="token operator">=</span><span class="token string">'&#123;.items[0].metadata.name&#125;'</span><span class="token variable">)</span></span> -f<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<blockquote>
<p>è¯´æ˜ï¼šå®‰è£…è¿‡ç¨‹ä¸­è‹¥é‡åˆ°é—®é¢˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸Šæ—¥å¿—å‘½ä»¤æ¥æ’æŸ¥é—®é¢˜ã€‚</p>
</blockquote>

                
                
                    <br />
                    <!-- post-content-ad -->
                    <ins class="adsbygoogle"
                            style="display:block"
                            data-ad-client="ca-pub-3409699730406381"
                            data-ad-slot="9289016056"
                            data-ad-format="auto"
                            data-full-width-responsive="true"></ins>
                    <script>
                            (adsbygoogle = window.adsbygoogle || []).push({});
                    </script>
                

                <br>
                <hr>
                <!-- Pager -->
                <ul class="pager">
                    
                    
                        <li class="next">
                            <a href="/Java/spring-cloud/mall-distributed-advanced/" data-toggle="tooltip" data-placement="top" title="ã€Spring-cloudã€‘guliå•†åŸ-åˆ†å¸ƒå¼è¿›é˜¶">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <!--æ‰“èµ-->
                
                    <div class="reward">
                        <div class="reward-button">èµ <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="/img/reward/alipay.jpg"><b>æ”¯ä»˜å®æ‰“èµ</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="/img/reward/wechat_pay.jpg"><b>å¾®ä¿¡æ‰“èµ</b> </span>
                            </span></div>
                        <p class="reward-notice">èµèµä¸€ä¸‹</p>
                    </div>
                
                <!--æ‰“èµ-->

                <br>
                <!--åˆ†äº«-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--åˆ†äº«-->
                <br>                       
                
                <!-- require APlayer -->
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
                <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>

                <div class="aplayer"
                    data-id="2297428102"
                    data-server="netease"
                    data-type="playlist"
                    data-fixed="true" >
                </div>
                

                
        
                    
                        <!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  --> 
                        <div id="lv-container" data-id="city" data-uid="MTAyMC80Mzg3OC8yMDQxMw==">
                            <script type="text/javascript">
                                (function (d, s) {
                                    var j, e = d.getElementsByTagName(s)[0];
        
                                    if (typeof LivereTower === 'function') { return; }
        
                                    j = d.createElement(s);
                                    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
                                    j.async = true;
        
                                    e.parentNode.insertBefore(j, e);
                                })(document, 'script');
                            </script>
                            <noscript> ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
                        </div>
                        <!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
                    
            </div>
            
            <!-- Table of Contents -->
            
  
    <style>
      span.toc-nav-number{
        display: none
      }
    </style>
  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        <!-- toc -->
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#1%E3%80%81K8s%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">1ã€K8så¿«é€Ÿå…¥é—¨</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%EF%BC%89%E7%AE%80%E4%BB%8B"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">1ï¼‰ç®€ä»‹</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%EF%BC%89%E6%9E%B6%E6%9E%84"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">2ï¼‰æ¶æ„</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%881%EF%BC%89%E6%95%B4%E4%BD%93%E4%B8%BB%E4%BB%8E%E6%96%B9%E5%BC%8F"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">ï¼ˆ1ï¼‰æ•´ä½“ä¸»ä»æ–¹å¼</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%882%EF%BC%89master%E8%8A%82%E7%82%B9%E6%9E%B6%E6%9E%84"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">ï¼ˆ2ï¼‰masterèŠ‚ç‚¹æ¶æ„</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%883%EF%BC%89Node%E8%8A%82%E7%82%B9%E6%9E%B6%E6%9E%84"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">ï¼ˆ3ï¼‰NodeèŠ‚ç‚¹æ¶æ„</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%EF%BC%89%E6%A6%82%E5%BF%B5"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">3ï¼‰æ¦‚å¿µ</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4%EF%BC%89%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">4ï¼‰å¿«é€Ÿä½“éªŒ</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85minikube"><span class="toc-nav-number">1.4.1.</span> <span class="toc-nav-text">ï¼ˆ1ï¼‰å®‰è£…minikube</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%882%EF%BC%89%E4%BD%93%E9%AA%8Cnginx%E9%83%A8%E7%BD%B2%E5%8D%87%E7%BA%A7"><span class="toc-nav-number">1.4.2.</span> <span class="toc-nav-text">ï¼ˆ2ï¼‰ä½“éªŒnginxéƒ¨ç½²å‡çº§</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#2%E3%80%81K8s%E9%9B%86%E7%BE%A4%E5%AE%89%E8%A3%85"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">2ã€K8sé›†ç¾¤å®‰è£…</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%EF%BC%89kubeadm"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">1ï¼‰kubeadm</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%EF%BC%89%E5%89%8D%E7%BD%AE%E8%A6%81%E6%B1%82"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">2ï¼‰å‰ç½®è¦æ±‚</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%EF%BC%89%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">3ï¼‰éƒ¨ç½²æ­¥éª¤</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#4%EF%BC%89%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">4ï¼‰ç¯å¢ƒå‡†å¤‡</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%881%EF%BC%89%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-nav-number">2.4.1.</span> <span class="toc-nav-text">ï¼ˆ1ï¼‰å‡†å¤‡å·¥ä½œ</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%882%EF%BC%89%E5%90%AF%E5%8A%A8%E4%B8%89%E4%B8%AA%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-nav-number">2.4.2.</span> <span class="toc-nav-text">ï¼ˆ2ï¼‰å¯åŠ¨ä¸‰ä¸ªè™šæ‹Ÿæœº</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%883%EF%BC%89%E8%AE%BE%E7%BD%AELinux%E7%8E%AF%E5%A2%83%EF%BC%88%E4%B8%89%E4%B8%AA%E8%8A%82%E7%82%B9%E9%83%BD%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-nav-number">2.4.3.</span> <span class="toc-nav-text">ï¼ˆ3ï¼‰è®¾ç½®Linuxç¯å¢ƒï¼ˆä¸‰ä¸ªèŠ‚ç‚¹éƒ½æ‰§è¡Œï¼‰</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#5%EF%BC%89%E6%89%80%E6%9C%89%E8%8A%82%E7%82%B9%E5%AE%89%E8%A3%85docker%E3%80%81kubeadm%E3%80%81kubelet%E3%80%81kubectl"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">5ï¼‰æ‰€æœ‰èŠ‚ç‚¹å®‰è£…dockerã€kubeadmã€kubeletã€kubectl</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%881%EF%BC%89%E5%AE%89%E8%A3%85Docker"><span class="toc-nav-number">2.5.1.</span> <span class="toc-nav-text">ï¼ˆ1ï¼‰å®‰è£…Docker</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%882%EF%BC%89%E6%B7%BB%E5%8A%A0%E9%98%BF%E9%87%8C%E4%B8%8EYum%E6%BA%90"><span class="toc-nav-number">2.5.2.</span> <span class="toc-nav-text">ï¼ˆ2ï¼‰æ·»åŠ é˜¿é‡Œä¸Yumæº</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%883%EF%BC%89%E5%AE%89%E8%A3%85kubeadm%EF%BC%8Ckubelet%E5%92%8Ckubectl"><span class="toc-nav-number">2.5.3.</span> <span class="toc-nav-text">ï¼ˆ3ï¼‰å®‰è£…kubeadmï¼Œkubeletå’Œkubectl</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#6%EF%BC%89%E9%83%A8%E7%BD%B2k8s-master"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">6ï¼‰éƒ¨ç½²k8s-master</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%881%EF%BC%89master%E8%8A%82%E7%82%B9%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-nav-number">2.6.1.</span> <span class="toc-nav-text">ï¼ˆ1ï¼‰masterèŠ‚ç‚¹åˆå§‹åŒ–</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%EF%BC%882%EF%BC%89%E6%B5%8B%E8%AF%95Kubectl%EF%BC%88%E4%B8%BB%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-nav-number">2.6.2.</span> <span class="toc-nav-text">ï¼ˆ2ï¼‰æµ‹è¯•Kubectlï¼ˆä¸»èŠ‚ç‚¹æ‰§è¡Œï¼‰</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#7%EF%BC%89%E5%AE%89%E8%A3%85POD%E7%BD%91%E7%BB%9C%E6%8F%92%E4%BB%B6%EF%BC%88CNI%EF%BC%89"><span class="toc-nav-number">2.7.</span> <span class="toc-nav-text">7ï¼‰å®‰è£…PODç½‘ç»œæ’ä»¶ï¼ˆCNIï¼‰</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#8%EF%BC%89%E5%8A%A0%E5%85%A5kubenetes%E7%9A%84Node%E8%8A%82%E7%82%B9"><span class="toc-nav-number">2.8.</span> <span class="toc-nav-text">8ï¼‰åŠ å…¥kubenetesçš„NodeèŠ‚ç‚¹</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#9%EF%BC%89%E5%85%A5%E9%97%A8%E6%93%8D%E4%BD%9Ckubernetes%E9%9B%86%E7%BE%A4"><span class="toc-nav-number">2.9.</span> <span class="toc-nav-text">9ï¼‰å…¥é—¨æ“ä½œkubernetesé›†ç¾¤</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#3%E3%80%81K8s%E7%BB%86%E8%8A%82"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">3ã€K8sç»†èŠ‚</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81kubectl%E6%96%87%E6%A1%A3"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">1ã€kubectlæ–‡æ¡£</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">2ã€èµ„æºç±»å‹</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#3%E3%80%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">3ã€æ ¼å¼åŒ–è¾“å‡º</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-nav-number">3.3.1.</span> <span class="toc-nav-text">è¯­æ³•</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-nav-number">3.3.1.1.</span> <span class="toc-nav-text">ç¤ºä¾‹</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#%E5%91%BD%E4%BB%A4%E5%8F%82%E8%80%83"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">å‘½ä»¤å‚è€ƒ</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#service%E7%9A%84%E6%84%8F%E4%B9%89"><span class="toc-nav-number">3.5.</span> <span class="toc-nav-text">serviceçš„æ„ä¹‰</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#Ingress"><span class="toc-nav-number">3.6.</span> <span class="toc-nav-text">Ingress</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#%E5%AE%89%E8%A3%85kubernetes%E5%8F%AF%E8%A7%86%E5%8C%96%E7%95%8C%E9%9D%A2%E2%80%94%E2%80%94DashBoard"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">å®‰è£…kuberneteså¯è§†åŒ–ç•Œé¢â€”â€”DashBoard</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#kubesphere"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">kubesphere</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#1%E3%80%81%E7%AE%80%E6%B4%81"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">1ã€ç®€æ´</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85%E5%89%8D%E6%8F%90%E6%8F%90%E4%BA%A4"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">2ã€å®‰è£…å‰ææäº¤</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85helm%EF%BC%88master%E8%8A%82%E7%82%B9%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-nav-number">5.2.1.</span> <span class="toc-nav-text">1ã€å®‰è£…helmï¼ˆmasterèŠ‚ç‚¹æ‰§è¡Œï¼‰</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85Tilller%EF%BC%88Master%E6%89%A7%E8%A1%8C%EF%BC%89"><span class="toc-nav-number">5.2.2.</span> <span class="toc-nav-text">2ã€å®‰è£…Tilllerï¼ˆMasteræ‰§è¡Œï¼‰</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Recommended Posts  -->
                
                    <hr>
                    <h5>æ¨èæ–‡ç« </h5>
                    

    <div class="recommended_posts">
        <ul>
            
                <li><a href="https://fangzhioo.github.io/Java/spring-cloud/mall-distributed-advanced/">ã€Spring-cloudã€‘guliå•†åŸ-åˆ†å¸ƒå¼è¿›é˜¶</a></li>
            
                <li><a href="https://fangzhioo.github.io/Java/spring-cloud/mall-distributed-base/">ã€Spring-cloudã€‘guliå•†åŸ-åˆ†å¸ƒå¼åŸºç¡€</a></li>
            
        </ul>
    </div>
 
                

                <!-- Featured Tags -->
                
                <section>
                    <div class="tags">
                        
                            <a class="tag" href="/tags/#SpringCloud" title="SpringCloud">SpringCloud</a>
                        
                            <a class="tag" href="/tags/#Kubernetes" title="Kubernetes">Kubernetes</a>
                        
                    </div>
                </section>
                
            </div>
        </div>
    </div>
</article>

<!-- å¤åˆ¶æ·»åŠ ç‰ˆæƒç”³æ˜-->
<script>
    /**/
    function setClipboardText(event){
        event.preventDefault();//é˜»æ­¢å…ƒç´ å‘ç”Ÿé»˜è®¤çš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œå½“ç‚¹å‡»æäº¤æŒ‰é’®æ—¶é˜»æ­¢å¯¹è¡¨å•çš„æäº¤ï¼‰ã€‚
        var node = document.createElement('div');
        //å¯¹documentfragmentä¸ç†Ÿï¼Œä¸çŸ¥é“æ€ä¹ˆè·å–é‡Œé¢çš„å†…å®¹ï¼Œç”¨äº†ä¸€ä¸ªæ¯”è¾ƒç¬¨çš„æ–¹å¼
        node.appendChild(window.getSelection().getRangeAt(0).cloneContents());
        //getRangeAt(0)è¿”å›å¯¹åŸºäºé›¶çš„æ•°å­—ç´¢å¼•ä¸ä¼ é€’å‚æ•°åŒ¹é…çš„é€‰æ‹©å¯¹è±¡ä¸­çš„èŒƒå›´çš„å¼•ç”¨ã€‚å¯¹äºè¿ç»­é€‰æ‹©ï¼Œå‚æ•°åº”ä¸ºé›¶ã€‚
        var htmlData = '<div>'
            + node.innerHTML
            + '<br /><br />è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚<br />'
            + 'å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚<br />'
            + 'ä½œè€…ï¼šfangzhioo <br />é“¾æ¥ï¼š'
            + location.href
            + '<br />æ¥æºï¼šfangzhioo.github.io<br /><br />'
            + '</div>';
        var textData = window.getSelection().getRangeAt(0)
            + '\n\nè‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚\n'
            + 'å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚\n'
            + 'ä½œè€…ï¼šfangzhioo\n'
            + 'é“¾æ¥ï¼š'
            + location.href
            + 'æ¥æºï¼šfangzhioo.github.io\n\n';
        if(event.clipboardData){
            event.clipboardData.setData("text/html", htmlData);
            //setData(å‰ªè´´æ¿æ ¼å¼, æ•°æ®) ç»™å‰ªè´´æ¿èµ‹äºˆæŒ‡å®šæ ¼å¼çš„æ•°æ®ã€‚è¿”å› true è¡¨ç¤ºæ“ä½œæˆåŠŸã€‚
            event.clipboardData.setData("text/plain",textData);
        }
        else if(window.clipboardData){ //window.clipboardDataçš„ä½œç”¨æ˜¯åœ¨é¡µé¢ä¸Šå°†éœ€è¦çš„ä¸œè¥¿å¤åˆ¶åˆ°å‰ªè´´æ¿ä¸Šï¼Œæä¾›äº†å¯¹äºé¢„å®šä¹‰çš„å‰ªè´´æ¿æ ¼å¼çš„è®¿é—®ï¼Œä»¥ä¾¿åœ¨ç¼–è¾‘æ“ä½œä¸­ä½¿ç”¨ã€‚
            return window.clipboardData.setData("text", textData);
        }
    };
 
    document.addEventListener('copy',function(e){
        setClipboardText(e);
    });
</script>

<!-- smooth scroll behavior polyfill  -->
<!-- <script type="text/javascript" src="/js/smoothscroll.js"></script> -->



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/fang-zhi-4-73">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">çŸ¥</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="http://weibo.com/fangzhioooo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/fangzhioo">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; æ–¹å¿— 2021 
                    <br>
                    Theme by <a target="_blank" rel="noopener" href="https://huangxuan.me/">Hux</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="https://fangzhioo.github.io">Fz</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=fangzhioo&repo=fangzhioo.github.io&type=star&count=true" >
                    </iframe>
                    <br />
                    <!--æ€»è®¿é—®é‡ç»Ÿè®¡-->
                    
                        <span id="busuanzi_container_site_pv" style="margin-left: 3px;">
                            æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
                        </span>
                    
                    <!--æ€»è®¿é—®é‡ç»Ÿè®¡-->

                </p>
            </div>
        </div>
    </div>
</footer>

<!-- Custom Theme JavaScript -->

<script src="/js/my-blog.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://fangzhioo.github.io/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-138588101-1';
    var _gaDomain = 'fangzhioo.github.io';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = 'dce5d892b228cc0a253520da429e7f11';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
<!-- Image to hack wechat -->
<img src="https://fangzhioo.github.io/img/icon_wechat.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

<!-- live2d -->
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":true,"debug":false,"model":{"position":"right","width":200,"height":400,"jsonPath":"/live2dw/assets/sagiri.model.json"},"mobile":{"show":true},"react":{"opacity":0.6},"log":false});</script>

</body>

</html>
